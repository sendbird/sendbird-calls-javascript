/**
 * Copyright (c) 2016 SendBird DBA (Smile Family, Inc.)
 * SendBird Call JavaScript SDK v1.10.5 production
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).SendBirdCall=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function t(e,t){return e(t={exports:{}},t.exports),t.exports}var n=function(e){return e&&e.Math==Math&&e},r=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")(),i=function(e){try{return!!e()}catch(e){return!0}},a=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),o={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,c={f:s&&!o.call({1:2},1)?function(e){var t=s(this,e);return!!t&&t.enumerable}:o},u=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},l={}.toString,d=function(e){return l.call(e).slice(8,-1)},h="".split,f=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==d(e)?h.call(e,""):Object(e)}:Object,_=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},v=function(e){return f(_(e))},p=function(e){return"object"==typeof e?null!==e:"function"==typeof e},y=function(e,t){if(!p(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!p(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!p(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!p(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},m={}.hasOwnProperty,g=function(e,t){return m.call(e,t)},E=r.document,k=p(E)&&p(E.createElement),R=function(e){return k?E.createElement(e):{}},C=!a&&!i((function(){return 7!=Object.defineProperty(R("div"),"a",{get:function(){return 7}}).a})),I=Object.getOwnPropertyDescriptor,w={f:a?I:function(e,t){if(e=v(e),t=y(t,!0),C)try{return I(e,t)}catch(e){}if(g(e,t))return u(!c.f.call(e,t),e[t])}},A=function(e){if(!p(e))throw TypeError(String(e)+" is not an object");return e},T=Object.defineProperty,b={f:a?T:function(e,t,n){if(A(e),t=y(t,!0),A(n),C)try{return T(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},S=a?function(e,t,n){return b.f(e,t,u(1,n))}:function(e,t,n){return e[t]=n,e},O=function(e,t){try{S(r,e,t)}catch(n){r[e]=t}return t},D="__core-js_shared__",N=r[D]||O(D,{}),L=Function.toString;"function"!=typeof N.inspectSource&&(N.inspectSource=function(e){return L.call(e)});var P,x,M,U=N.inspectSource,V=r.WeakMap,F="function"==typeof V&&/native code/.test(U(V)),G=t((function(e){(e.exports=function(e,t){return N[e]||(N[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.8.1",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),B=0,j=Math.random(),q=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++B+j).toString(36)},H=G("keys"),z=function(e){return H[e]||(H[e]=q(e))},W={},K=r.WeakMap;if(F){var Y=N.state||(N.state=new K),Z=Y.get,Q=Y.has,X=Y.set;P=function(e,t){return t.facade=e,X.call(Y,e,t),t},x=function(e){return Z.call(Y,e)||{}},M=function(e){return Q.call(Y,e)}}else{var $=z("state");W[$]=!0,P=function(e,t){return t.facade=e,S(e,$,t),t},x=function(e){return g(e,$)?e[$]:{}},M=function(e){return g(e,$)}}var J={set:P,get:x,has:M,enforce:function(e){return M(e)?x(e):P(e,{})},getterFor:function(e){return function(t){var n;if(!p(t)||(n=x(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},ee=t((function(e){var t=J.get,n=J.enforce,i=String(String).split("String");(e.exports=function(e,t,a,o){var s,c=!!o&&!!o.unsafe,u=!!o&&!!o.enumerable,l=!!o&&!!o.noTargetGet;"function"==typeof a&&("string"!=typeof t||g(a,"name")||S(a,"name",t),(s=n(a)).source||(s.source=i.join("string"==typeof t?t:""))),e!==r?(c?!l&&e[t]&&(u=!0):delete e[t],u?e[t]=a:S(e,t,a)):u?e[t]=a:O(t,a)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||U(this)}))})),te=r,ne=function(e){return"function"==typeof e?e:void 0},re=function(e,t){return arguments.length<2?ne(te[e])||ne(r[e]):te[e]&&te[e][t]||r[e]&&r[e][t]},ie=Math.ceil,ae=Math.floor,oe=function(e){return isNaN(e=+e)?0:(e>0?ae:ie)(e)},se=Math.min,ce=function(e){return e>0?se(oe(e),9007199254740991):0},ue=Math.max,le=Math.min,de=function(e,t){var n=oe(e);return n<0?ue(n+t,0):le(n,t)},he=function(e){return function(t,n,r){var i,a=v(t),o=ce(a.length),s=de(r,o);if(e&&n!=n){for(;o>s;)if((i=a[s++])!=i)return!0}else for(;o>s;s++)if((e||s in a)&&a[s]===n)return e||s||0;return!e&&-1}},fe={includes:he(!0),indexOf:he(!1)},_e=fe.indexOf,ve=function(e,t){var n,r=v(e),i=0,a=[];for(n in r)!g(W,n)&&g(r,n)&&a.push(n);for(;t.length>i;)g(r,n=t[i++])&&(~_e(a,n)||a.push(n));return a},pe=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ye=pe.concat("length","prototype"),me={f:Object.getOwnPropertyNames||function(e){return ve(e,ye)}},ge={f:Object.getOwnPropertySymbols},Ee=re("Reflect","ownKeys")||function(e){var t=me.f(A(e)),n=ge.f;return n?t.concat(n(e)):t},ke=function(e,t){for(var n=Ee(t),r=b.f,i=w.f,a=0;a<n.length;a++){var o=n[a];g(e,o)||r(e,o,i(t,o))}},Re=/#|\.prototype\./,Ce=function(e,t){var n=we[Ie(e)];return n==Te||n!=Ae&&("function"==typeof t?i(t):!!t)},Ie=Ce.normalize=function(e){return String(e).replace(Re,".").toLowerCase()},we=Ce.data={},Ae=Ce.NATIVE="N",Te=Ce.POLYFILL="P",be=Ce,Se=w.f,Oe=function(e,t){var n,i,a,o,s,c=e.target,u=e.global,l=e.stat;if(n=u?r:l?r[c]||O(c,{}):(r[c]||{}).prototype)for(i in t){if(o=t[i],a=e.noTargetGet?(s=Se(n,i))&&s.value:n[i],!be(u?i:c+(l?".":"#")+i,e.forced)&&void 0!==a){if(typeof o==typeof a)continue;ke(o,a)}(e.sham||a&&a.sham)&&S(o,"sham",!0),ee(n,i,o,e)}},De=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},Ne=function(e,t,n){if(De(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Le=function(e){return Object(_(e))},Pe=Array.isArray||function(e){return"Array"==d(e)},xe=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())})),Me=xe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ue=G("wks"),Ve=r.Symbol,Fe=Me?Ve:Ve&&Ve.withoutSetter||q,Ge=function(e){return g(Ue,e)||(xe&&g(Ve,e)?Ue[e]=Ve[e]:Ue[e]=Fe("Symbol."+e)),Ue[e]},Be=Ge("species"),je=function(e,t){var n;return Pe(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Pe(n.prototype)?p(n)&&null===(n=n[Be])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)},qe=[].push,He=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,a=6==e,o=7==e,s=5==e||a;return function(c,u,l,d){for(var h,_,v=Le(c),p=f(v),y=Ne(u,l,3),m=ce(p.length),g=0,E=d||je,k=t?E(c,m):n||o?E(c,0):void 0;m>g;g++)if((s||g in p)&&(_=y(h=p[g],g,v),e))if(t)k[g]=_;else if(_)switch(e){case 3:return!0;case 5:return h;case 6:return g;case 2:qe.call(k,h)}else switch(e){case 4:return!1;case 7:qe.call(k,h)}return a?-1:r||i?i:k}},ze={forEach:He(0),map:He(1),filter:He(2),some:He(3),every:He(4),find:He(5),findIndex:He(6),filterOut:He(7)},We=function(e,t){var n=[][e];return!!n&&i((function(){n.call(null,t||function(){throw 1},1)}))},Ke=Object.defineProperty,Ye={},Ze=function(e){throw e},Qe=function(e,t){if(g(Ye,e))return Ye[e];t||(t={});var n=[][e],r=!!g(t,"ACCESSORS")&&t.ACCESSORS,o=g(t,0)?t[0]:Ze,s=g(t,1)?t[1]:void 0;return Ye[e]=!!n&&!i((function(){if(r&&!a)return!0;var e={length:-1};r?Ke(e,1,{enumerable:!0,get:Ze}):e[1]=1,n.call(e,o,s)}))},Xe=ze.forEach,$e=We("forEach"),Je=Qe("forEach"),et=$e&&Je?[].forEach:function(e){return Xe(this,e,arguments.length>1?arguments[1]:void 0)};Oe({target:"Array",proto:!0,forced:[].forEach!=et},{forEach:et});var tt,nt=Object.keys||function(e){return ve(e,pe)},rt=a?Object.defineProperties:function(e,t){A(e);for(var n,r=nt(t),i=r.length,a=0;i>a;)b.f(e,n=r[a++],t[n]);return e},it=re("document","documentElement"),at="prototype",ot="script",st=z("IE_PROTO"),ct=function(){},ut=function(e){return"<"+ot+">"+e+"</"+ot+">"},lt=function(){try{tt=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t,n;lt=tt?function(e){e.write(ut("")),e.close();var t=e.parentWindow.Object;return e=null,t}(tt):(t=R("iframe"),n="java"+ot+":",t.style.display="none",it.appendChild(t),t.src=String(n),(e=t.contentWindow.document).open(),e.write(ut("document.F=Object")),e.close(),e.F);for(var r=pe.length;r--;)delete lt[at][pe[r]];return lt()};W[st]=!0;var dt=Object.create||function(e,t){var n;return null!==e?(ct[at]=A(e),n=new ct,ct[at]=null,n[st]=e):n=lt(),void 0===t?n:rt(n,t)},ht=Ge("unscopables"),ft=Array.prototype;null==ft[ht]&&b.f(ft,ht,{configurable:!0,value:dt(null)});var _t,vt,pt,yt=function(e){ft[ht][e]=!0},mt={},gt=!i((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Et=z("IE_PROTO"),kt=Object.prototype,Rt=gt?Object.getPrototypeOf:function(e){return e=Le(e),g(e,Et)?e[Et]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?kt:null},Ct=Ge("iterator"),It=!1;[].keys&&("next"in(pt=[].keys())?(vt=Rt(Rt(pt)))!==Object.prototype&&(_t=vt):It=!0),null==_t&&(_t={}),g(_t,Ct)||S(_t,Ct,(function(){return this}));var wt={IteratorPrototype:_t,BUGGY_SAFARI_ITERATORS:It},At=b.f,Tt=Ge("toStringTag"),bt=function(e,t,n){e&&!g(e=n?e:e.prototype,Tt)&&At(e,Tt,{configurable:!0,value:t})},St=wt.IteratorPrototype,Ot=function(){return this},Dt=function(e,t,n){var r=t+" Iterator";return e.prototype=dt(St,{next:u(1,n)}),bt(e,r,!1),mt[r]=Ot,e},Nt=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return A(n),function(e){if(!p(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),Lt=wt.IteratorPrototype,Pt=wt.BUGGY_SAFARI_ITERATORS,xt=Ge("iterator"),Mt="keys",Ut="values",Vt="entries",Ft=function(){return this},Gt=function(e,t,n,r,i,a,o){Dt(n,t,r);var s,c,u,l=function(e){if(e===i&&v)return v;if(!Pt&&e in f)return f[e];switch(e){case Mt:case Ut:case Vt:return function(){return new n(this,e)}}return function(){return new n(this)}},d=t+" Iterator",h=!1,f=e.prototype,_=f[xt]||f["@@iterator"]||i&&f[i],v=!Pt&&_||l(i),p="Array"==t&&f.entries||_;if(p&&(s=Rt(p.call(new e)),Lt!==Object.prototype&&s.next&&(Rt(s)!==Lt&&(Nt?Nt(s,Lt):"function"!=typeof s[xt]&&S(s,xt,Ft)),bt(s,d,!0))),i==Ut&&_&&_.name!==Ut&&(h=!0,v=function(){return _.call(this)}),f[xt]!==v&&S(f,xt,v),mt[t]=v,i)if(c={values:l(Ut),keys:a?v:l(Mt),entries:l(Vt)},o)for(u in c)(Pt||h||!(u in f))&&ee(f,u,c[u]);else Oe({target:t,proto:!0,forced:Pt||h},c);return c},Bt="Array Iterator",jt=J.set,qt=J.getterFor(Bt),Ht=Gt(Array,"Array",(function(e,t){jt(this,{type:Bt,target:v(e),index:0,kind:t})}),(function(){var e=qt(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");mt.Arguments=mt.Array,yt("keys"),yt("values"),yt("entries");var zt=!i((function(){return Object.isExtensible(Object.preventExtensions({}))})),Wt=t((function(e){var t=b.f,n=q("meta"),r=0,i=Object.isExtensible||function(){return!0},a=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},o=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!p(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!g(e,n)){if(!i(e))return"F";if(!t)return"E";a(e)}return e[n].objectID},getWeakData:function(e,t){if(!g(e,n)){if(!i(e))return!0;if(!t)return!1;a(e)}return e[n].weakData},onFreeze:function(e){return zt&&o.REQUIRED&&i(e)&&!g(e,n)&&a(e),e}};W[n]=!0})),Kt=(Wt.REQUIRED,Wt.fastKey,Wt.getWeakData,Wt.onFreeze,Ge("iterator")),Yt=Array.prototype,Zt=function(e){return void 0!==e&&(mt.Array===e||Yt[Kt]===e)},Qt={};Qt[Ge("toStringTag")]="z";var Xt="[object z]"===String(Qt),$t=Ge("toStringTag"),Jt="Arguments"==d(function(){return arguments}()),en=Xt?d:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),$t))?n:Jt?d(t):"Object"==(r=d(t))&&"function"==typeof t.callee?"Arguments":r},tn=Ge("iterator"),nn=function(e){if(null!=e)return e[tn]||e["@@iterator"]||mt[en(e)]},rn=function(e){var t=e.return;if(void 0!==t)return A(t.call(e)).value},an=function(e,t){this.stopped=e,this.result=t},on=function(e,t,n){var r,i,a,o,s,c,u,l=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),f=!(!n||!n.INTERRUPTED),_=Ne(t,l,1+d+f),v=function(e){return r&&rn(r),new an(!0,e)},p=function(e){return d?(A(e),f?_(e[0],e[1],v):_(e[0],e[1])):f?_(e,v):_(e)};if(h)r=e;else{if("function"!=typeof(i=nn(e)))throw TypeError("Target is not iterable");if(Zt(i)){for(a=0,o=ce(e.length);o>a;a++)if((s=p(e[a]))&&s instanceof an)return s;return new an(!1)}r=i.call(e)}for(c=r.next;!(u=c.call(r)).done;){try{s=p(u.value)}catch(e){throw rn(r),e}if("object"==typeof s&&s&&s instanceof an)return s}return new an(!1)},sn=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},cn=Ge("iterator"),un=!1;try{var ln=0,dn={next:function(){return{done:!!ln++}},return:function(){un=!0}};dn[cn]=function(){return this},Array.from(dn,(function(){throw 2}))}catch(e){}var hn=function(e,t){if(!t&&!un)return!1;var n=!1;try{var r={};r[cn]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n},fn=function(e,t,n){var r,i;return Nt&&"function"==typeof(r=t.constructor)&&r!==n&&p(i=r.prototype)&&i!==n.prototype&&Nt(e,i),e},_n=function(e,t,n){for(var r in t)ee(e,r,t[r],n);return e},vn=Ge("species"),pn=function(e){var t=re(e),n=b.f;a&&t&&!t[vn]&&n(t,vn,{configurable:!0,get:function(){return this}})},yn=b.f,mn=Wt.fastKey,gn=J.set,En=J.getterFor,kn={getConstructor:function(e,t,n,r){var i=e((function(e,o){sn(e,i,t),gn(e,{type:t,index:dt(null),first:void 0,last:void 0,size:0}),a||(e.size=0),null!=o&&on(o,e[r],{that:e,AS_ENTRIES:n})})),o=En(t),s=function(e,t,n){var r,i,s=o(e),u=c(e,t);return u?u.value=n:(s.last=u={index:i=mn(t,!0),key:t,value:n,previous:r=s.last,next:void 0,removed:!1},s.first||(s.first=u),r&&(r.next=u),a?s.size++:e.size++,"F"!==i&&(s.index[i]=u)),e},c=function(e,t){var n,r=o(e),i=mn(t);if("F"!==i)return r.index[i];for(n=r.first;n;n=n.next)if(n.key==t)return n};return _n(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,a?e.size=0:this.size=0},delete:function(e){var t=this,n=o(t),r=c(t,e);if(r){var i=r.next,s=r.previous;delete n.index[r.index],r.removed=!0,s&&(s.next=i),i&&(i.previous=s),n.first==r&&(n.first=i),n.last==r&&(n.last=s),a?n.size--:t.size--}return!!r},forEach:function(e){for(var t,n=o(this),r=Ne(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!c(this,e)}}),_n(i.prototype,n?{get:function(e){var t=c(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),a&&yn(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=En(t),a=En(r);Gt(e,t,(function(e,t){gn(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=a(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),pn(t)}},Rn=(function(e,t,n){var a=-1!==e.indexOf("Map"),o=-1!==e.indexOf("Weak"),s=a?"set":"add",c=r[e],u=c&&c.prototype,l=c,d={},h=function(e){var t=u[e];ee(u,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(o&&!p(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return o&&!p(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(o&&!p(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(be(e,"function"!=typeof c||!(o||u.forEach&&!i((function(){(new c).entries().next()})))))l=n.getConstructor(t,e,a,s),Wt.REQUIRED=!0;else if(be(e,!0)){var f=new l,_=f[s](o?{}:-0,1)!=f,v=i((function(){f.has(1)})),y=hn((function(e){new c(e)})),m=!o&&i((function(){for(var e=new c,t=5;t--;)e[s](t,t);return!e.has(-0)}));y||((l=t((function(t,n){sn(t,l,e);var r=fn(new c,t,l);return null!=n&&on(n,r[s],{that:r,AS_ENTRIES:a}),r}))).prototype=u,u.constructor=l),(v||m)&&(h("delete"),h("has"),a&&h("get")),(m||_)&&h(s),o&&u.clear&&delete u.clear}d[e]=l,Oe({global:!0,forced:l!=c},d),bt(l,e),o||n.setStrong(l,e,a)}("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),kn),Xt?{}.toString:function(){return"[object "+en(this)+"]"});Xt||ee(Object.prototype,"toString",Rn,{unsafe:!0});var Cn=function(e){return function(t,n){var r,i,a=String(_(t)),o=oe(n),s=a.length;return o<0||o>=s?e?"":void 0:(r=a.charCodeAt(o))<55296||r>56319||o+1===s||(i=a.charCodeAt(o+1))<56320||i>57343?e?a.charAt(o):r:e?a.slice(o,o+2):i-56320+(r-55296<<10)+65536}},In={codeAt:Cn(!1),charAt:Cn(!0)},wn=In.charAt,An="String Iterator",Tn=J.set,bn=J.getterFor(An);Gt(String,"String",(function(e){Tn(this,{type:An,string:String(e),index:0})}),(function(){var e,t=bn(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=wn(n,r),t.index+=e.length,{value:e,done:!1})}));var Sn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};for(var On in Sn){var Dn=r[On],Nn=Dn&&Dn.prototype;if(Nn&&Nn.forEach!==et)try{S(Nn,"forEach",et)}catch(e){Nn.forEach=et}}var Ln,Pn=Ge("iterator"),xn=Ge("toStringTag"),Mn=Ht.values;for(var Un in Sn){var Vn=r[Un],Fn=Vn&&Vn.prototype;if(Fn){if(Fn[Pn]!==Mn)try{S(Fn,Pn,Mn)}catch(e){Fn[Pn]=Mn}if(Fn[xn]||S(Fn,xn,Un),Sn[Un])for(var Gn in Ht)if(Fn[Gn]!==Ht[Gn])try{S(Fn,Gn,Ht[Gn])}catch(e){Fn[Gn]=Ht[Gn]}}}function Bn(e){return Bn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bn(e)}function jn(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function qn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){jn(a,r,i,o,s,"next",e)}function s(e){jn(a,r,i,o,s,"throw",e)}o(void 0)}))}}function Hn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Wn(e,t,n){return t&&zn(e.prototype,t),n&&zn(e,n),e}function Kn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yn(Object(n),!0).forEach((function(t){Kn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qn(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$n(e,t)}function Xn(e){return Xn=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Xn(e)}function $n(e,t){return $n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},$n(e,t)}function Jn(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function er(e,t,n){return er=Jn()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&$n(i,n.prototype),i},er.apply(null,arguments)}function tr(e){var t="function"==typeof Map?new Map:void 0;return tr=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return er(e,arguments,Xn(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),$n(r,e)},tr(e)}function nr(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function rr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ir(e){var t=Jn();return function(){var n,r=Xn(e);if(t){var i=Xn(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?rr(e):t}(this,n)}}function ar(e,t,n){return ar="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Xn(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}},ar(e,t,n||e)}function or(e,t){return cr(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}(e,t)||lr(e,t)||hr()}function sr(e){return function(e){if(Array.isArray(e))return dr(e)}(e)||ur(e)||lr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function cr(e){if(Array.isArray(e))return e}function ur(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function lr(e,t){if(e){if("string"==typeof e)return dr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dr(e,t):void 0}}function dr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hr(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function fr(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=lr(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function _r(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function vr(e,t,n,r){var i=pr();if(r)for(var a=0;a<r.length;a++)i=r[a](i);var o=t((function(e){i.initializeInstanceElements(e,s.elements)}),n),s=i.decorateClass(function(e){for(var t=[],n=function(e){return"method"===e.kind&&e.key===a.key&&e.placement===a.placement},r=0;r<e.length;r++){var i,a=e[r];if("method"===a.kind&&(i=t.find(n)))if(Er(a.descriptor)||Er(i.descriptor)){if(gr(a)||gr(i))throw new ReferenceError("Duplicated methods ("+a.key+") can't be decorated.");i.descriptor=a.descriptor}else{if(gr(a)){if(gr(i))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+a.key+").");i.decorators=a.decorators}mr(a,i)}else t.push(a)}return t}(o.d.map(yr)),e);return i.initializeClassElements(o.F,s.elements),i.runClassFinishers(o.F,s.finishers)}function pr(){pr=function(){return e};var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(n){t.forEach((function(t){t.kind===n&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var n=e.prototype;["method","field"].forEach((function(r){t.forEach((function(t){var i=t.placement;if(t.kind===r&&("static"===i||"prototype"===i)){var a="static"===i?e:n;this.defineClassElement(a,t)}}),this)}),this)},defineClassElement:function(e,t){var n=t.descriptor;if("field"===t.kind){var r=t.initializer;n={enumerable:n.enumerable,writable:n.writable,configurable:n.configurable,value:void 0===r?void 0:r.call(e)}}Object.defineProperty(e,t.key,n)},decorateClass:function(e,t){var n=[],r=[],i={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,i)}),this),e.forEach((function(e){if(!gr(e))return n.push(e);var t=this.decorateElement(e,i);n.push(t.element),n.push.apply(n,t.extras),r.push.apply(r,t.finishers)}),this),!t)return{elements:n,finishers:r};var a=this.decorateConstructor(n,t);return r.push.apply(r,a.finishers),a.finishers=r,a},addElementPlacement:function(e,t,n){var r=t[e.placement];if(!n&&-1!==r.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");r.push(e.key)},decorateElement:function(e,t){for(var n=[],r=[],i=e.decorators,a=i.length-1;a>=0;a--){var o=t[e.placement];o.splice(o.indexOf(e.key),1);var s=this.fromElementDescriptor(e),c=this.toElementFinisherExtras((0,i[a])(s)||s);e=c.element,this.addElementPlacement(e,t),c.finisher&&r.push(c.finisher);var u=c.extras;if(u){for(var l=0;l<u.length;l++)this.addElementPlacement(u[l],t);n.push.apply(n,u)}}return{element:e,finishers:r,extras:n}},decorateConstructor:function(e,t){for(var n=[],r=t.length-1;r>=0;r--){var i=this.fromClassDescriptor(e),a=this.toClassDescriptor((0,t[r])(i)||i);if(void 0!==a.finisher&&n.push(a.finisher),void 0!==a.elements){e=a.elements;for(var o=0;o<e.length-1;o++)for(var s=o+1;s<e.length;s++)if(e[o].key===e[s].key&&e[o].placement===e[s].placement)throw new TypeError("Duplicated element ("+e[o].key+")")}}return{elements:e,finishers:n}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,cr(t)||ur(t)||lr(t)||hr()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var n=_r(e.key),r=String(e.placement);if("static"!==r&&"prototype"!==r&&"own"!==r)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+r+'"');var i=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var a={kind:t,key:n,placement:r,descriptor:Object.assign({},i)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(i,"get","The property descriptor of a field descriptor"),this.disallowProperty(i,"set","The property descriptor of a field descriptor"),this.disallowProperty(i,"value","The property descriptor of a field descriptor"),a.initializer=e.initializer),a},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:kr(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var n=kr(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:n}},runClassFinishers:function(e,t){for(var n=0;n<t.length;n++){var r=(0,t[n])(e);if(void 0!==r){if("function"!=typeof r)throw new TypeError("Finishers must return a constructor.");e=r}}return e},disallowProperty:function(e,t,n){if(void 0!==e[t])throw new TypeError(n+" can't have a ."+t+" property.")}};return e}function yr(e){var t,n=_r(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var r={kind:"field"===e.kind?"field":"method",key:n,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(r.decorators=e.decorators),"field"===e.kind&&(r.initializer=e.value),r}function mr(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function gr(e){return e.decorators&&e.decorators.length}function Er(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function kr(e,t){var n=e[t];if(void 0!==n&&"function"!=typeof n)throw new TypeError("Expected '"+t+"' to be a function");return n}!function(e){e[e.DIAL_CANCELED=1800100]="DIAL_CANCELED",e[e.MY_USER_ID_NOT_ALLOWED=1800101]="MY_USER_ID_NOT_ALLOWED",e[e.ERR_REQUEST_FAILED=1800200]="ERR_REQUEST_FAILED",e[e.ERR_WEBSOCKET_CONNECTION_NOT_OPENED=1800201]="ERR_WEBSOCKET_CONNECTION_NOT_OPENED",e[e.ERR_WEBSOCKET_CONNECTION_FAILED=1800202]="ERR_WEBSOCKET_CONNECTION_FAILED",e[e.ERR_NO_RESPONSE_DUE_TO_TIMEOUT=1800203]="ERR_NO_RESPONSE_DUE_TO_TIMEOUT",e[e.ERR_REQUEST_FAILED_DUE_TO_WEBSOCKET_CONNECTION_LOST=1800204]="ERR_REQUEST_FAILED_DUE_TO_WEBSOCKET_CONNECTION_LOST",e[e.ERR_WRONG_RESPONSE=1800205]="ERR_WRONG_RESPONSE",e[e.ERR_QUERY_IN_PROGRESS=1800206]="ERR_QUERY_IN_PROGRESS",e[e.INTERNAL_SERVER_ERROR=1800207]="INTERNAL_SERVER_ERROR",e[e.ERR_MALFORMED_DATA=1800208]="ERR_MALFORMED_DATA",e[e.ERR_PARTICIPANT_ALREADY_IN_ROOM=1800700]="ERR_PARTICIPANT_ALREADY_IN_ROOM",e[e.ERR_ENTERING_ROOM_STILL_IN_PROGRESS=1800701]="ERR_ENTERING_ROOM_STILL_IN_PROGRESS",e[e.ERR_PARTICIPANT_NOT_IN_ROOM=1800702]="ERR_PARTICIPANT_NOT_IN_ROOM",e[e.ERR_EXITING_ROOM_STILL_IN_PROGRESS=1800703]="ERR_EXITING_ROOM_STILL_IN_PROGRESS",e[e.ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_SEND_STREAM=1800704]="ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_SEND_STREAM",e[e.ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_RECEIVE_STREAM=1800705]="ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_RECEIVE_STREAM",e[e.ERR_LOCAL_PARTICIPANT_LOST_CONNECTION=1800706]="ERR_LOCAL_PARTICIPANT_LOST_CONNECTION",e[e.ERR_LOCAL_PARTICIPANT_KICKED_OUT=1800707]="ERR_LOCAL_PARTICIPANT_KICKED_OUT",e[e.INVALID_PARAMETER_VALUE=1800300]="INVALID_PARAMETER_VALUE",e[e.INVALID_PARAMETER_TYPE=1800301]="INVALID_PARAMETER_TYPE",e[e.INSTANCE_NOT_INITIALIZED=1800302]="INSTANCE_NOT_INITIALIZED",e[e.USER_NOT_AUTHENTICATED=1800303]="USER_NOT_AUTHENTICATED",e[e.CAMERA_ALREADY_SWITCHING=1800400]="CAMERA_ALREADY_SWITCHING",e[e.ERR_CAMERA_SWITCH=1800401]="ERR_CAMERA_SWITCH",e[e.ERR_CHANGING_AUDIO_DEVICE=1800402]="ERR_CHANGING_AUDIO_DEVICE",e[e.ERR_CAPTURE_NOT_ALLOWED_ON_AUDIO_CALL=1800600]="ERR_CAPTURE_NOT_ALLOWED_ON_AUDIO_CALL",e[e.ERR_VIDEO_VIEW_NOT_READY=1800601]="ERR_VIDEO_VIEW_NOT_READY",e[e.ERR_VIDEO_CALL_NOT_CONNECTED_YET=1800602]="ERR_VIDEO_CALL_NOT_CONNECTED_YET",e[e.ERR_FAILED_TO_GET_IMAGE_FROM_VIDEO_STREAM=1800603]="ERR_FAILED_TO_GET_IMAGE_FROM_VIDEO_STREAM",e[e.ERR_SERVER_INTERNAL_ERROR=1400999]="ERR_SERVER_INTERNAL_ERROR",e[e.ERR_INVALID_CALL_STATUS=1400101]="ERR_INVALID_CALL_STATUS",e[e.ERR_CALL_DOES_NOT_EXIST=1400102]="ERR_CALL_DOES_NOT_EXIST",e[e.ERR_CALLEE_DOES_NOT_EXIST=1400103]="ERR_CALLEE_DOES_NOT_EXIST",e[e.ERR_DIAL_MYSELF=1400104]="ERR_DIAL_MYSELF",e[e.ERR_NO_PERMISSION=1400105]="ERR_NO_PERMISSION",e[e.ERR_CALLEE_NEVER_AUTHENTICATE=1400106]="ERR_CALLEE_NEVER_AUTHENTICATE",e[e.ERR_ROOM_MAX_PARTICIPANTS=1400120]="ERR_ROOM_MAX_PARTICIPANTS",e[e.ERR_INVALID_ROOM_PARTICIPANT=1400121]="ERR_INVALID_ROOM_PARTICIPANT",e[e.ERR_CLIENT_ALREADY_ENTERED=1400122]="ERR_CLIENT_ALREADY_ENTERED",e[e.ERR_SEND_ENDPOINT_CANNOT_ATTACH=1400123]="ERR_SEND_ENDPOINT_CANNOT_ATTACH",e[e.ERR_PARTICIPANT_ALREADY_HAS_SEND_ENDPOINT=1400124]="ERR_PARTICIPANT_ALREADY_HAS_SEND_ENDPOINT",e[e.ERR_ROOM_DELETED=1400126]="ERR_ROOM_DELETED",e[e.ERR_CALL_NOT_CONNECTED_YET=1800610]="ERR_CALL_NOT_CONNECTED_YET",e[e.ERR_WRONG_RECORDING_TYPE_FOR_AUDIO_CALL=1800611]="ERR_WRONG_RECORDING_TYPE_FOR_AUDIO_CALL",e[e.ERR_RECORDING_ALREADY_IN_PROGRESS=1800612]="ERR_RECORDING_ALREADY_IN_PROGRESS",e[e.ERR_FAILED_TO_OPEN_FILE=1800613]="ERR_FAILED_TO_OPEN_FILE",e[e.ERR_FAILED_TO_START_RECORDING=1800614]="ERR_FAILED_TO_START_RECORDING",e[e.ERR_FAILED_TO_STOP_RECORDING=1800615]="ERR_FAILED_TO_STOP_RECORDING",e[e.ERR_NOT_SUPPORTED_BROWSER_FOR_RECORDING=1800616]="ERR_NOT_SUPPORTED_BROWSER_FOR_RECORDING",e[e.ERR_INVALID_RECORDING_TYPE=1800617]="ERR_INVALID_RECORDING_TYPE",e[e.ERR_NOT_SUPPORTED_OS_VERSION_FOR_RECORDING=1800618]="ERR_NOT_SUPPORTED_OS_VERSION_FOR_RECORDING",e[e.ERR_SCREEN_SHARE_RESTRICTED_FROM_AUDIO_CALL=1800620]="ERR_SCREEN_SHARE_RESTRICTED_FROM_AUDIO_CALL",e[e.ERR_SCREEN_SHARE_REQUEST_BEFORE_CALL_IS_CONNECTED=1800621]="ERR_SCREEN_SHARE_REQUEST_BEFORE_CALL_IS_CONNECTED",e[e.ERR_SCREEN_SHARE_ALREADY_IN_PROGRESS=1800622]="ERR_SCREEN_SHARE_ALREADY_IN_PROGRESS",e[e.ERR_NO_SCREEN_SHARE_EXISTS=1800623]="ERR_NO_SCREEN_SHARE_EXISTS",e[e.ERR_NOT_SUPPORTED_BROWSER_FOR_SCREEN_SHARE=1800625]="ERR_NOT_SUPPORTED_BROWSER_FOR_SCREEN_SHARE",e[e.ERR_SCREEN_SHARE_FAILED_DUE_TO_UNKNOWN_REASON=1800626]="ERR_SCREEN_SHARE_FAILED_DUE_TO_UNKNOWN_REASON",e[e.ERR_NOT_SUPPORTED_APP_STATE_FOR_SCREEN_SHARE=1800627]="ERR_NOT_SUPPORTED_APP_STATE_FOR_SCREEN_SHARE",e[e.ERR_PERMISSION_DENIED_FOR_SCREEN_SHARE=1800628]="ERR_PERMISSION_DENIED_FOR_SCREEN_SHARE",e[e.ERR_SELECTED_CONTENT_NOT_EXIST=1800629]="ERR_SELECTED_CONTENT_NOT_EXIST",e[e.ERR_SELECTED_CONTENT_INACCESSIBLE=1800630]="ERR_SELECTED_CONTENT_INACCESSIBLE",e[e.ERR_MEDIA_STREAM_NOT_ALLOWED_ON_HOLD=1800631]="ERR_MEDIA_STREAM_NOT_ALLOWED_ON_HOLD",e[e.ERR_CALL_ALREADY_ON_HOLD=1800801]="ERR_CALL_ALREADY_ON_HOLD",e[e.ERR_ACTIVE_CALL_IN_PROGRESS=1800802]="ERR_ACTIVE_CALL_IN_PROGRESS",e[e.ERR_ANOTHER_CALL_IN_PROGRESS=1800803]="ERR_ANOTHER_CALL_IN_PROGRESS"}(Ln||(Ln={}));var Rr,Cr,Ir=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"getErrorMessage",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).invalidParameter,n=void 0===t?"":t;switch(e){case Ln.DIAL_CANCELED:return"Call canceled before receiving a callback.";case Ln.MY_USER_ID_NOT_ALLOWED:return"The caller can't dial their own user ID.";case Ln.ERR_REQUEST_FAILED:return"The http request failed.";case Ln.ERR_WEBSOCKET_CONNECTION_NOT_OPENED:return"Websocket connection not established.";case Ln.ERR_WEBSOCKET_CONNECTION_FAILED:return"Websocket connection failed.";case Ln.ERR_NO_RESPONSE_DUE_TO_TIMEOUT:return"The request failed to receive a response due to timeout.";case Ln.ERR_REQUEST_FAILED_DUE_TO_WEBSOCKET_CONNECTION_LOST:return"The request failed because the websocket connection is lost.";case Ln.ERR_WRONG_RESPONSE:return"The response contains an unexpected object type of data.";case Ln.ERR_QUERY_IN_PROGRESS:return"The previous query is still in progress.";case Ln.INTERNAL_SERVER_ERROR:return"An internal server error has occurred.";case Ln.ERR_MALFORMED_DATA:return"The data format of the response is invalid.";case Ln.INVALID_PARAMETER_VALUE:return"".concat(n," is an invalid or empty value.");case Ln.INVALID_PARAMETER_TYPE:return"The data type of ".concat(n," is invalid.");case Ln.INSTANCE_NOT_INITIALIZED:return"SendBirdCall instance not initialized.";case Ln.USER_NOT_AUTHENTICATED:return"The user is not authenticated.";case Ln.CAMERA_ALREADY_SWITCHING:return"Camera is already switching.";case Ln.ERR_CAMERA_SWITCH:return"A camera switch error has occurred.";case Ln.ERR_CHANGING_AUDIO_DEVICE:return"An error occurred while changing audio device.";case Ln.ERR_CAPTURE_NOT_ALLOWED_ON_AUDIO_CALL:return"Capturing a video view isn't allowed while on an audio call.";case Ln.ERR_VIDEO_VIEW_NOT_READY:return"A video view isn't ready to be captured.";case Ln.ERR_VIDEO_CALL_NOT_CONNECTED_YET:return"A video call isn't connected yet therefore can't capture a video view.";case Ln.ERR_FAILED_TO_GET_IMAGE_FROM_VIDEO_STREAM:return"An error occurred while getting an image form the video stream.";case Ln.ERR_ROOM_MAX_PARTICIPANTS:return"The room has reached max participants.";case Ln.ERR_INVALID_ROOM_PARTICIPANT:return"The room participant argument is not valid.";case Ln.ERR_CLIENT_ALREADY_ENTERED:return"The given client is already entered.";case Ln.ERR_SEND_ENDPOINT_CANNOT_ATTACH:return"The send endpoint failed to attach.";case Ln.ERR_PARTICIPANT_ALREADY_HAS_SEND_ENDPOINT:return"The given participant already has send endpoint.";case Ln.ERR_CALL_NOT_CONNECTED_YET:return"A call isnât connected yet therefore canât start media recording.";case Ln.ERR_WRONG_RECORDING_TYPE_FOR_AUDIO_CALL:return"A wrong recording type is selected in an audio call.";case Ln.ERR_RECORDING_ALREADY_IN_PROGRESS:return"An ongoing recording session is already in progress.";case Ln.ERR_FAILED_TO_OPEN_FILE:return"Couldn't open a recording file due to an error.";case Ln.ERR_FAILED_TO_START_RECORDING:return"Couldn't start a recording session due to an error.";case Ln.ERR_FAILED_TO_STOP_RECORDING:return"Coudln't stop a recording session due to an error.";case Ln.ERR_NOT_SUPPORTED_BROWSER_FOR_RECORDING:return"The browser doesn't support media recording.";case Ln.ERR_INVALID_RECORDING_TYPE:return"Invalid recording type is selected.";case Ln.ERR_NOT_SUPPORTED_OS_VERSION_FOR_RECORDING:return"The operating system version doesn't support media recording.";case Ln.ERR_SCREEN_SHARE_RESTRICTED_FROM_AUDIO_CALL:return"Screen share is restricted from audio calls.";case Ln.ERR_SCREEN_SHARE_REQUEST_BEFORE_CALL_IS_CONNECTED:return"A call isn't connected yet, but the request for screen share has been made.";case Ln.ERR_SCREEN_SHARE_ALREADY_IN_PROGRESS:return"The user is trying to share the screen while the previous request is still in progress.";case Ln.ERR_MEDIA_STREAM_NOT_ALLOWED_ON_HOLD:return"Screen sharing or any other actions that need media streaming as well as capturing screen aren't allowed while a call is on hold.";case Ln.ERR_NOT_SUPPORTED_BROWSER_FOR_SCREEN_SHARE:return"The browser doesn't support screen share.";case Ln.ERR_SCREEN_SHARE_FAILED_DUE_TO_UNKNOWN_REASON:return"Screen share failed due to unknown reason.";case Ln.ERR_NOT_SUPPORTED_APP_STATE_FOR_SCREEN_SHARE:return"The application state isn't supported for screen share.";case Ln.ERR_PERMISSION_DENIED_FOR_SCREEN_SHARE:return"An access permission denied for screen share.";case Ln.ERR_SELECTED_CONTENT_NOT_EXIST:return"The selected content for screen share doesn't exist.";case Ln.ERR_SELECTED_CONTENT_INACCESSIBLE:return"The selected content for screen share is inaccessible by the system.";case Ln.ERR_PARTICIPANT_ALREADY_IN_ROOM:return"The participant is trying to enter the same room they're already in.";case Ln.ERR_ENTERING_ROOM_STILL_IN_PROGRESS:return"The participant is trying to enter the room while the previous request is still in progress.";case Ln.ERR_PARTICIPANT_NOT_IN_ROOM:return"The participant is not in the room and the request can't be processed.";case Ln.ERR_EXITING_ROOM_STILL_IN_PROGRESS:return"The participant is trying to exit the same room.";case Ln.ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_SEND_STREAM:return"Couldn't establish a connection to send media streaming.";case Ln.ERR_FAILED_TO_ESTABLISH_CONNECTION_TO_RECEIVE_STREAM:return"Couldn't establish a connection to receive media streaming.";case Ln.ERR_LOCAL_PARTICIPANT_LOST_CONNECTION:return"The local participant exited the room due to lost connection.";case Ln.ERR_LOCAL_PARTICIPANT_KICKED_OUT:return"An existing participant has been disconnected from the room because a new participant entered with the same user ID.";case Ln.ERR_CALL_ALREADY_ON_HOLD:return"The call is already on hold.";case Ln.ERR_ACTIVE_CALL_IN_PROGRESS:return"The active call is in progress. Cannot remove the active call from a hold because the call is not on hold.";case Ln.ERR_ANOTHER_CALL_IN_PROGRESS:return"The active call is in progress. Cannot remove a hold from another call while there is an active call.";default:return""}}}]),e}(),wr=function(e,t,n){var r=y(t);r in e?b.f(e,r,u(0,n)):e[r]=n},Ar=re("navigator","userAgent")||"",Tr=r.process,br=Tr&&Tr.versions,Sr=br&&br.v8;Sr?Cr=(Rr=Sr.split("."))[0]+Rr[1]:Ar&&(!(Rr=Ar.match(/Edge\/(\d+)/))||Rr[1]>=74)&&(Rr=Ar.match(/Chrome\/(\d+)/))&&(Cr=Rr[1]);var Or=Cr&&+Cr,Dr=Ge("species"),Nr=function(e){return Or>=51||!i((function(){var t=[];return(t.constructor={})[Dr]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Lr=Ge("isConcatSpreadable"),Pr=9007199254740991,xr="Maximum allowed index exceeded",Mr=Or>=51||!i((function(){var e=[];return e[Lr]=!1,e.concat()[0]!==e})),Ur=Nr("concat"),Vr=function(e){if(!p(e))return!1;var t=e[Lr];return void 0!==t?!!t:Pe(e)};Oe({target:"Array",proto:!0,forced:!Mr||!Ur},{concat:function(e){var t,n,r,i,a,o=Le(this),s=je(o,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(Vr(a=-1===t?o:arguments[t])){if(c+(i=ce(a.length))>Pr)throw TypeError(xr);for(n=0;n<i;n++,c++)n in a&&wr(s,c,a[n])}else{if(c>=Pr)throw TypeError(xr);wr(s,c++,a)}return s.length=c,s}});var Fr=ze.map,Gr=Nr("map"),Br=Qe("map");Oe({target:"Array",proto:!0,forced:!Gr||!Br},{map:function(e){return Fr(this,e,arguments.length>1?arguments[1]:void 0)}});var jr=function(){var e=A(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},qr="toString",Hr=RegExp.prototype,zr=Hr[qr],Wr=i((function(){return"/a/b"!=zr.call({source:"a",flags:"b"})})),Kr=zr.name!=qr;(Wr||Kr)&&ee(RegExp.prototype,qr,(function(){var e=A(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in Hr)?jr.call(e):n)}),{unsafe:!0});var Yr,Zr="".repeat||function(e){var t=String(_(this)),n="",r=oe(e);if(r<0||r==1/0)throw RangeError("Wrong number of repetitions");for(;r>0;(r>>>=1)&&(t+=t))1&r&&(n+=t);return n},Qr=Math.ceil,Xr=function(e){return function(t,n,r){var i,a,o=String(_(t)),s=o.length,c=void 0===r?" ":String(r),u=ce(n);return u<=s||""==c?o:(i=u-s,(a=Zr.call(c,Qr(i/c.length))).length>i&&(a=a.slice(0,i)),e?o+a:a+o)}},$r={start:Xr(!1),end:Xr(!0)},Jr=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(Ar),ei=$r.start;Oe({target:"String",proto:!0,forced:Jr},{padStart:function(e){return ei(this,e,arguments.length>1?arguments[1]:void 0)}}),function(e){e.VERBOSE="VERBOSE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.NONE="NONE"}(Yr||(Yr={}));var ti={VERBOSE:{level:-1,name:Yr.VERBOSE,public:!1},DEBUG:{level:1,name:Yr.DEBUG,public:!1},INFO:{level:2,name:Yr.INFO,public:!0},WARNING:{level:3,name:Yr.WARNING,public:!0},ERROR:{level:4,name:Yr.ERROR,public:!0},NONE:{level:100,name:Yr.NONE,public:!0}},ni=ze.some,ri=We("some"),ii=Qe("some");Oe({target:"Array",proto:!0,forced:!ri||!ii},{some:function(e){return ni(this,e,arguments.length>1?arguments[1]:void 0)}});var ai=i((function(){nt(1)}));Oe({target:"Object",stat:!0,forced:ai},{keys:function(e){return nt(Le(e))}});var oi,si,ci,ui=r.Promise,li=Ge("species"),di=function(e,t){var n,r=A(e).constructor;return void 0===r||null==(n=A(r)[li])?t:De(n)},hi=/(iphone|ipod|ipad).*applewebkit/i.test(Ar),fi="process"==d(r.process),_i=r.location,vi=r.setImmediate,pi=r.clearImmediate,yi=r.process,mi=r.MessageChannel,gi=r.Dispatch,Ei=0,ki={},Ri="onreadystatechange",Ci=function(e){if(ki.hasOwnProperty(e)){var t=ki[e];delete ki[e],t()}},Ii=function(e){return function(){Ci(e)}},wi=function(e){Ci(e.data)},Ai=function(e){r.postMessage(e+"",_i.protocol+"//"+_i.host)};vi&&pi||(vi=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return ki[++Ei]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},oi(Ei),Ei},pi=function(e){delete ki[e]},fi?oi=function(e){yi.nextTick(Ii(e))}:gi&&gi.now?oi=function(e){gi.now(Ii(e))}:mi&&!hi?(ci=(si=new mi).port2,si.port1.onmessage=wi,oi=Ne(ci.postMessage,ci,1)):r.addEventListener&&"function"==typeof postMessage&&!r.importScripts&&_i&&"file:"!==_i.protocol&&!i(Ai)?(oi=Ai,r.addEventListener("message",wi,!1)):oi=Ri in R("script")?function(e){it.appendChild(R("script"))[Ri]=function(){it.removeChild(this),Ci(e)}}:function(e){setTimeout(Ii(e),0)});var Ti,bi,Si,Oi,Di,Ni,Li,Pi,xi={set:vi,clear:pi},Mi=w.f,Ui=xi.set,Vi=r.MutationObserver||r.WebKitMutationObserver,Fi=r.document,Gi=r.process,Bi=r.Promise,ji=Mi(r,"queueMicrotask"),qi=ji&&ji.value;qi||(Ti=function(){var e,t;for(fi&&(e=Gi.domain)&&e.exit();bi;){t=bi.fn,bi=bi.next;try{t()}catch(e){throw bi?Oi():Si=void 0,e}}Si=void 0,e&&e.enter()},!hi&&!fi&&Vi&&Fi?(Di=!0,Ni=Fi.createTextNode(""),new Vi(Ti).observe(Ni,{characterData:!0}),Oi=function(){Ni.data=Di=!Di}):Bi&&Bi.resolve?(Li=Bi.resolve(void 0),Pi=Li.then,Oi=function(){Pi.call(Li,Ti)}):Oi=fi?function(){Gi.nextTick(Ti)}:function(){Ui.call(r,Ti)});var Hi,zi,Wi,Ki,Yi=qi||function(e){var t={fn:e,next:void 0};Si&&(Si.next=t),bi||(bi=t,Oi()),Si=t},Zi=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=De(t),this.reject=De(n)},Qi={f:function(e){return new Zi(e)}},Xi=function(e,t){if(A(e),p(t)&&t.constructor===e)return t;var n=Qi.f(e);return(0,n.resolve)(t),n.promise},$i=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Ji=xi.set,ea=Ge("species"),ta="Promise",na=J.get,ra=J.set,ia=J.getterFor(ta),aa=ui,oa=r.TypeError,sa=r.document,ca=r.process,ua=re("fetch"),la=Qi.f,da=la,ha=!!(sa&&sa.createEvent&&r.dispatchEvent),fa="function"==typeof PromiseRejectionEvent,_a="unhandledrejection",va=be(ta,(function(){if(!(U(aa)!==String(aa))){if(66===Or)return!0;if(!fi&&!fa)return!0}if(Or>=51&&/native code/.test(aa))return!1;var e=aa.resolve(1),t=function(e){e((function(){}),(function(){}))};return(e.constructor={})[ea]=t,!(e.then((function(){}))instanceof t)})),pa=va||!hn((function(e){aa.all(e).catch((function(){}))})),ya=function(e){var t;return!(!p(e)||"function"!=typeof(t=e.then))&&t},ma=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;Yi((function(){for(var r=e.value,i=1==e.state,a=0;n.length>a;){var o,s,c,u=n[a++],l=i?u.ok:u.fail,d=u.resolve,h=u.reject,f=u.domain;try{l?(i||(2===e.rejection&&Ra(e),e.rejection=1),!0===l?o=r:(f&&f.enter(),o=l(r),f&&(f.exit(),c=!0)),o===u.promise?h(oa("Promise-chain cycle")):(s=ya(o))?s.call(o,d,h):d(o)):h(r)}catch(e){f&&!c&&f.exit(),h(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Ea(e)}))}},ga=function(e,t,n){var i,a;ha?((i=sa.createEvent("Event")).promise=t,i.reason=n,i.initEvent(e,!1,!0),r.dispatchEvent(i)):i={promise:t,reason:n},!fa&&(a=r["on"+e])?a(i):e===_a&&function(e,t){var n=r.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},Ea=function(e){Ji.call(r,(function(){var t,n=e.facade,r=e.value;if(ka(e)&&(t=$i((function(){fi?ca.emit("unhandledRejection",r,n):ga(_a,n,r)})),e.rejection=fi||ka(e)?2:1,t.error))throw t.value}))},ka=function(e){return 1!==e.rejection&&!e.parent},Ra=function(e){Ji.call(r,(function(){var t=e.facade;fi?ca.emit("rejectionHandled",t):ga("rejectionhandled",t,e.value)}))},Ca=function(e,t,n){return function(r){e(t,r,n)}},Ia=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,ma(e,!0))},wa=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw oa("Promise can't be resolved itself");var r=ya(t);r?Yi((function(){var n={done:!1};try{r.call(t,Ca(wa,n,e),Ca(Ia,n,e))}catch(t){Ia(n,t,e)}})):(e.value=t,e.state=1,ma(e,!1))}catch(t){Ia({done:!1},t,e)}}};function Aa(e,t){return RegExp(e,t)}va&&(aa=function(e){sn(this,aa,ta),De(e),Hi.call(this);var t=na(this);try{e(Ca(wa,t),Ca(Ia,t))}catch(e){Ia(t,e)}},(Hi=function(e){ra(this,{type:ta,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=_n(aa.prototype,{then:function(e,t){var n=ia(this),r=la(di(this,aa));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=fi?ca.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&ma(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}}),zi=function(){var e=new Hi,t=na(e);this.promise=e,this.resolve=Ca(wa,t),this.reject=Ca(Ia,t)},Qi.f=la=function(e){return e===aa||e===Wi?new zi(e):da(e)},"function"==typeof ui&&(Ki=ui.prototype.then,ee(ui.prototype,"then",(function(e,t){var n=this;return new aa((function(e,t){Ki.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof ua&&Oe({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return Xi(aa,ua.apply(r,arguments))}}))),Oe({global:!0,wrap:!0,forced:va},{Promise:aa}),bt(aa,ta,!1),pn(ta),Wi=re(ta),Oe({target:ta,stat:!0,forced:va},{reject:function(e){var t=la(this);return t.reject.call(void 0,e),t.promise}}),Oe({target:ta,stat:!0,forced:va},{resolve:function(e){return Xi(this,e)}}),Oe({target:ta,stat:!0,forced:pa},{all:function(e){var t=this,n=la(t),r=n.resolve,i=n.reject,a=$i((function(){var n=De(t.resolve),a=[],o=0,s=1;on(e,(function(e){var c=o++,u=!1;a.push(void 0),s++,n.call(t,e).then((function(e){u||(u=!0,a[c]=e,--s||r(a))}),i)})),--s||r(a)}));return a.error&&i(a.value),n.promise},race:function(e){var t=this,n=la(t),r=n.reject,i=$i((function(){var i=De(t.resolve);on(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var Ta,ba,Sa={UNSUPPORTED_Y:i((function(){var e=Aa("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:i((function(){var e=Aa("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Oa=RegExp.prototype.exec,Da=String.prototype.replace,Na=Oa,La=(Ta=/a/,ba=/b*/g,Oa.call(Ta,"a"),Oa.call(ba,"a"),0!==Ta.lastIndex||0!==ba.lastIndex),Pa=Sa.UNSUPPORTED_Y||Sa.BROKEN_CARET,xa=void 0!==/()??/.exec("")[1];(La||xa||Pa)&&(Na=function(e){var t,n,r,i,a=this,o=Pa&&a.sticky,s=jr.call(a),c=a.source,u=0,l=e;return o&&(-1===(s=s.replace("y","")).indexOf("g")&&(s+="g"),l=String(e).slice(a.lastIndex),a.lastIndex>0&&(!a.multiline||a.multiline&&"\n"!==e[a.lastIndex-1])&&(c="(?: "+c+")",l=" "+l,u++),n=new RegExp("^(?:"+c+")",s)),xa&&(n=new RegExp("^"+c+"$(?!\\s)",s)),La&&(t=a.lastIndex),r=Oa.call(o?n:a,l),o?r?(r.input=r.input.slice(u),r[0]=r[0].slice(u),r.index=a.lastIndex,a.lastIndex+=r[0].length):a.lastIndex=0:La&&r&&(a.lastIndex=a.global?r.index+r[0].length:t),xa&&r&&r.length>1&&Da.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var Ma=Na;Oe({target:"RegExp",proto:!0,forced:/./.exec!==Ma},{exec:Ma});var Ua=Ge("species"),Va=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Fa="$0"==="a".replace(/./,"$0"),Ga=Ge("replace"),Ba=!!/./[Ga]&&""===/./[Ga]("a","$0"),ja=!i((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]})),qa=function(e,t,n,r){var a=Ge(e),o=!i((function(){var t={};return t[a]=function(){return 7},7!=""[e](t)})),s=o&&!i((function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[Ua]=function(){return n},n.flags="",n[a]=/./[a]),n.exec=function(){return t=!0,null},n[a](""),!t}));if(!o||!s||"replace"===e&&(!Va||!Fa||Ba)||"split"===e&&!ja){var c=/./[a],u=n(a,""[e],(function(e,t,n,r,i){return t.exec===Ma?o&&!i?{done:!0,value:c.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Fa,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Ba}),l=u[0],d=u[1];ee(String.prototype,e,l),ee(RegExp.prototype,a,2==t?function(e,t){return d.call(e,this,t)}:function(e){return d.call(e,this)})}r&&S(RegExp.prototype[a],"sham",!0)},Ha=In.charAt,za=function(e,t,n){return t+(n?Ha(e,t).length:1)},Wa=function(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==d(e))throw TypeError("RegExp#exec called on incompatible receiver");return Ma.call(e,t)};qa("match",1,(function(e,t,n){return[function(t){var n=_(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;var i=A(e),a=String(this);if(!i.global)return Wa(i,a);var o=i.unicode;i.lastIndex=0;for(var s,c=[],u=0;null!==(s=Wa(i,a));){var l=String(s[0]);c[u]=l,""===l&&(i.lastIndex=za(a,ce(i.lastIndex),o)),u++}return 0===u?null:c}]}));var Ka=Math.max,Ya=Math.min,Za=Math.floor,Qa=/\$([$&'`]|\d\d?|<[^>]*>)/g,Xa=/\$([$&'`]|\d\d?)/g;qa("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,a=r.REPLACE_KEEPS_$0,o=i?"$":"$0";return[function(n,r){var i=_(this),a=null==n?void 0:n[e];return void 0!==a?a.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&a||"string"==typeof r&&-1===r.indexOf(o)){var c=n(t,e,this,r);if(c.done)return c.value}var u=A(e),l=String(this),d="function"==typeof r;d||(r=String(r));var h=u.global;if(h){var f=u.unicode;u.lastIndex=0}for(var _=[];;){var v=Wa(u,l);if(null===v)break;if(_.push(v),!h)break;""===String(v[0])&&(u.lastIndex=za(l,ce(u.lastIndex),f))}for(var p,y="",m=0,g=0;g<_.length;g++){v=_[g];for(var E=String(v[0]),k=Ka(Ya(oe(v.index),l.length),0),R=[],C=1;C<v.length;C++)R.push(void 0===(p=v[C])?p:String(p));var I=v.groups;if(d){var w=[E].concat(R,k,l);void 0!==I&&w.push(I);var T=String(r.apply(void 0,w))}else T=s(E,l,k,R,I,r);k>=m&&(y+=l.slice(m,k)+T,m=k+E.length)}return y+l.slice(m)}];function s(e,n,r,i,a,o){var s=r+e.length,c=i.length,u=Xa;return void 0!==a&&(a=Le(a),u=Qa),t.call(o,u,(function(t,o){var u;switch(o.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,r);case"'":return n.slice(s);case"<":u=a[o.slice(1,-1)];break;default:var l=+o;if(0===l)return t;if(l>c){var d=Za(l/10);return 0===d?t:d<=c?void 0===i[d-1]?o.charAt(1):i[d-1]+o.charAt(1):t}u=i[l-1]}return void 0===u?"":u}))}}));var $a=function(e){Qn(n,e);var t=ir(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=i.message,o=i.error,s=nr(i,["message","error"]);Hn(this,n);var c=a||Ir.getErrorMessage(e,s);return(r=t.call(this,c)).code=e,r._error=o,r}return n}(tr(Error)),Ja=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}($a);function eo(e){return function(t){e.then((function(e){return t(e)}),(function(e){return t(null,e)}))}}var to,no,ro=function(e,t){if(Object.keys(e).some((function(t){return"string"!=typeof e[t]}))){var n=Promise.reject(new Ja(Ln.INVALID_PARAMETER_TYPE));return t&&eo(n)(t),[!1,n]}return[!0]},io=function(e,t){if(e.some((function(e){return"string"!=typeof e}))){var n=Promise.reject(new Ja(Ln.INVALID_PARAMETER_TYPE));return t&&eo(n)(t),[!1,n]}return[!0]},ao=function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},oo=function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;var t=window.navigator;if(t.mozGetUserMedia)e.browser="firefox",e.version=ao(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===window.isSecureContext&&window.webkitRTCPeerConnection&&!window.RTCIceGatherer)e.browser="chrome",e.version=ao(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=ao(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!window.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=ao(t.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=window.RTCRtpTransceiver&&"currentDirection"in window.RTCRtpTransceiver.prototype}return e},so="safari"===oo().browser,co="firefox"===oo().browser,uo=function(e){return e.replace(/"access_token":".*?"/gm,'"access_token":"*************"').replace(/"password":".*?"/gm,'"password":"*************"').replace(/"sbcall_session_token":".*?"/gm,'"sbcall_session_token":"*************"').replace(/"turn_urls":\[".*?"\]/gm,'"turn_urls":"[*************]"').replace(/(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)/gm,"*************").replace(/((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}/gm,"*************")},lo=function(e){return{userId:e.user_id,nickname:e.nickname,profileUrl:e.profile_url,metaData:e.metadata,isActive:e.is_active}},ho=function(){function e(){Hn(this,e),this.level=Yr.NONE}return Wn(e,[{key:"setLoggerLevel",value:function(e){var t;return null!==(t=ti[e])&&void 0!==t&&t.public&&(this.level=e),this.level}},{key:"verbose",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._permit.apply(this,[Yr.VERBOSE].concat(t))}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._permit.apply(this,[Yr.DEBUG].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._permit.apply(this,[Yr.INFO].concat(t))}},{key:"warning",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._permit.apply(this,[Yr.WARNING].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._permit.apply(this,[Yr.ERROR].concat(t))}},{key:"_enabledFor",value:function(e){try{return ti[this.level].level<=ti[e].level}catch(e){return!1}}},{key:"_getLogType",value:function(e){switch(e){case Yr.ERROR:return"error";case Yr.WARNING:return"warn";default:return"log"}}},{key:"_getTimeString",value:function(e){var t=e.getFullYear().toString().padStart(2,"0"),n=(e.getMonth()+1).toString().padStart(2,"0"),r=e.getDate().toString().padStart(2,"0"),i=e.getHours().toString().padStart(2,"0"),a=e.getMinutes().toString().padStart(2,"0"),o=e.getSeconds().toString().padStart(2,"0"),s=e.getMilliseconds().toString().padStart(2,"0");return"[".concat(t,".").concat(n,".").concat(r," ").concat(i,":").concat(a,":").concat(o,":").concat(s,"]")}},{key:"_permit",value:function(e){for(var t=this._getLogType(e),n=new Date,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];if(this._enabledFor(e)&&console&&console[t]){var o,s="".concat(this._getTimeString(n)," [").concat(e,"]");(o=console)[t].apply(o,[s].concat(i))}if(this._logCollector){var c={logDt:n.getTime(),logLevel:e,logMessage:this._makeSDKLogMessage.apply(this,i)};this._logCollector.addLog(c)}}},{key:"_makeSDKLogMessage",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.map((function(e){return JSON.stringify(e)}));return uo(r.toString())}},{key:"logCollector",set:function(e){this._logCollector=e}}]),e}(),fo=new ho,_o=function(){if(!navigator.mediaDevices.getDisplayMedia){var e=Ir.getErrorMessage(Ln.ERR_NOT_SUPPORTED_BROWSER_FOR_SCREEN_SHARE);throw fo.error(e),e}},vo=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}($a),po=function(){function e(t){Hn(this,e);var n=Zn(Zn({},e.default),t);this.localMediaView=n.localMediaView,this.remoteMediaView=n.remoteMediaView,this.videoEnabled=n.videoEnabled,this.audioEnabled=n.audioEnabled,this.videoWidth=n.videoWidth,this.videoHeight=n.videoHeight,this.videoFps=n.videoFps,this.frontCamera=n.frontCamera}return Wn(e,null,[{key:"default",get:function(){return{localMediaView:null,remoteMediaView:null,audioEnabled:!0,videoEnabled:!0,videoWidth:null,videoHeight:null,videoFps:null,frontCamera:!0}}}]),e}();!function(e){e.NO_ANSWER="no_answer",e.CANCELED="canceled",e.DECLINED="declined",e.OTHER_DEVICE_ACCEPTED="other_device_accepted",e.COMPLETED="completed",e.CONNECTION_LOST="connection_lost",e.TIMED_OUT="timed_out",e.DIAL_FAILED="dial_failed",e.ACCEPT_FAILED="accept_failed",e.UNKNOWN="unknown"}(to||(to={})),function(e){e.CALLER="dc_caller",e.CALLEE="dc_callee"}(no||(no={}));var yo=Math.min,mo=[].lastIndexOf,go=!!mo&&1/[1].lastIndexOf(1,-0)<0,Eo=We("lastIndexOf"),ko=Qe("indexOf",{ACCESSORS:!0,1:0}),Ro=go||!Eo||!ko?function(e){if(go)return mo.apply(this,arguments)||0;var t=v(this),n=ce(t.length),r=n-1;for(arguments.length>1&&(r=yo(r,oe(arguments[1]))),r<0&&(r=n+r);r>=0;r--)if(r in t&&t[r]===e)return r||0;return-1}:mo;Oe({target:"Array",proto:!0,forced:Ro!==[].lastIndexOf},{lastIndexOf:Ro});var Co,Io=Ge("match"),wo=function(e){var t;return p(e)&&(void 0!==(t=e[Io])?!!t:"RegExp"==d(e))},Ao=[].push,To=Math.min,bo=4294967295,So=!i((function(){return!RegExp(bo,"y")}));qa("split",2,(function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var r=String(_(this)),i=void 0===n?bo:n>>>0;if(0===i)return[];if(void 0===e)return[r];if(!wo(e))return t.call(r,e,i);for(var a,o,s,c=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,u+"g");(a=Ma.call(d,r))&&!((o=d.lastIndex)>l&&(c.push(r.slice(l,a.index)),a.length>1&&a.index<r.length&&Ao.apply(c,a.slice(1)),s=a[0].length,l=o,c.length>=i));)d.lastIndex===a.index&&d.lastIndex++;return l===r.length?!s&&d.test("")||c.push(""):c.push(r.slice(l)),c.length>i?c.slice(0,i):c}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=_(this),a=null==t?void 0:t[e];return void 0!==a?a.call(t,i,n):r.call(String(i),t,n)},function(e,i){var a=n(r,e,this,i,r!==t);if(a.done)return a.value;var o=A(e),s=String(this),c=di(o,RegExp),u=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(So?"y":"g"),d=new c(So?o:"^(?:"+o.source+")",l),h=void 0===i?bo:i>>>0;if(0===h)return[];if(0===s.length)return null===Wa(d,s)?[s]:[];for(var f=0,_=0,v=[];_<s.length;){d.lastIndex=So?_:0;var p,y=Wa(d,So?s:s.slice(_));if(null===y||(p=To(ce(d.lastIndex+(So?0:_)),s.length))===f)_=za(s,_,u);else{if(v.push(s.slice(f,_)),v.length===h)return v;for(var m=1;m<=y.length-1;m++)if(v.push(y[m]),v.length===h)return v;_=f=p}}return v.push(s.slice(f)),v}]}),!So),function(e){e.REMOTE_AUDIO_AND_VIDEO="remote_audio_and_video",e.REMOTE_AUDIO_ONLY="remote_audio_only",e.LOCAL_REMOTE_AUDIOS="local_remote_audios",e.LOCAL_AUDIO_REMOTE_AUDIO_AND_VIDEO="local_audio_remote_audio_and_video",e.LOCAL_AUDIO_AND_VIDEO_REMOTE_AUDIO="local_audio_and_video_remote_audio"}(Co||(Co={}));var Oo=function(){function e(t){if(Hn(this,e),this.recordingType=t.recordingType,this.callId=t.callId,t.fileName){var n=so?"mp4":"webm";t.fileName.toLocaleLowerCase().split(".").reverse()[0]!==n?this.fileName="".concat(t.fileName,".").concat(n):this.fileName=t.fileName}else this.fileName=e.defaultFileName(this.recordingType,this.callId)}return Wn(e,[{key:"isVideo",get:function(){return this.recordingType===Co.LOCAL_AUDIO_AND_VIDEO_REMOTE_AUDIO||this.recordingType===Co.LOCAL_AUDIO_REMOTE_AUDIO_AND_VIDEO||this.recordingType===Co.REMOTE_AUDIO_AND_VIDEO}}],[{key:"defaultFileName",value:function(e,t){var n=new Date(Date.now()-6e4*(new Date).getTimezoneOffset()).toISOString(),r=(n=n.replace(/-|:/g,"")).lastIndexOf(".");return"".concat(e,"_").concat(t,"_").concat(n.substring(0,r)).concat(so?".mp4":".webm")}}]),e}(),Do=Object.assign,No=Object.defineProperty,Lo=!Do||i((function(){if(a&&1!==Do({b:1},Do(No({},"a",{enumerable:!0,get:function(){No(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=Do({},e)[n]||nt(Do({},t)).join("")!=r}))?function(e,t){for(var n=Le(e),r=arguments.length,i=1,o=ge.f,s=c.f;r>i;)for(var u,l=f(arguments[i++]),d=o?nt(l).concat(o(l)):nt(l),h=d.length,_=0;h>_;)u=d[_++],a&&!s.call(l,u)||(n[u]=l[u]);return n}:Do;Oe({target:"Object",stat:!0,forced:Object.assign!==Lo},{assign:Lo});t((function(e){var t=function(e){var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof p?t:p,a=Object.create(i.prototype),o=new b(r||[]);return a._invoke=function(e,t,n){var r=d;return function(i,a){if(r===f)throw new Error("Generator is already running");if(r===_){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=w(o,n);if(s){if(s===v)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=l(e,t,n);if("normal"===c.type){if(r=n.done?_:h,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=_,n.method="throw",n.arg=c.arg)}}}(e,n,o),a}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var d="suspendedStart",h="suspendedYield",f="executing",_="completed",v={};function p(){}function y(){}function m(){}var g={};g[a]=function(){return this};var E=Object.getPrototypeOf,k=E&&E(E(S([])));k&&k!==n&&r.call(k,a)&&(g=k);var R=m.prototype=p.prototype=Object.create(g);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(i,a,o,s){var c=l(e[i],e,a);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(c.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function w(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,w(e,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var i=l(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,v;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function A(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function b(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(A,this),this.reset(!0)}function S(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:O}}function O(){return{value:t,done:!0}}return y.prototype=R.constructor=m,m.constructor=y,y.displayName=c(m,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,c(e,s,"GeneratorFunction")),e.prototype=Object.create(R),e},e.awrap=function(e){return{__await:e}},C(I.prototype),I.prototype[o]=function(){return this},e.AsyncIterator=I,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new I(u(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(R),c(R,s,"Generator"),R[a]=function(){return this},R.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,b.prototype={constructor:b,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(T),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:S(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),v}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}}));var Po=Nr("slice"),xo=Qe("slice",{ACCESSORS:!0,0:0,1:2}),Mo=Ge("species"),Uo=[].slice,Vo=Math.max;Oe({target:"Array",proto:!0,forced:!Po||!xo},{slice:function(e,t){var n,r,i,a=v(this),o=ce(a.length),s=de(e,o),c=de(void 0===t?o:t,o);if(Pe(a)&&("function"!=typeof(n=a.constructor)||n!==Array&&!Pe(n.prototype)?p(n)&&null===(n=n[Mo])&&(n=void 0):n=void 0,n===Array||void 0===n))return Uo.call(a,s,c);for(r=new(void 0===n?Array:n)(Vo(c-s,0)),i=0;s<c;s++,i++)s in a&&wr(r,i,a[s]);return r.length=i,r}});var Fo=Nr("splice"),Go=Qe("splice",{ACCESSORS:!0,0:0,1:2}),Bo=Math.max,jo=Math.min,qo=9007199254740991,Ho="Maximum allowed length exceeded";Oe({target:"Array",proto:!0,forced:!Fo||!Go},{splice:function(e,t){var n,r,i,a,o,s,c=Le(this),u=ce(c.length),l=de(e,u),d=arguments.length;if(0===d?n=r=0:1===d?(n=0,r=u-l):(n=d-2,r=jo(Bo(oe(t),0),u-l)),u+n-r>qo)throw TypeError(Ho);for(i=je(c,r),a=0;a<r;a++)(o=l+a)in c&&wr(i,a,c[o]);if(i.length=r,n<r){for(a=l;a<u-r;a++)s=a+n,(o=a+r)in c?c[s]=c[o]:delete c[s];for(a=u;a>u-r+n;a--)delete c[a-1]}else if(n>r)for(a=u-r;a>l;a--)s=a+n-1,(o=a+r-1)in c?c[s]=c[o]:delete c[s];for(a=0;a<n;a++)c[a+l]=arguments[a+2];return c.length=u-r+n,i}});var zo=function(){function e(){Hn(this,e),Kn(this,"_listeners",{}),Kn(this,"on",this.addEventListener),Kn(this,"off",this.removeEventListener)}return Wn(e,[{key:"addEventListener",value:function(e,t){var n=this;return e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),function(){return n.removeEventListener(e,t)}}},{key:"once",value:function(e,t){var n=this;return this.on(e,(function r(){t.apply(void 0,arguments),n.removeEventListener(e,r)}))}},{key:"removeEventListener",value:function(e,t){if(e in this._listeners)for(var n=this._listeners[e],r=0,i=n.length;r<i;r++)if(n[r]===t)return void n.splice(r,1)}},{key:"removeAllEventListeners",value:function(){this._listeners={}}},{key:"_dispatchEvent",value:function(e){if(e in this._listeners){for(var t=this._listeners[e].slice(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var a=0,o=t.length;a<o;a++){var s;(s=t[a]).call.apply(s,[this].concat(r))}}}}]),e}(),Wo=b.f,Ko=Function.prototype,Yo=Ko.toString,Zo=/^\s*function ([^ (]*)/,Qo="name";a&&!(Qo in Ko)&&Wo(Ko,Qo,{configurable:!0,get:function(){try{return Yo.call(this).match(Zo)[1]}catch(e){return""}}});var Xo,$o=function(){function e(t){Hn(this,e),this.active=!1,this.queue=[],this.name=t}return Wn(e,[{key:"acquire",value:function(){var e=this;return new Promise((function(t){var n=function(){e.active=!0,t()};e.active?e.queue.push(n):n()}))}},{key:"release",value:function(){if(this.active){this.active=!1;var e=this.queue.shift();e&&e()}}}]),e}(),Jo=function e(){Hn(this,e)},es=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),n}(Jo),ts=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).payload=e.payload||{},r}return n}(Jo),ns=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).type=e.type,r.version=e.version,r.messageId=e.message_id,r.deliveryInfo=e.delivery_info,r.sequenceNumber=e.sequence_number,r.payload=r.parseData(e.payload),r}return Wn(n,[{key:"isSequential",value:function(){return"number"==typeof this.sequenceNumber}}]),n}(Jo),rs=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).payload=r.parseData(e),r}return n}(Jo),is=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).version=e.version,r.messageId=e.message_id,r.type=e.type,r.deliveryInfo=e.delivery_info,r.sequenceNumber=e.sequence_number,r.payload=r.parseData(e.payload),r}return Wn(n,[{key:"isSequential",value:function(){return"number"==typeof this.sequenceNumber}}]),n}(Jo),as=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).roomId=e,r}return Wn(n,[{key:"getPath",value:function(){return"/v1/rooms".concat(this.getSubPath())}}]),n}(es),os=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.roomId}}]),n}(ns),ss=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}(rs),cs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.roomId}}]),n}(is);!function(e){e.CREATE="create",e.GET="get",e.QUERY="query",e.ENTER="enter",e.EXIT="exit",e.ALIVE="alive",e.AUDIO="audio",e.VIDEO="video",e.CUSTOM_ITEMS_FETCH="custom_items_fetch",e.CUSTOM_ITEMS_UPDATE="custom_items_update",e.CUSTOM_ITEMS_DELETE="custom_items_delete",e.INVITATION_SENT="invitation_sent",e.INVITATION_CANCELED="invitation_canceled",e.INVITATION_RECEIVED="invitation_received",e.INVITATION_ACCEPTED="invitation_accepted",e.INVITATION_DECLINED="invitation_declined",e.INVITATION_OTHER_DEVICE_ACCEPTED="invitation_other_device_accepted",e.INVITATION_OTHER_DEVICE_DECLINED="invitation_other_device_declined",e.ATTACH="attach",e.CONNECTED="connected",e.DETACH="detach",e.CREATE_ENDPOINT="create_endpoint",e.PUT_ENDPOINT="put_endpoint",e.RELEASE_ENDPOINT="release_endpoint",e.ROOM_DELETED="room_deleted",e.PARTICIPANT_ENTERED="participant_entered",e.PARTICIPANT_CONNECTED="participant_connected",e.PARTICIPANT_EXITED="participant_exited",e.PARTICIPANT_DISCONNECTED="participant_disconnected",e.PARTICIPANT_AUDIO_STATUS_CHANGED="participant_audio_status_changed",e.PARTICIPANT_VIDEO_STATUS_CHANGED="participant_video_status_changed"}(Xo||(Xo={}));var us=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.ALIVE),i.participantId=r,i}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/alive")}}]),n}(as),ls=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),Kn(rr(o=t.call(this,e)),"type",Xo.ATTACH),o.participantId=r,o.endpointId=i,o.attachTo=a,o}return Wn(n,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints/").concat(this.endpointId,"/attach")}}]),n}(as),ds=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.AUDIO),a.participantId=r,a.enabled=i,a}return Wn(n,[{key:"getData",value:function(){return{on:this.enabled}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/audio")}}]),n}(as),hs=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.CONNECTED),a.participantId=r,a.endpointId=i,a}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints/").concat(this.endpointId,"/connected")}}]),n}(as),fs=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,void 0)),"type",Xo.CREATE),r.params=e,r}return Wn(n,[{key:"getData",value:function(){return{type:this.params.roomType,custom_items:this.params.customItems}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return""}}]),n}(as),_s=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),Kn(rr(o=t.call(this,e)),"type",Xo.CREATE_ENDPOINT),o.participantId=r,o.sdp=i,o.mediaDirection=a,o}return Wn(n,[{key:"getData",value:function(){return{sdp:this.sdp,audio_attr:this.mediaDirection.audio,video_attr:this.mediaDirection.video}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints")}}]),n}(as),vs=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.CUSTOM_ITEMS_DELETE),i.customItemKeys=r,i}return Wn(n,[{key:"getData",value:function(){return this.customItemKeys.length>0?{keys:this.customItemKeys}:{}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/custom_items")}}]),n}(as),ps=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),Kn(rr(o=t.call(this,e)),"type",Xo.DETACH),o.participantId=r,o.endpointId=i,o.attachTo=a,o}return Wn(n,[{key:"getData",value:function(){return{attach_to:this.attachTo}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints/").concat(this.endpointId)}}]),n}(as),ys=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.ENTER),i.params=r,i}return Wn(n,[{key:"getData",value:function(){return{is_audio_on:this.params.audioEnabled,is_video_on:this.params.videoEnabled,kick_siblings:this.params.kickSiblings}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants")}}]),n}(as),ms=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.EXIT),i.participantId=r,i}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId)}}]),n}(as),gs=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,e)),"type",Xo.CUSTOM_ITEMS_FETCH),r}return Wn(n,[{key:"getData",value:function(){}},{key:"getMethod",value:function(){return"GET"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/custom_items")}}]),n}(as),Es=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.GET),e}return Wn(n,[{key:"getData",value:function(){}},{key:"getMethod",value:function(){return"GET"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId)}}]),n}(as),ks=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),Kn(rr(o=t.call(this,e)),"type",Xo.PUT_ENDPOINT),o.participantId=r,o.endpointId=i,o.sdp=a,o}return Wn(n,[{key:"getData",value:function(){return{sdp:this.sdp}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints/").concat(this.endpointId)}}]),n}(as),Rs=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.RELEASE_ENDPOINT),a.participantId=r,a.endpointId=i,a}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/endpoints/").concat(this.endpointId)}}]),n}(as),Cs=ze.filter,Is=Nr("filter"),ws=Qe("filter");Oe({target:"Array",proto:!0,forced:!Is||!ws},{filter:function(e){return Cs(this,e,arguments.length>1?arguments[1]:void 0)}});var As=[].join,Ts=f!=Object,bs=We("join",",");Oe({target:"Array",proto:!0,forced:Ts||!bs},{join:function(e){return As.call(v(this),void 0===e?",":e)}});var Ss=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"createQuery",value:function(e){var t=this;return Object.keys(e).filter((function(t){return null!=e[t]})).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(t.toQueryParam(e[n]))})).join("&")}},{key:"toQueryParam",value:function(e){return Array.isArray(e)?e.map((function(e){return encodeURIComponent(e.toString())})).join(","):encodeURIComponent(e.toString())}}]),e}(),Os=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this)),"type",Xo.QUERY),a.params=a._normalizeParams(e),a.prev=r,a.next=i,a}return Wn(n,[{key:"getData",value:function(){}},{key:"getSubPath",value:function(){return"?".concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_normalizeParams",value:function(e){var t=e.type,n=e.limit,r=e.state,i=e.currentParticipantCount,a=e.createdByUserIds,o=e.roomIds,s=e.createdAt;return{type:t,limit:null!=n?Math.min(Math.max(1,n),100):void 0,state:r,currentParticipantCount:i,createdByUserIds:a,roomIds:o,createdAt:s}}},{key:"_createQuery",value:function(){var e,t,n,r;return Ss.createQuery({type:this.params.type,limit:this.params.limit,state:this.params.state,current_participant_range_gte:null===(e=this.params.currentParticipantCount)||void 0===e?void 0:e[0],current_participant_range_lte:null===(t=this.params.currentParticipantCount)||void 0===t?void 0:t[1],created_by_user_ids:this.params.createdByUserIds,room_ids:this.params.roomIds,created_at_start_date:null===(n=this.params.createdAt)||void 0===n?void 0:n[0],created_at_end_date:null===(r=this.params.createdAt)||void 0===r?void 0:r[1],prev:this.prev,next:this.next})}}]),n}(as),Ds=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.CUSTOM_ITEMS_UPDATE),a.customItems=r,a.mode=i,a}return Wn(n,[{key:"getData",value:function(){return{custom_items:this.customItems,mode:this.mode}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/custom_items")}}]),n}(as),Ns=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.VIDEO),a.participantId=r,a.enabled=i,a}return Wn(n,[{key:"getData",value:function(){return{on:this.enabled}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/participants/").concat(this.participantId,"/video")}}]),n}(as),Ls=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.CUSTOM_ITEMS_DELETE),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,deleted:e.deleted,customItems:e.custom_items,affectedAt:e.affected_at}}}]),n}(os),Ps=function e(t){Hn(this,e),Object.assign(this,t)},xs=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"parseRoom",value:function(t){return t?{roomId:t.room_id,state:t.state,roomType:t.room_type,customItems:t.custom_items,createdAt:t.created_at,createdBy:t.created_by,participants:e.parseParticipants(t.current_participants)}:{}}},{key:"parseCustomItemsResult",value:function(e){return{customItems:e.custom_items||{},affectedKeys:[].concat(sr(e.updated||[]),sr(e.deleted||[])),affectedAt:e.affected_at||0}}},{key:"parseParticipants",value:function(t){return t&&Array.isArray(t)?t.map((function(t){return e.parseParticipant(t)})):[]}},{key:"parseParticipant",value:function(e){return e?{participantId:e.participant_id,enteredAt:e.entered_at,updatedAt:e.updated_at,exitedAt:e.exited_at,duration:e.duration,state:e.state,user:new Ps(lo(e.user)),isLocalParticipant:e.is_local_participant,clientId:e.client_id,isAudioEnabled:e.is_audio_on,isVideoEnabled:e.is_video_on}:{}}}]),e}(),Ms=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_AUDIO_STATUS_CHANGED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant),on:e.on}}}]),n}(os),Us=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_CONNECTED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant)}}}]),n}(os),Vs=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_DISCONNECTED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant),reason:e.reason}}}]),n}(os),Fs=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_ENTERED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant)}}}]),n}(os),Gs=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_EXITED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant)}}}]),n}(os),Bs=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.PARTICIPANT_VIDEO_STATUS_CHANGED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,participant:xs.parseParticipant(e.participant),on:e.on}}}]),n}(os),js=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.ROOM_DELETED),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id}}}]),n}(os),qs=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.CUSTOM_ITEMS_UPDATE),e}return Wn(n,[{key:"parseData",value:function(e){return{roomId:e.room_id,updated:e.updated,customItems:e.custom_items,affectedAt:e.affected_at}}}]),n}(os),Hs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),zs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),Ws=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{me:xs.parseParticipant(e.me)}}}]),n}(ss),Ks=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),Ys=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{endpointId:e.endpoint_id,sdp:e.sdp}}}]),n}(ss),Zs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room)}}}]),n}(ss),Qs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return xs.parseCustomItemsResult(e)}}]),n}(ss),Xs=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),$s=ze.find,Js="find",ec=!0,tc=Qe(Js);Js in[]&&Array(1)[Js]((function(){ec=!1})),Oe({target:"Array",proto:!0,forced:ec||!tc},{find:function(e){return $s(this,e,arguments.length>1?arguments[1]:void 0)}}),yt(Js);var nc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return e.room.current_participants.find((function(t){return t.participant_id===e.me.participant_id})).is_local_participant=!0,e.me.is_local_participant=!0,{me:xs.parseParticipant(e.me),room:xs.parseRoom(e.room)}}}]),n}(ss),rc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),ic=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return xs.parseCustomItemsResult(e)}}]),n}(ss),ac=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room)}}}]),n}(ss),oc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{endpointId:e.endpoint_id,sdp:e.sdp}}}]),n}(ss),sc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{}}}]),n}(ss),cc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{rooms:e.rooms.map((function(e){return xs.parseRoom(e)})),prev:e.prev,next:e.next}}}]),n}(ss),uc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return xs.parseCustomItemsResult(e)}}]),n}(ss),lc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{me:xs.parseParticipant(e.me)}}}]),n}(ss),dc=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.INVITATION_ACCEPTED),i.inviterId=r,i}return Wn(n,[{key:"getData",value:function(){return{action:"accept",inviter_id:this.inviterId}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/invitation")}}]),n}(as),hc=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.INVITATION_CANCELED),i.inviteeId=r,i}return Wn(n,[{key:"getData",value:function(){return{invitee_id:this.inviteeId}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/invitation")}}]),n}(as),fc=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.INVITATION_DECLINED),i.inviterId=r,i}return Wn(n,[{key:"getData",value:function(){return{action:"decline",inviter_id:this.inviterId}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/invitation")}}]),n}(as),_c=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,void 0)),"type",Xo.ROOM_DELETED),r.roomId=e,r}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getMethod",value:function(){return"DELETE"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId)}}]),n}(as),vc=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Xo.INVITATION_RECEIVED),a.inviterId=r,a.shortLivedToken=i,a}return Wn(n,[{key:"getHeaders",value:function(){return{"SBCall-Short-Lived-Token":this.shortLivedToken}}},{key:"getData",value:function(){return{action:"receive",inviter_id:this.inviterId}}},{key:"getMethod",value:function(){return"PUT"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/invitation")}}]),n}(as),pc=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Xo.INVITATION_SENT),i.inviteeId=r,i}return Wn(n,[{key:"getData",value:function(){return{invitee_id:this.inviteeId}}},{key:"getMethod",value:function(){return"POST"}},{key:"getSubPath",value:function(){return"/".concat(this.roomId,"/invitation")}}]),n}(as),yc=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.INVITATION_ACCEPTED),e}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.room.roomId}},{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee))}}}]),n}(os),mc=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.INVITATION_CANCELED),e}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.room.roomId}},{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee))}}}]),n}(os),gc=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.INVITATION_DECLINED),e}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.room.roomId}},{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee))}}}]),n}(os),Ec=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.INVITATION_RECEIVED),e}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.room.roomId}},{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee))}}}]),n}(os),kc=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Xo.INVITATION_SENT),e}return Wn(n,[{key:"getRoomId",value:function(){return this.payload.room.roomId}},{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee)),shortLivedToken:e.sbcall_short_lived_token}}}]),n}(os),Rc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room)}}}]),n}(ss),Cc=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{room:xs.parseRoom(e.room),inviter:new Ps(lo(e.inviter)),invitee:new Ps(lo(e.invitee)),shortLivedToken:e.shortLivedToken}}}]),n}(ss),Ic=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"createCreate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(fs,t)}},{key:"createDeleteRoom",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(_c,t)}},{key:"createGet",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(Es,t)}},{key:"createRoomListQuery",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(Os,t)}},{key:"createEnter",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ys,t)}},{key:"createExit",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ms,t)}},{key:"createCreateEndpoint",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(_s,t)}},{key:"createPutEndpoint",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ks,t)}},{key:"createReleaseEndpoint",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(Rs,t)}},{key:"createAttach",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ls,t)}},{key:"createConnected",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(hs,t)}},{key:"createDetach",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ps,t)}},{key:"createAlive",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(us,t)}},{key:"createAudio",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(ds,t)}},{key:"createVideo",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(Ns,t)}},{key:"createFetchCustomItems",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(gs,t)}},{key:"createUpdateCustomItems",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(Ds,t)}},{key:"createDeleteCustomItems",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(vs,t)}},{key:"createSendInvitation",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(pc,t)}},{key:"createCancelInvitation",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(hc,t)}},{key:"createInvitationReceive",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(vc,t)}},{key:"createAcceptInvitation",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(dc,t)}},{key:"createDeclineInvitation",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return er(fc,t)}},{key:"parseResponse",value:function(e,t){switch(e){case Xo.CREATE:return new Zs(t);case Xo.ROOM_DELETED:return new Rc(t);case Xo.GET:return new ac(t);case Xo.QUERY:return new cc(t);case Xo.ENTER:return new nc(t);case Xo.EXIT:return new rc(t);case Xo.CUSTOM_ITEMS_FETCH:return new ic(t);case Xo.CUSTOM_ITEMS_UPDATE:return new uc(t);case Xo.CUSTOM_ITEMS_DELETE:return new Qs(t);case Xo.CREATE_ENDPOINT:return new Ys(t);case Xo.PUT_ENDPOINT:return new oc(t);case Xo.RELEASE_ENDPOINT:return new sc(t);case Xo.ATTACH:return new zs(t);case Xo.CONNECTED:return new Ks(t);case Xo.DETACH:return new Xs(t);case Xo.ALIVE:return new Hs(t);case Xo.AUDIO:return new Ws(t);case Xo.VIDEO:return new lc(t);case Xo.INVITATION_SENT:return new Cc(t);default:return void fo.error(new Ja(Ln.ERR_WRONG_RESPONSE,{error:new Error("unhandled command data. ".concat(JSON.stringify(t)))}))}}},{key:"parse",value:function(e){switch(e.type){case Xo.CUSTOM_ITEMS_UPDATE:return new qs(e);case Xo.CUSTOM_ITEMS_DELETE:return new Ls(e);case Xo.ROOM_DELETED:return new js(e);case Xo.PARTICIPANT_ENTERED:return new Fs(e);case Xo.PARTICIPANT_CONNECTED:return new Us(e);case Xo.PARTICIPANT_EXITED:return new Gs(e);case Xo.PARTICIPANT_DISCONNECTED:return new Vs(e);case Xo.PARTICIPANT_AUDIO_STATUS_CHANGED:return new Ms(e);case Xo.PARTICIPANT_VIDEO_STATUS_CHANGED:return new Bs(e);case Xo.INVITATION_SENT:return new kc(e);case Xo.INVITATION_CANCELED:return new mc(e);case Xo.INVITATION_RECEIVED:return new Ec(e);case Xo.INVITATION_ACCEPTED:return new yc(e);case Xo.INVITATION_DECLINED:return new gc(e);default:return void fo.error(new Ja(Ln.ERR_WRONG_RESPONSE,{error:new Error("unhandled command data. ".concat(JSON.stringify(e)))}))}}}]),e}(),wc=function(e,t,n,r){try{return r?t(A(n)[0],n[1]):t(n)}catch(t){throw rn(e),t}},Ac=function(e){var t,n,r,i,a,o,s=Le(e),c="function"==typeof this?this:Array,u=arguments.length,l=u>1?arguments[1]:void 0,d=void 0!==l,h=nn(s),f=0;if(d&&(l=Ne(l,u>2?arguments[2]:void 0,2)),null==h||c==Array&&Zt(h))for(n=new c(t=ce(s.length));t>f;f++)o=d?l(s[f],f):s[f],wr(n,f,o);else for(a=(i=h.call(s)).next,n=new c;!(r=a.call(i)).done;f++)o=d?wc(i,l,[r.value,f],!0):r.value,wr(n,f,o);return n.length=f,n},Tc=!hn((function(e){Array.from(e)}));Oe({target:"Array",stat:!0,forced:Tc},{from:Ac});for(var bc=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),Sc=[],Oc=0;Oc<256;++Oc)Sc[Oc]=(Oc+256).toString(16).substr(1);var Dc=function(e,t){var n=t||0,r=Sc;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")};var Nc=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||bc)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[r+a]=i[a];return t||Dc(i)},Lc=fe.includes,Pc=Qe("indexOf",{ACCESSORS:!0,1:0});Oe({target:"Array",proto:!0,forced:!Pc},{includes:function(e){return Lc(this,e,arguments.length>1?arguments[1]:void 0)}}),yt("includes");var xc=function(e){if(wo(e))throw TypeError("The method doesn't accept regular expressions");return e},Mc=Ge("match");Oe({target:"String",proto:!0,forced:!function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Mc]=!1,"/./"[e](t)}catch(e){}}return!1}("includes")},{includes:function(e){return!!~String(_(this)).indexOf(xc(e),arguments.length>1?arguments[1]:void 0)}});var Uc="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",Vc=RegExp("^"+Uc+Uc+"*"),Fc=RegExp(Uc+Uc+"*$"),Gc=function(e){return function(t){var n=String(_(t));return 1&e&&(n=n.replace(Vc,"")),2&e&&(n=n.replace(Fc,"")),n}},Bc={start:Gc(1),end:Gc(2),trim:Gc(3)},jc=me.f,qc=w.f,Hc=b.f,zc=Bc.trim,Wc="Number",Kc=r[Wc],Yc=Kc.prototype,Zc=d(dt(Yc))==Wc,Qc=function(e){var t,n,r,i,a,o,s,c,u=y(e,!1);if("string"==typeof u&&u.length>2)if(43===(t=(u=zc(u)).charCodeAt(0))||45===t){if(88===(n=u.charCodeAt(2))||120===n)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:r=2,i=49;break;case 79:case 111:r=8,i=55;break;default:return+u}for(o=(a=u.slice(2)).length,s=0;s<o;s++)if((c=a.charCodeAt(s))<48||c>i)return NaN;return parseInt(a,r)}return+u};if(be(Wc,!Kc(" 0o1")||!Kc("0b1")||Kc("+0x1"))){for(var Xc,$c=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof $c&&(Zc?i((function(){Yc.valueOf.call(n)})):d(n)!=Wc)?fn(new Kc(Qc(t)),n,$c):Qc(t)},Jc=a?jc(Kc):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),eu=0;Jc.length>eu;eu++)g(Kc,Xc=Jc[eu])&&!g($c,Xc)&&Hc($c,Xc,qc(Kc,Xc));$c.prototype=Yc,Yc.constructor=$c,ee(r,Wc,$c)}Oe({target:"Number",stat:!0},{isNaN:function(e){return e!=e}});var tu=function(e){return void 0===e||Number.isNaN(e)||""===e||e===[]},nu=function(e){Object.keys(e).forEach((function(t){tu(e[t])&&delete e[t]}))};var ru,iu=function(){var e=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,d,h,f,_;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getCandidateInfo()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:n=e.sent,i=n.entries(),a=0;case 7:if(!(a<n.size)){e.next=18;break}if(o=i.next(),s=o.value){e.next=11;break}return e.abrupt("continue",15);case 11:if("candidate-pair"!==(c=s[1]).type||"succeeded"!==c.state){e.next=15;break}return r=c.localCandidateId,e.abrupt("break",18);case 15:a++,e.next=7;break;case 18:if(!(a<n.size)){e.next=28;break}if(u=i.next(),l=u.value){e.next=22;break}return e.abrupt("continue",25);case 22:if("local-candidate"!==(d=l[1]).type||d.id!==r){e.next=25;break}return e.abrupt("return",{connectionType:null!==(h=d.candidateType)&&void 0!==h?h:"",protocol:null!==(f=d.protocol)&&void 0!==f?f:"",relayProtocol:null!==(_=d.relayProtocol)&&void 0!==_?_:""});case 25:a++,e.next=18;break;case 28:return e.abrupt("return",null);case 29:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),au=function(){var e=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={},r={},i={},a={},o=new Map,s=new Map,t.forEach((function(e){"codec"===e.type&&o.set(e.id,e),"candidate-pair"===e.type&&"succeeded"===e.state&&(c=e.localCandidateId,n.webrtc_timestamp=e.time),"media-source"===e.type&&s.set(e.kind,e)})),t.forEach((function(e){if("local-candidate"===e.type&&e.id===c&&(r.network_type=e.networkType,r.protocol=e.protocol,r.candidate_type=e.candidateType),"audio"===e.kind||"audio"===e.mediaType){var t;if("outbound-rtp"===e.type)i.codec=null===(t=o.get(e.codecId))||void 0===t?void 0:t.mimeType,i.total_packets_sent=e.packetsSent,i.retransmitted_packets_sent=e.retransmittedPacketsSent;if("remote-inbound-rtp"===e.type&&(i.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type){var n=e.packetsLost/(e.packetsLost+e.packetsReceived)*100;i.total_packets_received=e.packetsReceived,i.total_packets_lost_rate=n,i.total_packets_lost=e.packetsLost,i.jitter=1e3*e.jitter}"track"===e.type&&e.remoteSource&&(i.jitter_buffer_delay=e.jitterBufferDelay,i.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount)}if("video"===e.kind||"video"===e.mediaType){var u,l,d,h;if(a.video_source_width=null===(u=s.get("video"))||void 0===u?void 0:u.width,a.video_source_height=null===(l=s.get("video"))||void 0===l?void 0:l.height,a.video_source_frames_per_second=null===(d=s.get("video"))||void 0===d?void 0:d.framesPerSecond,"outbound-rtp"===e.type)a.codec=null===(h=o.get(e.codecId))||void 0===h?void 0:h.mimeType,a.fir_count=e.firCount,a.pli_count=e.pliCount,a.nack_count=e.nackCount,a.qp_sum=e.qpSum,a.retransmitted_packets_sent=e.retransmittedBytesSent,a.quality_limitation_reason=e.qualityLimitationReason,a.quality_limitation_resolution_changes=e.qualityLimitationResolutionChanges;if("remote-inbound-rtp"===e.type&&(a.rtt=1e3*e.roundTripTime),"inbound-rtp"===e.type){a.header_bytes_received=e.headerBytesReceived,a.key_frames_decoded=e.keyFramesDecoded,a.total_decode_time=e.totalDecodeTime,a.total_inter_frame_delay=e.totalInterFrameDelay,a.total_squared_inter_frame_delay=e.totalSquaredInterFrameDelay;var f=e.packetsLost/(e.packetsLost+e.packetsReceived)*100;a.total_packets_lost=e.packetsLost,a.total_packets_received=e.packetsReceived,a.total_packets_lost_rate=f}"track"===e.type&&(e.remoteSource?(a.jitter_buffer_delay=e.jitterBufferDelay,a.jitter_buffer_emitted_count=e.jitterBufferDelayEmittedCount,a.received_frame_width=e.frameWidth,a.received_frame_height=e.frameHeight,a.frames_received=e.framesReceived,a.frames_decoded=e.framesDecoded,a.frames_dropped=e.framesDropped,a.freeze_count=e.freezeCount,a.pause_count=e.pauseCount,a.total_freezes_duration=e.totalFreezesDuration,a.total_pauses_duration=e.totalPausesDuration,a.total_frames_duration=e.totalFramesDuration,a.sum_of_squared_frames_duration=e.sumOfSquaredFramesDuration):(a.sent_frame_width=e.frameWidth,a.sent_frame_height=e.frameHeight))}})),nu(r),nu(i),nu(a),n.transport_info=r,n.audio=i,n.video=a,e.abrupt("return",n);case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ou=function(){var e=qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("'getStats()' is called without rtcConnection");case 2:return e.next=4,t.getStats();case 4:return n=e.sent,e.abrupt("return",au(n));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),su=function(e){var t=Zn(Zn({},e),{},{transport_info:Zn({},e.transport_info),audio:Zn({},e.audio)});return e.video&&(t.video=Zn({},e.video)),t},cu=function(e,t){var n=su(e),r=n.audio,i=n.video;return r.packets_lost=r.total_packets_lost,r.packets_received=r.total_packets_received,t&&(r.packets_lost-=t.audio.total_packets_lost,r.packets_received-=t.audio.total_packets_received),r.packets_lost_rate=r.packets_lost/(r.packets_lost+r.packets_received)*100,i.packets_lost=i.total_packets_lost,i.packets_received=i.total_packets_received,t&&(i.packets_lost-=t.video.total_packets_lost,i.packets_received-=t.video.total_packets_received),i.packets_lost_rate=i.packets_lost/(i.packets_lost+i.packets_received)*100,r.rtt&&(r.mos=function(e,t,n){if(!(tu(e)||tu(t)||tu(n))){var r,i,a=n+2*t+10;return r=a<160?93.2-a/40:93.2-(a-120)/10,(r-=2.5*e)<=0?i=1:0<r&&r<100?i=1+.035*r+7e-6*r*(r-60)*(100-r):r>=100&&(i=4.5),i}}(r.packets_lost,r.jitter,r.rtt)),n},uu=function(e,t){return(null!=e?e:0)+(null!=t?t:0)},lu=function(e,t,n){return(null!=e?e:0)*n+(null!=t?t:0)*(1-n)},du=function(e,t){var n=su(e);if(!t)return n;function r(e){return"audio"===e?function(e){n.audio[e]=uu(n.audio[e],t.audio[e])}:function(e){n.video[e]=uu(n.video[e],t.video[e])}}return r("audio")("total_packets_sent"),r("audio")("total_packets_received"),r("audio")("total_packets_lost"),r("audio")("total_packets_lost_rate"),r("audio")("retransmitted_packets_sent"),r("audio")("jitter_buffer_delay"),r("video")("fir_count"),r("video")("pli_count"),r("video")("nack_count"),r("video")("qp_sum"),r("video")("retransmitted_packets_sent"),r("video")("quality_limitation_resolution_changes"),"none"===n.video.quality_limitation_reason&&(n.video.quality_limitation_reason=t.video.quality_limitation_reason),r("video")("header_bytes_received"),r("video")("key_frames_decoded"),r("video")("total_decode_time"),r("video")("total_inter_frame_delay"),r("video")("total_squared_inter_frame_delay"),r("video")("total_packets_lost"),r("video")("total_packets_received"),r("video")("total_packets_lost_rate"),r("video")("jitter_buffer_delay"),r("video")("jitter_buffer_emitted_count"),r("video")("frames_received"),r("video")("frames_decoded"),r("video")("frames_dropped"),r("video")("freeze_count"),r("video")("pause_count"),r("video")("total_freezes_duration"),r("video")("total_pauses_duration"),r("video")("total_frames_duration"),r("video")("sum_of_squared_frames_duration"),n},hu=function(e,t,n){var r=su(e);if(n<=1||!t)return r;var i=1/n,a=1/(n-1);function o(e){return"audio"===e?function(e){r.audio[e]=uu(r.audio[e],t.audio[e])}:function(e){r.video[e]=uu(r.video[e],t.video[e])}}function s(e){return"audio"===e?function(e){r.audio[e]=lu(r.audio[e],t.audio[e],["rtt","mos"].includes(e)?a:i)}:function(e){r.video[e]=lu(r.video[e],t.video[e],["rtt","mos"].includes(e)?a:i)}}function c(e){return"audio"===e?function(e){r.audio[e]=t.audio[e]}:function(e){r.video[e]=t.video[e]}}return c("audio")("codec"),s("audio")("rtt"),s("audio")("jitter"),o("audio")("packets_lost"),s("audio")("packets_lost_rate"),s("audio")("mos"),c("video")("codec"),s("video")("rtt"),o("video")("packets_lost"),s("video")("packets_lost_rate"),s("video")("video_source_width"),s("video")("video_source_height"),s("video")("video_source_frames_per_second"),s("video")("received_frame_width"),s("video")("received_frame_height"),s("video")("sent_frame_width"),s("video")("sent_frame_height"),r},fu=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}(ts);!function(e){e.OFFER="offer",e.ANSWER="answer",e.CANDIDATE="candidate"}(ru||(ru={}));var _u,vu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,{payload:e})),"type",ru.ANSWER),r}return n}(fu),pu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,{payload:e})),"type",ru.CANDIDATE),r}return n}(fu),yu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,{payload:e})),"type",ru.OFFER),r}return n}(fu),mu=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"createOffer",value:function(e,t){return new yu({peerConnectionId:e,sdp:t})}},{key:"createAnswer",value:function(e,t){return new vu({peerConnectionId:e,sdp:t})}},{key:"createCandidate",value:function(e,t){return new pu({peerConnectionId:e,candidate:t})}}]),e}(),gu=function(){function e(t){Hn(this,e),this._context=t}return Wn(e,[{key:"_changeState",value:function(e){this._state&&this._state.type===e.type?fo.error(new Error("self-transition is not allowed")):(fo.debug("[".concat(this.name,"] state: ").concat(this._state?this._state.type:"null"," -> ").concat(e.type)),this._state&&this._state.destroy(),this._state=e,this._state.context=this._context,this._state.start())}},{key:"state",get:function(){return this._state}}]),e}(),Eu=function(){function e(t){Hn(this,e),this._stateMutator=t}return Wn(e,[{key:"start",value:function(){this._onStart()}},{key:"destroy",value:function(){this._onDestroy()}},{key:"context",set:function(e){this._context=e}}]),e}(),ku=function(){function e(t,n){Hn(this,e),this._context=t,this._stateMutator=n}return Wn(e,[{key:"state",get:function(){return this._stateMutator.state}}]),e}(),Ru=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this,e))._stateMutator=e,r}return n}(Eu);!function(e){e.IDLE="idle",e.OFFERING="offering",e.ANSWERING="answering",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.ICE_RESTART_OFFERING="iceRestartOffering",e.ICE_RESTART_ANSWERING="iceRestartAnswering",e.CLOSED="closed"}(_u||(_u={}));var Cu,Iu=function(e){Qn(r,e);var t,n=ir(r);function r(e,t){var i;return Hn(this,r),Kn(rr(i=n.call(this,e)),"type",_u.ANSWERING),i._stateMutator=e,i._offerCommand=t,i}return Wn(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("answering"),this._context.createRTCConnection(),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.prepareSessionDescription(),this._context.sendAnswer().catch((function(e){return fo.debug(e)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(Ru),wu=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",_u.CLOSED),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),n}(Ru),Au=function(e){Qn(r,e);var t,n=ir(r);function r(e,t){var i;return Hn(this,r),Kn(rr(i=n.call(this,e)),"type",_u.CONNECTED),i._stateMutator=e,i._isReconnected=t,i}return Wn(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("connected")}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toReconnecting(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onIceDisconnected",value:function(){this._stateMutator.toReconnecting()}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(Ru),Tu=function(e){Qn(r,e);var t,n=ir(r);function r(e,t){var i;return Hn(this,r),Kn(rr(i=n.call(this,e)),"type",_u.ICE_RESTART_ANSWERING),i._stateMutator=e,i._offerCommand=t,i}return Wn(r,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartAnswering"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._context.setRemoteDescription("offer",t.payload.sdp);case 2:this._context.sendAnswer().catch((function(e){return fo.debug(e)}));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(Ru),bu=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",_u.ICE_RESTART_OFFERING),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("iceRestartOffering"),this._context.sendOffer(!0)}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),n}(Ru),Su=function(e){Qn(r,e);var t,n=ir(r);function r(){var e;Hn(this,r);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return Kn(rr(e=n.call.apply(n,[this].concat(i))),"type",_u.IDLE),e}return Wn(r,[{key:"_onStart",value:function(){}},{key:"_onDestroy",value:function(){}},{key:"createOffer",value:function(){this._stateMutator.toOffering()}},{key:"onOfferReceived",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._stateMutator.toAnswering(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),r}(Ru),Ou=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",_u.OFFERING),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("offering"),this._context.createRTCConnection(),this._context.prepareSessionDescription()}},{key:"_onDestroy",value:function(){}},{key:"onAnswerReceived",value:function(e){this._context.setRemoteDescription("answer",e.payload.sdp)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!1)}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),n}(Ru),Du=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",_u.RECONNECTING),i._stateMutator=e,i._offerCommand=r,i}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("reconnecting"),this._offerCommand&&this.onOfferReceived(this._offerCommand)}},{key:"_onDestroy",value:function(){}},{key:"onOfferReceived",value:function(e){this._stateMutator.toIceRestartAnswering(e)}},{key:"onIceConnected",value:function(){this._stateMutator.toConnected(!0)}},{key:"onIceFailed",value:function(){this._context.isDisposable&&this.onClose(),this._context.isInitiator?this._stateMutator.toIceRestartOffering():this._stateMutator.toIceRestartAnswering()}},{key:"onClose",value:function(){this._stateMutator.toClosed()}}]),n}(Ru),Nu=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"toIdle",value:function(){this._changeState(new Su(this))}},{key:"toOffering",value:function(){this._changeState(new Ou(this))}},{key:"toAnswering",value:function(e){this._changeState(new Iu(this,e))}},{key:"toConnected",value:function(e){this._changeState(new Au(this,e))}},{key:"toReconnecting",value:function(e){this._changeState(new Du(this,e))}},{key:"toIceRestartOffering",value:function(){this._changeState(new bu(this))}},{key:"toIceRestartAnswering",value:function(e){this._changeState(new Tu(this,e))}},{key:"toClosed",value:function(){this._changeState(new wu(this))}},{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"PeerConnection"}}]),n}(gu),Lu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this,e,new Nu(e)))._context=e,r._stateMutator.toIdle(),r}return Wn(n,[{key:"onOfferReceived",value:function(e){fo.verbose("[".concat(this.state.type,"] onOfferReceived"));var t=this.state;switch(t.type){case _u.IDLE:case _u.ANSWERING:case _u.CONNECTED:case _u.RECONNECTING:case _u.ICE_RESTART_ANSWERING:t.onOfferReceived(e);break;default:fo.error("[".concat(this.state.type,"] onOfferReceived"))}}},{key:"onAnswerReceived",value:function(e){fo.verbose("[".concat(this.state.type,"] onAnswerReceived"));var t=this.state;switch(t.type){case _u.OFFERING:case _u.ICE_RESTART_OFFERING:t.onAnswerReceived(e);break;default:fo.error("[".concat(this.state.type,"] onAnswerReceived"))}}},{key:"onClose",value:function(){fo.verbose("[".concat(this.state.type,"] onClose"));var e=this.state;switch(e.type){case _u.IDLE:case _u.OFFERING:case _u.ANSWERING:case _u.CONNECTED:case _u.RECONNECTING:case _u.ICE_RESTART_OFFERING:case _u.ICE_RESTART_ANSWERING:e.onClose();break;default:fo.error("[".concat(this.state.type,"] onClose"))}}},{key:"createOffer",value:function(){fo.verbose("[".concat(this.state.type,"] createOffer"));var e=this.state;if(e.type===_u.IDLE)e.createOffer();else fo.error("[".concat(this.state.type,"] createOffer"))}},{key:"onIceConnected",value:function(){fo.verbose("[".concat(this.state.type,"] onIceConnected"));var e=this.state;switch(e.type){case _u.OFFERING:case _u.ANSWERING:case _u.RECONNECTING:case _u.ICE_RESTART_OFFERING:case _u.ICE_RESTART_ANSWERING:e.onIceConnected();break;default:fo.error("[".concat(this.state.type,"] onIceConnected"))}}},{key:"onIceDisconnected",value:function(){fo.verbose("[".concat(this.state.type,"] onIceDisconnected"));var e=this.state;if(e.type===_u.CONNECTED)e.onIceDisconnected();else fo.error("[".concat(this.state.type,"] onIceDisconnected"))}},{key:"onIceFailed",value:function(){fo.verbose("[".concat(this.state.type,"] onIceFailed"));var e=this.state;switch(e.type){case _u.CONNECTED:case _u.RECONNECTING:e.onIceFailed();break;default:fo.error("[".concat(this.state.type,"] onIceFailed"))}}},{key:"state",get:function(){return this._stateMutator.state}}]),n}(ku);!function(e){e.RELAY="relay",e.ALL="all"}(Cu||(Cu={}));var Pu,xu=function(e){Qn(o,e);var t,n,r,i,a=ir(o);function o(e,t,n,r,i,s,c,u){var l;return Hn(this,o),(l=a.call(this))._ctx=e,l.id=t,l._signalingClient=n,l._localStream=r,l._isInitiator=i,l._turnCredential=s,l._mediaDirections=c,l._isDisposable=u,l._stateMachine=new Lu({dispatchEvent:l._dispatchEvent.bind(rr(l)),isInitiator:l._isInitiator,setRemoteDescription:l._setRemoteDescription.bind(rr(l)),sendAnswer:l._sendAnswer.bind(rr(l)),sendOffer:l._sendOffer.bind(rr(l)),createRTCConnection:l._createRTCConnection.bind(rr(l)),prepareSessionDescription:l._prepareSessionDescription.bind(rr(l)),isDisposable:l._isDisposable}),r&&r.on("streamChanged",(function(e){return l.onLocalStream(e)})),l}return Wn(o,[{key:"onEvent",value:function(e){switch(e.type){case ru.CANDIDATE:return void this._receiveCandidate(e);case ru.OFFER:this._stateMachine.onOfferReceived(e);break;case ru.ANSWER:this._stateMachine.onAnswerReceived(e);break;default:fo.error(new Error("unhandled call event ".concat(e)))}}},{key:"createOffer",value:function(){this._stateMachine.createOffer()}},{key:"close",value:function(){this._closeRTCConnection(),this._stateMachine.onClose()}},{key:"onLocalStream",value:function(e){if(this._rtcConnection){var t,n=fr(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;this._replaceTrack(r)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"getCandidateInfo",value:(i=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",iu(this.rtcConnection));case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"getStatsLog",value:(r=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",ou(this.rtcConnection));case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_replaceTrack",value:function(e){var t,n=fr(this._rtcConnection.getSenders());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.track&&r.track.kind===e.kind&&r.replaceTrack(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_createRTCConnection",value:function(){var e,t=this;this._turnCredential&&(e={iceServers:[{username:this._turnCredential.username,credential:this._turnCredential.password,urls:this._turnCredential.turnUrls}],iceTransportPolicy:this._turnCredential.transportPolicy||Cu.ALL});var n=new RTCPeerConnection(e);n.onnegotiationneeded=function(){t._sendOffer(!1)},n.onicecandidate=function(e){var n,r;e.candidate&&(null===(n=(r=t._signalingClient).sendCandidate)||void 0===n||n.call(r,e.candidate))},n.onconnectionstatechange=function(){return t._handleConnectionStateChange(n)},n.oniceconnectionstatechange=function(){return t._handleIceConnectionStateChange(n)},n.ontrack=function(e){return t._onRemoteTrack(e)},this._rtcConnection=n}},{key:"_closeRTCConnection",value:function(){this._rtcConnection&&(this._rtcConnection.onnegotiationneeded=null,this._rtcConnection.onicecandidate=null,this._rtcConnection.oniceconnectionstatechange=null,this._rtcConnection.onconnectionstatechange=null,this._rtcConnection.close(),this._rtcConnection=null,delete this._remoteStream)}},{key:"_prepareSessionDescription",value:function(){var e=this._mediaDirections,t=e.audio,n=e.video,r={sendrecv:[],sendonly:[],recvonly:[],none:[]};r[t].push("audio"),r[n].push("video"),r.sendrecv.length&&this._addTracks(r.sendrecv),r.sendonly.length&&this._addSendOnlyTransceivers(r.sendonly),r.recvonly.length&&this._addReceiveOnlyTransceivers(r.recvonly)}},{key:"_addTracks",value:function(e){var t=this;fo.debug("_addTracks()");var n=this._localStream.localStream;n.getTracks().forEach((function(r){e.includes(r.kind)&&t._rtcConnection.addTrack(r,n)}))}},{key:"_addReceiveOnlyTransceivers",value:function(e){var t=this;e.forEach((function(e){t._rtcConnection.addTransceiver(e,{direction:"recvonly"})}))}},{key:"_addSendOnlyTransceivers",value:function(e){var t=this,n=this._localStream.localStream;e.forEach((function(e){n.getTracks().forEach((function(r){r.kind===e&&t._rtcConnection.addTransceiver(r,{direction:"sendonly",streams:[n]})}))}))}},{key:"_setRemoteDescription",value:function(e,t){var n=new RTCSessionDescription({type:e,sdp:t});return this._rtcConnection.setRemoteDescription(n)}},{key:"_sendOffer",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={iceRestart:t||!1},e.next=3,this._rtcConnection.createOffer(n);case 3:return r=e.sent,e.next=6,this._rtcConnection.setLocalDescription(r);case 6:return e.abrupt("return",this._signalingClient.sendOfferSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_sendAnswer",value:(t=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._rtcConnection.createAnswer();case 2:return(t=e.sent).sdp=t.sdp.replace("actpass","active"),e.next=6,this._rtcConnection.setLocalDescription(t);case 6:return e.abrupt("return",this._signalingClient.sendAnswerSdp(this._rtcConnection.localDescription));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_handleIceConnectionStateChange",value:function(e){switch(fo.verbose("[".concat(this._state.type,"] iceConnectionState ").concat(e.iceConnectionState)),e.iceConnectionState){case"connected":this._stateMachine.onIceConnected();break;case"disconnected":this._stateMachine.onIceDisconnected();break;case"failed":this._dispatchEvent("iceFailed")}}},{key:"_handleConnectionStateChange",value:function(e){if("failed"===e.connectionState)this._dispatchEvent("iceFailed")}},{key:"_receiveCandidate",value:function(e){var t=e.payload.candidate;this._rtcConnection.addIceCandidate({sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.sdp}).catch((function(e){fo.error(e)}))}},{key:"_onRemoteTrack",value:function(e){this._remoteStream=e.streams[0],this._dispatchEvent("remoteStream",this._remoteStream)}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"rtcConnection",get:function(){return this._rtcConnection}},{key:"remoteStream",get:function(){return this._remoteStream}},{key:"signalingClient",get:function(){return this._signalingClient}}]),o}(zo),Mu=function(){function e(){Hn(this,e)}var t;return Wn(e,[{key:"addStatsLog",value:function(e){this._accumulated=du(e,this._accumulated)}},{key:"getAccumulatedStats",value:(t=qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getStatsLog();case 2:return n=e.sent,e.abrupt("return",du(n,this._accumulated));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Uu=function(e){Qn(r,e);var t,n=ir(r);function r(e,t){var i;return Hn(this,r),Kn(rr(i=n.call(this)),"_peerConnections",new Map),Kn(rr(i),"_unhandledCommands",[]),i._ctx=e,i._mediaDirections=t,i._statsLogAccumulator=new Mu,i}return Wn(r,[{key:"_activePC",get:function(){return this._peerConnections.get(this._activePCId)},set:function(e){this._peerConnections.has(e.id)||this._addPC(e),this._activePCId=e.id}},{key:"_preparingPC",get:function(){return this._peerConnections.get(this._preparingPCId)},set:function(e){this._peerConnections.has(e.id)||this._addPC(e),this._preparingPCId=e.id}},{key:"activePeerConnection",get:function(){return this._activePC}}]),Wn(r,[{key:"createPeerConnection",value:function(e,t,n,r,i){fo.debug("Create new peer connection");var a=new xu(this._ctx,e,t,n,r,i,this._mediaDirections,!1);return this._activePC?(this._replacePreparing(a,r),this._dispatchUnhandledCommands(a),a):(this._activePC=a,this._dispatchEvent("initialized"),this._dispatchUnhandledCommands(a),a)}},{key:"createOffer",value:function(){this._activePC&&this._activePC.createOffer()}},{key:"close",value:function(){this._deactivatePreparing(),this._deactivateActive()}},{key:"onEvent",value:function(e){var t,n=null!==(t=e.payload.peerConnectionId)&&void 0!==t?t:void 0,r=this._peerConnections.get(n);this._isActive(n)||this._isPreparing(n)?r.onEvent(e):this._isInactive(n)||this._dispatchOnCreation(e)}},{key:"getStatsLog",value:(t=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._activePC){e.next=2;break}return e.abrupt("return",void 0);case 2:return e.abrupt("return",this._statsLogAccumulator.getAccumulatedStats(this._activePC));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_addPC",value:function(e){this._peerConnections.set(e.id,e)}},{key:"_isActive",value:function(e){return e===this._activePCId}},{key:"_isPreparing",value:function(e){return e===this._preparingPCId}},{key:"_isInactive",value:function(e){return!this._isActive(e)&&!this._isPreparing(e)&&!!this._peerConnections.get(e)}},{key:"_deactivateActive",value:function(){fo.debug("Close active pc if exist"),this._activePC&&(this._activePC.removeAllEventListeners(),this._activePC.close(),delete this._activePCId)}},{key:"_activatePreparing",value:function(){var e=this;if(fo.debug("Activate preparing pc if exist"),this._preparingPC){var t=this._activePC;this._activePC=this._preparingPC,delete this._preparingPCId,this._dispatchEvent("replaced"),t.removeAllEventListeners(),t.getStatsLog().then((function(n){e._statsLogAccumulator.addStatsLog(n),t.close()}))}}},{key:"_deactivatePreparing",value:function(){fo.debug("Close preparing pc if exist"),this._preparingPC&&(this._preparingPC.removeAllEventListeners(),this._preparingPC.close(),delete this._preparingPCId)}},{key:"_replacePreparing",value:function(e,t){var n=this;fo.debug("Create preparing peer connection"),this._deactivatePreparing(),this._preparingPC=e;this._preparingPC.once("connected",(function(){setTimeout((function(){n._activatePreparing()}),2e3)})),t&&this._preparingPC.createOffer()}},{key:"_dispatchUnhandledCommands",value:function(e){this._unhandledCommands.filter((function(t){return t.payload.peerConnectionId===e.id})).forEach((function(t){return e.onEvent(t)})),this._unhandledCommands=this._unhandledCommands.filter((function(t){return t.payload.peerConnectionId!==e.id}))}},{key:"_dispatchOnCreation",value:function(e){this._unhandledCommands.push(e)}}]),r}(zo),Vu=function e(){var t=this;Hn(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},Fu=function(){var e=qn(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,d,h=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=h.length>3&&void 0!==h[3]?h[3]:{count:0,deferred:new Vu},a=i.deferred,o=i.count,e.prev=2,e.next=5,n();case 5:c=e.sent,o>0&&(null===(s=r.onRecover)||void 0===s||s.call(r)),a.resolve(c),e.next=19;break;case 10:if(e.prev=10,e.t0=e.catch(2),null===(u=r.onError)||void 0===u||u.call(r,e.t0),!((l=t.calcTimeout(o+1))>=0)){e.next=18;break}return null===(d=r.onRetrial)||void 0===d||d.call(r,o+1,e.t0),setTimeout((function(){Fu(t,n,r,{count:o+1,deferred:a})}),l),e.abrupt("return",a.promise);case 18:a.reject(e.t0);case 19:return e.abrupt("return",a.promise);case 20:case"end":return e.stop()}}),e,null,[[2,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),Gu=function(){function e(){Hn(this,e)}return Wn(e,[{key:"calcTimeout",value:function(e){switch(e){case 1:return 1e3;case 2:return 2e3;case 3:return 3e3;default:return-1}}}]),e}(),Bu=function(){function e(t,n,r){Hn(this,e),this.interval=t,this.noise=n,this.maxRetrial=r}return Wn(e,[{key:"calcTimeout",value:function(e){return e>this.maxRetrial?-1:this.interval+(Math.random()-.5)*this.noise*2}}]),e}(),ju=function(){function e(t){Hn(this,e),this._requests=new Map,this.timeoutTime=t}return Wn(e,[{key:"has",value:function(e){return this._requests.has(e)}},{key:"get",value:function(e){return this._requests.get(e)}},{key:"register",value:function(e){if(!e)throw new Error("invalid request id");if(this._requests.has(e))throw new Error("duplicate requests");var t=new Vu;return this._requests.set(e,{deferred:t,timer:this._createTimeoutTimer(e)}),t}},{key:"unregister",value:function(e){if(!this._requests.has(e))return null;var t=this._requests.get(e),n=t.timer,r=t.deferred;return clearTimeout(n),this._requests.delete(e),r}},{key:"_createTimeoutTimer",value:function(e){var t=this;return setTimeout((function(){t.unregister(e).reject(new Ja(Ln.ERR_NO_RESPONSE_DUE_TO_TIMEOUT))}),this._getTimeoutTime())}},{key:"rejectAll",value:function(e){var t,n=fr(this._requests.keys());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=this._requests.get(r);clearTimeout(i.timer),i.deferred.reject(e)}}catch(e){n.e(e)}finally{n.f()}this._requests.clear()}},{key:"_getTimeoutTime",value:function(){return this.timeoutTime}}]),e}(),qu=function(){function e(t,n,r,i){Hn(this,e),Kn(this,"_timeoutTime",6e4),this._ctx=t,this._participantId=n,this._mediaDirections=r,this._endpointId=i,this._requestMap=new ju(this._timeoutTime)}var t,n,r;return Wn(e,[{key:"sendOfferSdp",value:(r=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._endpointId){e.next=5;break}return e.next=3,this._sendOfferAndUnregisterCreateEndpointRequest(t);case 3:e.next=7;break;case 5:return e.next=7,this._sendOfferAndUnregisterPutEndpointRequest(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_sendOfferAndUnregisterCreateEndpointRequest",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":create-endpoint-request")),e.prev=1,e.next=4,this._sendCreateEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return n.apply(this,arguments)})},{key:"_sendOfferAndUnregisterPutEndpointRequest",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._requestMap.unregister("".concat(this._participantId,":put-endpoint-request")),e.prev=1,e.next=4,this._sendPutEndpoint(t);case 4:return r=e.sent,n&&n.resolve(r),e.abrupt("return",r);case 9:throw e.prev=9,e.t0=e.catch(1),n&&n.reject(e.t0),e.t0;case 13:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(e){return t.apply(this,arguments)})},{key:"registerCreateEndpointRequest",value:function(){if(fo.debug("registerCreateEndpointRequest()"),this._endpointId)throw new Error("Cannot register create endpoint request on endpoint recycle");return this._requestMap.register("".concat(this._participantId,":create-endpoint-request"))}},{key:"registerPutEndpointRequest",value:function(){if(fo.debug("registerPutEndpointRequest()"),!this._endpointId)throw new Error("Cannot register put endpoint request without endpoint id");return this._requestMap.register("".concat(this._participantId,":put-endpoint-request"))}},{key:"_sendCreateEndpoint",value:function(e){var t=Ic.createCreateEndpoint(this._ctx.roomId,this._participantId,e.sdp,this._mediaDirections);return this._ctx.sender.send(t)}},{key:"_sendPutEndpoint",value:function(e){var t=Ic.createPutEndpoint(this._ctx.roomId,this._participantId,this._endpointId,e.sdp);return this._ctx.sender.send(t)}}]),e}(),Hu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this,e))._stateMutator=e,r}return n}(Eu);!function(e){e.IDLE="idle",e.OFFERING="offering",e.ESTABLISHED="established",e.CONNECTED="connected",e.DISCONNECTED="disconnected",e.RECONNECTING="reconnecting",e.RELEASING="releasing",e.CLOSED="closed"}(Pu||(Pu={}));var zu=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Pu.CLOSED),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("closed")}},{key:"_onDestroy",value:function(){}}]),n}(Hu),Wu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,e)),"type",Pu.CONNECTED),r._stateMutator=e,r}return Wn(n,[{key:"_onStart",value:function(){var e=this._context.reconnectCount>0;this._context.dispatchEvent("connected",e)}},{key:"_onDestroy",value:function(){}},{key:"onICEFailed",value:function(){this._stateMutator.toDisconnected(!0)}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Ku=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this,e)),"type",Pu.ESTABLISHED),a._stateMutator=e,a._sdp=r,a._hasPendingAttach=i,a}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("established"),this._context.setRemoteDescription(this._sdp),this._hasPendingAttach&&this.onAttach()}},{key:"_onDestroy",value:function(){}},{key:"onPCConnected",value:function(){this._stateMutator.toConnected()}},{key:"onICEFailed",value:function(){this._stateMutator.toDisconnected(!1)}},{key:"onAttach",value:function(){this._context.requestAttach()}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Yu=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Pu.IDLE),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("idle"),this._stateMutator.toOffering()}},{key:"_onDestroy",value:function(){}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Zu=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",Pu.RELEASING),e}return Wn(n,[{key:"_onStart",value:function(){this._context.dispatchEvent("releasing"),this._context.closePeerConnection(),this._context.endpoint.id&&this._context.requestRelease()}},{key:"_onDestroy",value:function(){}},{key:"onEndpointRequestSucceeded",value:function(){this._context.requestRelease()}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toClosed()}},{key:"onReleased",value:function(){this._stateMutator.toClosed()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Qu=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,e)),"type",Pu.OFFERING),r._stateMutator=e,r}return Wn(n,[{key:"_onStart",value:function(){this._request()}},{key:"_onDestroy",value:function(){this._requestTimeout&&clearTimeout(this._requestTimeout),delete this._requestTimeout}},{key:"_request",value:function(){this._context.createSession(),this._context.requestCreateOrPutEndpoint()}},{key:"onICEFailed",value:function(){this._stateMutator.toDisconnected(!1)}},{key:"onEndpointRequestSucceeded",value:function(e){this._stateMutator.toEstablished(e,this._hasPendingAttach)}},{key:"onEndpointRequestFailed",value:function(){this._stateMutator.toDisconnected(!1)}},{key:"onAttach",value:function(){this._hasPendingAttach=!0}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Xu=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this,e)),"type",Pu.DISCONNECTED),i._stateMutator=e,i.shouldDispatchEvent=r,i}return Wn(n,[{key:"_onStart",value:function(){this.shouldDispatchEvent&&this._context.dispatchEvent("disconnected"),this._stateMutator.toReconnecting()}},{key:"_onDestroy",value:function(){}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),$u=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,e)),"type",Pu.RECONNECTING),r._stateMutator=e,r}return Wn(n,[{key:"_onStart",value:function(){var e=this;this._context.reconnectCount+=1,setTimeout((function(){e._stateMutator.toOffering()}),5e3+1e3*Math.random())}},{key:"_onDestroy",value:function(){}},{key:"onRelease",value:function(){this._stateMutator.toReleasing()}},{key:"onExit",value:function(){this._stateMutator.toClosed()}}]),n}(Hu),Ju=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"toIdle",value:function(){this._changeState(new Yu(this))}},{key:"toOffering",value:function(){this._changeState(new Qu(this))}},{key:"toEstablished",value:function(e,t){this._changeState(new Ku(this,e,t))}},{key:"toConnected",value:function(){this._changeState(new Wu(this))}},{key:"toDisconnected",value:function(e){this._changeState(new Xu(this,e))}},{key:"toReconnecting",value:function(){this._changeState(new $u(this))}},{key:"toReleasing",value:function(){this._changeState(new Zu(this))}},{key:"toClosed",value:function(){this._changeState(new zu(this))}},{key:"state",get:function(){return this._state}},{key:"name",get:function(){return"Endpoint"}}]),n}(gu),el=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this,e,new Ju(e)))._context=e,r._stateMutator.toIdle(),r}return Wn(n,[{key:"onEndpointRequestSucceeded",value:function(e){fo.verbose("[".concat(this.state.type,"] onEndpointRequestSucceeded"));var t=this.state;switch(t.type){case Pu.OFFERING:t.onEndpointRequestSucceeded(e);break;case Pu.RELEASING:t.onEndpointRequestSucceeded();break;default:fo.error("[".concat(this.state.type,"] onEndpointRequestSucceeded"))}}},{key:"onEndpointRequestFailed",value:function(){fo.verbose("[".concat(this.state.type,"] onEndpointCreateFailed"));var e=this.state;switch(e.type){case Pu.OFFERING:case Pu.RELEASING:e.onEndpointRequestFailed();break;default:fo.error("[".concat(this.state.type,"] onEndpointCreateFailed"))}}},{key:"onICEFailed",value:function(){fo.verbose("[".concat(this.state.type,"] onICEFailed"));var e=this.state;switch(e.type){case Pu.OFFERING:case Pu.ESTABLISHED:case Pu.CONNECTED:e.onICEFailed();break;default:fo.error("[".concat(this.state.type,"] onICEFailed"))}}},{key:"onPCConnected",value:function(){fo.verbose("[".concat(this.state.type,"] onPCConnected"));var e=this.state;if(e.type===Pu.ESTABLISHED)e.onPCConnected();else fo.error("[".concat(this.state.type,"] onPCConnected"))}},{key:"onAttach",value:function(){fo.verbose("[".concat(this.state.type,"] onAttach"));var e=this.state;switch(e.type){case Pu.OFFERING:case Pu.ESTABLISHED:case Pu.CONNECTED:e.onAttach();break;default:fo.error("[".concat(this.state.type,"] onAttach"))}}},{key:"onRelease",value:function(){fo.verbose("[".concat(this.state.type,"] onRelease"));var e=this.state;switch(e.type){case Pu.IDLE:case Pu.OFFERING:case Pu.ESTABLISHED:case Pu.CONNECTED:case Pu.DISCONNECTED:case Pu.RECONNECTING:e.onRelease();break;default:fo.error("[".concat(this.state.type,"] onRelease"))}}},{key:"onReleased",value:function(){fo.verbose("[".concat(this.state.type,"] onReleased"));var e=this.state;if(e.type===Pu.RELEASING)e.onReleased();else fo.error("[".concat(this.state.type,"] onReleased"))}},{key:"onExit",value:function(){fo.verbose("[".concat(this.state.type,"] onExit"));var e=this.state;switch(e.type){case Pu.RELEASING:case Pu.IDLE:case Pu.CONNECTED:case Pu.ESTABLISHED:case Pu.OFFERING:case Pu.DISCONNECTED:case Pu.RECONNECTING:e.onExit();break;default:fo.error("[".concat(this.state.type,"] onExit"))}}},{key:"state",get:function(){return this._stateMutator.state}}]),n}(ku),tl=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),Kn(rr(a=t.call(this)),"tmpId",Nc()),Kn(rr(a),"_createSession",(function(){switch(fo.debug("_createSession()"),a.type){case"master":a._createMasterSession();break;case"viewer":a._createViewerSession();break;default:fo.error("Not supported endpoint type : ",a.type)}})),Kn(rr(a),"_closePeerConnection",(function(){var e,t;fo.debug("_closePeerConnection()"),null===(e=a._pc)||void 0===e||e.removeAllEventListeners(),null===(t=a._pc)||void 0===t||t.close(),a._pc=null})),Kn(rr(a),"_requestCreateOrPutEndpoint",(function(){fo.debug("_requestCreateEndpoint()");var e,t=a._pc;e=a.id?t.signalingClient.registerPutEndpointRequest():t.signalingClient.registerCreateEndpointRequest(),t.createOffer(),e.promise.then((function(e){a.id=e.payload.endpointId,a._stateMachine.onEndpointRequestSucceeded(e.payload.sdp)})).catch((function(e){fo.error("Endpoint request failed",e),a._stateMachine.onEndpointRequestFailed()}))})),Kn(rr(a),"_requestAttach",(function(){var e=a.attachedTo;Fu(new Bu(5e3,1e3,8),(function(){return a._sendAttach(e.id)}),{onError:function(t){fo.error("Fail attach endpoint endpointId = ".concat(a.id,", to = ").concat(e.id," ErrorCode = ").concat(t.code))}}).then((function(){a._dispatchEvent("attached",e)}))})),Kn(rr(a),"_requestRelease",(function(){fo.debug("_requestRelease()"),a._sendReleaseEndpoint().then((function(){a._stateMachine.onReleased()})).catch((function(e){fo.error("Release request failed",e),a._stateMachine.onReleased()}))})),Kn(rr(a),"_setRemoteDescription",(function(e){fo.debug("_setRemoteDescription()");var t=a._pc,n=mu.createAnswer(void 0,e);t.onEvent(n),t.once("connected",(function(){a._stateMachine.onPCConnected(),a._sendConnected()})),t.once("iceFailed",(function(){a._stateMachine.onICEFailed()}))})),a._ctx=e,a._collection=r,a.type=i,a._stateMachine=new el({endpoint:rr(a),dispatchEvent:a._dispatchEvent.bind(rr(a)),createSession:a._createSession,requestCreateOrPutEndpoint:a._requestCreateOrPutEndpoint,setRemoteDescription:a._setRemoteDescription,closePeerConnection:a._closePeerConnection,requestAttach:a._requestAttach,requestRelease:a._requestRelease,trialCount:0,reconnectCount:0}),a}return Wn(n,[{key:"attach",value:function(e){fo.debug("attach()"),e.viewerEndpoint=this,this.attachedTo=e,this._stateMachine.onAttach()}},{key:"release",value:function(){fo.debug("release()"),this._stateMachine.onRelease()}},{key:"exit",value:function(){fo.debug("exit()"),this._closePeerConnection(),this._stateMachine.onExit()}},{key:"_createMasterSession",value:function(){fo.debug("_createMasterSession()"),this._pc&&this._closePeerConnection(),this._createPeerConnection(this._masterSessionDirection,this._localParticipant.localStream)}},{key:"_createViewerSession",value:function(){fo.debug("_createViewerSession()"),this._pc&&this._closePeerConnection(),this._createPeerConnection(this._viewerSessionDirection,void 0)}},{key:"_createPeerConnection",value:function(e,t){var n=this;fo.debug("_createPeerConnection()");var r=new qu(this._ctx,this._localParticipant.id,e,this.id);this._pc=new xu(this._ctx,void 0,r,t,!0,void 0,e,!0),this._dispatchEvent("pcChanged",this._pc),this._pc.on("remoteStream",(function(e){n._dispatchEvent("remoteStream",e)}))}},{key:"_sendConnected",value:function(){var e=Ic.createConnected(this._ctx.roomId,this._localParticipant.id,this.id);return this._ctx.sender.send(e)}},{key:"_sendReleaseEndpoint",value:function(){var e=Ic.createReleaseEndpoint(this._ctx.roomId,this._localParticipant.id,this.id);return this._ctx.sender.sendWithRetry(e)}},{key:"_sendAttach",value:function(e){var t=Ic.createAttach(this._ctx.roomId,this._localParticipant.id,this.id,e);return this._ctx.sender.sendWithRetry(t,new Gu)}},{key:"remoteStream",get:function(){var e;return null===(e=this._pc)||void 0===e?void 0:e.remoteStream}},{key:"_state",get:function(){return this._stateMachine.state}},{key:"_localParticipant",get:function(){return this._collection.localParticipant}},{key:"_masterSessionDirection",get:function(){switch(this._ctx.roomType){case Nl.SMALL_ROOM_FOR_AUDIO_ONLY:return{audio:"sendonly",video:"none"};case Nl.LARGE_ROOM_FOR_AUDIO_ONLY:return{audio:"sendrecv",video:"none"};case Nl.SMALL_ROOM_FOR_VIDEO:return{audio:"sendonly",video:"sendonly"};case Nl.LARGE_ROOM_FOR_VIDEO:return{audio:"sendrecv",video:"sendonly"};default:return fo.error("Not supported room type : ",this._ctx.roomType),{audio:"sendonly",video:"sendonly"}}}},{key:"_viewerSessionDirection",get:function(){switch(this._ctx.roomType){case Nl.SMALL_ROOM_FOR_AUDIO_ONLY:return{audio:"recvonly",video:"none"};case Nl.LARGE_ROOM_FOR_AUDIO_ONLY:return{audio:"none",video:"none"};case Nl.SMALL_ROOM_FOR_VIDEO:return{audio:"recvonly",video:"recvonly"};case Nl.LARGE_ROOM_FOR_VIDEO:return{audio:"none",video:"recvonly"};default:return fo.error("Not supported room type : ",this._ctx.roomType),{audio:"recvonly",video:"recvonly"}}}}]),n}(zo),nl=function(){function e(t,n){Hn(this,e),Kn(this,"_endpoints",new Map),this._ctx=t,this._collection=n}return Wn(e,[{key:"getMaster",value:function(){return Array.from(this._endpoints.values()).find((function(e){return"master"===e.type}))}},{key:"getViewers",value:function(){return Array.from(this._endpoints.values()).filter((function(e){return"viewer"===e.type}))}},{key:"exit",value:function(){var e,t=fr(this._endpoints.values());try{for(t.s();!(e=t.n()).done;){e.value.exit()}}catch(e){t.e(e)}finally{t.f()}}},{key:"releaseEndpoint",value:function(e){e.release(),e.removeAllEventListeners()}},{key:"createMaster",value:function(){return fo.debug("_createSendSession()"),this._createEndpoint("master")}},{key:"createViewer",value:function(){return fo.debug("_createRecvSession()"),this._createEndpoint("viewer")}},{key:"_createEndpoint",value:function(e){var t=this,n=new tl(this._ctx,this._collection,e);return this._endpoints.set(n.tmpId,n),n.once("established",(function(){t._endpoints.delete(n.tmpId),t._endpoints.set(n.id,n)})),n.once("closed",(function(){t._endpoints.delete(n.id)})),n}}]),e}(),rl=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this)),"_unsubscribes",[]),i._ctx=e,i._collection=r,i._endpointManager=new nl(e,r),i._registerParticipantCollectionListeners(),i}return Wn(n,[{key:"_registerParticipantCollectionListeners",value:function(){var e=this;this._unsubscribes.length&&this._unregisterParticipantCollectionListeners(),this._unsubscribes=[this._collection.on("entered",(function(t){return e._onParticipantEntered(t)})),this._collection.on("connected",(function(t){return e._onParticipantConnected(t)})),this._collection.on("exited",(function(t){return e._onParticipantExited(t)}))]}},{key:"_unregisterParticipantCollectionListeners",value:function(){this._unsubscribes.forEach((function(e){return e()})),this._unsubscribes=[]}},{key:"_clearParticipantToEndpoint",value:function(){this._collection.remoteParticipants.forEach((function(e){e.viewerEndpoint=null}))}},{key:"onSelfEntered",value:function(){var e=this;fo.debug("onSelfEntered()");var t=this._endpointManager.createMaster();this._localParticipant.masterEndpoint=t,t.on("connected",(function(n){if(e._dispatchEvent("localParticipantConnected",e._localParticipant,n),n){e._onEndpointReconnected(t);var r,i=fr(e._endpointManager.getViewers());try{for(i.s();!(r=i.n()).done;){var a=r.value;e._onEndpointReconnected(a)}}catch(e){i.e(e)}finally{i.f()}}})),t.on("disconnected",(function(){e._dispatchEvent("localParticipantDisconnected",e._localParticipant)}))}},{key:"exit",value:function(){fo.debug("exit()"),this._unregisterParticipantCollectionListeners(),this._clearParticipantToEndpoint(),this._endpointManager.exit()}},{key:"_onEndpointReconnected",value:function(e){fo.debug("_remotePCChanged(endpointId: ".concat(e.id,")"))}},{key:"_onParticipantEntered",value:function(e){fo.debug("_onParticipantEntered(id: ".concat(e.id,")"))}},{key:"_onParticipantConnected",value:function(e){fo.debug("_onParticipantConnected(id : ".concat(e.id,")"))}},{key:"_onParticipantExited",value:function(e){fo.debug("_onParticipantExited(id : ".concat(e.id,")"));var t=e.viewerEndpoint;e.viewerEndpoint=null,t&&this._endpointManager.releaseEndpoint(t)}},{key:"_updateLocalResolution",value:function(e){this._localParticipant.updateResolution(e)}},{key:"_localParticipant",get:function(){return this._collection.localParticipant}}]),n}(zo),il=function(){function e(t,n){Hn(this,e),this.key=t,this.value=n}return Wn(e,[{key:"toString",value:function(){return this.key}},{key:"equals",value:function(e){return this.value.width===e.value.width&&this.value.height===e.value.height}}]),e}();Kn(il,"_720P",new il("_720P",{width:1280,height:720})),Kn(il,"_540P",new il("_540P",{width:960,height:540})),Kn(il,"_480P",new il("_480P",{width:848,height:480})),Kn(il,"_360P",new il("_360P",{width:640,height:360}));var al=il._720P,ol=fe.indexOf,sl=[].indexOf,cl=!!sl&&1/[1].indexOf(1,-0)<0,ul=We("indexOf"),ll=Qe("indexOf",{ACCESSORS:!0,1:0});Oe({target:"Array",proto:!0,forced:cl||!ul||!ll},{indexOf:function(e){return cl?sl.apply(this,arguments)||0:ol(this,e,arguments.length>1?arguments[1]:void 0)}});var dl=function(e){return function(t,n,r,i){De(n);var a=Le(t),o=f(a),s=ce(a.length),c=e?s-1:0,u=e?-1:1;if(r<2)for(;;){if(c in o){i=o[c],c+=u;break}if(c+=u,e?c<0:s<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:s>c;c+=u)c in o&&(i=n(i,o[c],c,a));return i}},hl={left:dl(!1),right:dl(!0)}.left,fl=We("reduce"),_l=Qe("reduce",{1:0});Oe({target:"Array",proto:!0,forced:!fl||!_l||!fi&&Or>79&&Or<83},{reduce:function(e){return hl(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var vl,pl,yl,ml,gl,El,kl=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),Kn(rr(i=t.call(this)),"hasVideoPermission",!1),i._streamManger=e,i.constraints=r,i}return Wn(n,[{key:"dispose",value:function(){var e;this.removeAllEventListeners(),null===(e=this.onDisposed)||void 0===e||e.call(this)}},{key:"streamChanged",value:function(e){this._dispatchEvent("streamChanged",e)}},{key:"audioOutputChanged",value:function(){this._dispatchEvent("audioOutputChanged")}},{key:"stream",get:function(){return this._streamManger.stream}}]),n}(zo),Rl=function(e,t){t.audio&&0===e.getAudioTracks().length&&e.addTrack(function(){vl||(vl=new(window.AudioContext||window.webkitAudioContext));var e=vl;pl=e.createOscillator();var t=e.createMediaStreamDestination(),n=e.createGain();return n.gain.setValueAtTime(0,e.currentTime),pl.connect(n).connect(t),pl.start(),gl=t.stream.getAudioTracks()[0],t.stream.getAudioTracks()[0]}()),t.video&&0===e.getVideoTracks().length&&e.addTrack(function(e){var t=e.width,n=e.height,r=e.frameRate;yl||(yl=document.createElement("canvas")),yl.width=t,yl.height=n,yl.getContext("2d").fillRect(0,0,t,n),ml||(ml=setInterval((function(){yl.getContext("2d").fillRect(0,0,t,n)}),1e3));var i=yl.captureStream(r);return El=i.getVideoTracks()[0],i.getVideoTracks()[0]}(Zn(Zn({},al.value),{},{frameRate:24})))};function Cl(){gl&&gl.stop(),El&&El.stop(),gl=null,El=null,ml&&(clearInterval(ml),ml=null),pl&&(pl.onended=function(){pl.disconnect(),pl=null},pl.stop())}function Il(e){if(e){var t,n=fr(e.getTracks());try{for(n.s();!(t=n.n()).done;){t.value.stop()}}catch(e){n.e(e)}finally{n.f()}}}var wl=function(){function e(t){Hn(this,e),this._deviceManager=t,this._updateQueued=!1}var t,n;return Wn(e,[{key:"_getUserMedia",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia(t);case 3:return n=e.sent,Cl(),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),fo.warning("Failed to first 'getUserMedia()' call Error[".concat(e.t0,"]")),r=new MediaStream,e.prev=12,e.next=15,navigator.mediaDevices.getUserMedia({audio:t.audio});case 15:i=e.sent,r.addTrack(i.getAudioTracks()[0]),e.next=22;break;case 19:e.prev=19,e.t1=e.catch(12),fo.warning("Failed to get local audio stream Error[".concat(e.t1,"]"));case 22:return e.prev=22,e.next=25,navigator.mediaDevices.getUserMedia({video:t.video});case 25:a=e.sent,r.addTrack(a.getVideoTracks()[0]),e.next=32;break;case 29:e.prev=29,e.t2=e.catch(22),fo.warning("Failed to get local video stream Error[".concat(e.t2,"]"));case 32:return e.abrupt("return",r);case 33:case"end":return e.stop()}}),e,null,[[0,8],[12,19],[22,29]])}))),function(e){return n.apply(this,arguments)})},{key:"updateStream",value:(t=qn(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._updateAt){e.next=3;break}return this._updateQueued=!0,e.abrupt("return");case 3:if(t=this._deviceManager.mediaAccesses.some((function(e){return e.constraints.audio})),n=this._deviceManager.mediaAccesses.some((function(e){return e.constraints.video})),t||n){e.next=9;break}return Il(this.stream),Cl(),e.abrupt("return");case 9:return this._updateAt=Date.now(),(r=this.stream)||(i=new MediaStream,Rl(i,{audio:t,video:n}),this.stream=i),so&&Il(r),e.next=15,this._deviceManager.getMediaConstraints({usingAudio:t,usingVideo:n});case 15:return a=e.sent,e.next=18,this._getUserMedia(a);case 18:if((o=e.sent).getVideoTracks().length>0){s=fr(this._deviceManager.mediaAccesses);try{for(s.s();!(c=s.n()).done;)c.value.hasVideoPermission=!0}catch(e){s.e(e)}finally{s.f()}}Rl(o,{audio:t,video:n}),so||Il(r),this.stream=o,u=fr(this._deviceManager.mediaAccesses);try{for(u.s();!(l=u.n()).done;)l.value.streamChanged(this.stream)}catch(e){u.e(e)}finally{u.f()}delete this._updateAt,this._updateQueued?(this._updateQueued=!1,this.updateStream()):this._deviceManager.refreshMediaDevices({audio:t,video:n},!0);case 27:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();function Al(e,t){return(null==e?void 0:e.deviceId)===(null==t?void 0:t.deviceId)&&(null==e?void 0:e.label)===(null==t?void 0:t.label)&&(null==e?void 0:e.groupId)===(null==t?void 0:t.groupId)}var Tl,bl=function(){function e(){var t=this;Hn(this,e),this.mediaAccesses=[],this._availableMediaDevices={audioinput:[],audiooutput:[],videoinput:[]},this._currentMediaDevices={audioinput:void 0,audiooutput:void 0,videoinput:void 0},this._sendbirdCallListeners=new Map,this._streamManager=new wl(this),navigator.mediaDevices.ondevicechange=function(){return t._onDeviceChanged()}}var t,n,r,i;return Wn(e,[{key:"_onDeviceChanged",value:function(){0!==this.mediaAccesses.length&&this.refreshMediaDevices({audio:this.mediaAccesses.some((function(e){return e.constraints.audio})),video:this.mediaAccesses.some((function(e){return e.constraints.video}))})}},{key:"addSendBirdCallListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeSendBirdCallListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllSendBirdCallListener",value:function(){this._sendbirdCallListeners.clear()}},{key:"getCurrentAudioInputDevice",value:function(){return this._currentMediaDevices.audioinput}},{key:"getCurrentAudioOutputDevice",value:function(){return this._currentMediaDevices.audiooutput}},{key:"getCurrentVideoInputDevice",value:function(){return this._currentMediaDevices.videoinput}},{key:"getAvailableAudioInputDevices",value:function(){return this._availableMediaDevices.audioinput}},{key:"getAvailableAudioOutputDevices",value:function(){return this._availableMediaDevices.audiooutput}},{key:"getAvailableVideoInputDevices",value:function(){return this._availableMediaDevices.videoinput}},{key:"updateStream",value:(i=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._streamManager.updateStream());case 1:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"_registerMediaAccess",value:function(e){var t=this;this.mediaAccesses.push(e),e.onDisposed=function(){return t.stopMedia(e)}}},{key:"useMedia",value:function(e){if(e.audio||e.video){var t=new kl(this._streamManager,e);return this._registerMediaAccess(t),this.updateStream(),t}fo.error(new Error("you should set true for at least 1 media type."))}},{key:"stopMedia",value:function(e){this.mediaAccesses.splice(this.mediaAccesses.indexOf(e),1),this.updateStream()}},{key:"fetchMediaDevices",value:(r=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.reduce((function(e,t){return e[t.kind].push(t),e}),{audioinput:[],audiooutput:[],videoinput:[]}));case 4:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"getMediaConstraints",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.usingAudio,r=t.usingVideo,i={audio:!1,video:!1},e.next=4,this.fetchMediaDevices();case 4:return a=e.sent,o=a.audioinput,s=a.videoinput,n&&o.length&&(c=this.getCurrentAudioInputDevice(),i.audio={deviceId:null==c?void 0:c.deviceId}),r&&s.length&&(u=this.getCurrentVideoInputDevice(),i.video=Zn(Zn({deviceId:null==u?void 0:u.deviceId},al.value),{},{frameRate:24})),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_updateCurrentMediaDevice",value:function(e,t){var n,r=this._availableMediaDevices[e],i=this._currentMediaDevices[e],a=r.find((function(e){return e.deviceId===(null==t?void 0:t.deviceId)}));a||(fo.warning("Selected device is unavailable. fallback to default device."),a=(null!==(n=a)&&void 0!==n?n:r.length>0)?r[0]:null);return this._currentMediaDevices[e]=a,!Al(i,a)}},{key:"_onAudioOutputChanged",value:function(){var e,t=fr(this.mediaAccesses);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.constraints.audio&&n.audioOutputChanged()}}catch(e){t.e(e)}finally{t.f()}}},{key:"selectDevice",value:function(e,t){t.kind===e?this._updateCurrentMediaDevice(e,t)&&("audioinput"!==e&&"videoinput"!==e||this.updateStream(),"audiooutput"===e&&this._onAudioOutputChanged()):fo.error(new Error("Tried to select invalid device of type"))}},{key:"_updateAvailableDevices",value:function(e,t){var n,r,i,a=this._currentMediaDevices[e],o=!function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<t.length;n++)if(!Al(e[n],t[n]))return!1;return!0}(this._availableMediaDevices[e],t);if(!o)return!1;var s;this._availableMediaDevices[e]=t,s=this._updateCurrentMediaDevice(e,a);var c,u=fr(this._sendbirdCallListeners.values());try{for(u.s();!(c=u.n()).done;){var l=c.value,d=this._currentMediaDevices[e];switch(e){case"audioinput":null===(n=l.onAudioInputDeviceChanged)||void 0===n||n.call(l,d,t);break;case"audiooutput":null===(r=l.onAudioOutputDeviceChanged)||void 0===r||r.call(l,d,t);break;case"videoinput":null===(i=l.onVideoInputDeviceChanged)||void 0===i||i.call(l,d,t)}}}catch(e){u.e(e)}finally{u.f()}return s}},{key:"refreshMediaDevices",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,d=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.audio,r=t.video,i=d.length>1&&void 0!==d[1]&&d[1],n||r){e.next=4;break}throw new Error("at least one of the audio or video must be true");case 4:return e.next=6,this.fetchMediaDevices();case 6:a=e.sent,o=a.audioinput,s=a.audiooutput,c=a.videoinput,u=!1,l=!1,n&&(u=this._updateAvailableDevices("audioinput",o),l=this._updateAvailableDevices("audiooutput",s)),r&&(u=this._updateAvailableDevices("videoinput",c)||u),!i&&u&&this.updateStream(),l&&this._onAudioOutputChanged();case 16:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Sl=function(){function e(t,n,r){var i=this;Hn(this,e),this._ctx=t,Object.assign(this,n),this._localStream=r,this._localStream.on("audioOutputChanged",(function(){i._onAudioOutputChanged()}))}var t,n,r;return Wn(e,[{key:"id",get:function(){return this.participantId}}]),Wn(e,[{key:"updateInfo",value:function(e){var t=this,n=new Map;return Object.keys(e).forEach((function(r){t[r]!==e[r]&&n.set(r,e[r])})),Object.assign(this,e),n}},{key:"setMediaView",value:(r=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._mediaView!==t){e.next=2;break}return e.abrupt("return");case 2:if(this._mediaView&&(this._mediaView.srcObject=null),t){e.next=6;break}return delete this._mediaView,e.abrupt("return");case 6:return e.next=8,this._updateMediaViewStream(t,this.stream);case 8:this._mediaView=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_updateMediaViewStream",value:(n=qn(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._ctx.deviceManager.getCurrentAudioOutputDevice())){e.next=4;break}return e.next=4,null===(i=t.setSinkId)||void 0===i?void 0:i.call(t,r.deviceId);case 4:return n&&(t.srcObject=n),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_onAudioOutputChanged",value:(t=qn(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._ctx.roomType!==Nl.SMALL_ROOM_FOR_VIDEO&&this._ctx.roomType!==Nl.SMALL_ROOM_FOR_AUDIO_ONLY){e.next=4;break}return r=this._ctx.deviceManager.getCurrentAudioOutputDevice(),e.next=4,null===(t=this._mediaView)||void 0===t||null===(n=t.setSinkId)||void 0===n?void 0:n.call(t,r.deviceId);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),Ol=function(e){Qn(r,e);var t,n=ir(r);function r(e,t,i){var a;return Hn(this,r),Kn(rr(a=n.call(this,e,t,i)),"isLocalParticipant",!0),Kn(rr(a),"_resolution",il._720P),a._localStream.on("streamChanged",(function(e){return a._onStream(e)})),a}return Wn(r,[{key:"stream",get:function(){var e;return null===(e=this._localStream)||void 0===e?void 0:e.localStream}},{key:"localStream",get:function(){return this._localStream}},{key:"masterEndpoint",get:function(){return this._masterEndpoint},set:function(e){this._masterEndpoint=e}}]),Wn(r,[{key:"exit",value:function(){this._release()}},{key:"setLocalMediaView",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.setMediaView(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"muteMicrophone",value:function(){fo.info("muteMicrophone()"),this._toggleAudio(!1)}},{key:"unmuteMicrophone",value:function(){fo.info("unmuteMicrophone()"),this._toggleAudio(!0)}},{key:"startVideo",value:function(){fo.info("startVideo()"),this._toggleVideo(!0)}},{key:"stopVideo",value:function(){fo.info("stopVideo()"),this._toggleVideo(!1)}},{key:"updateResolution",value:function(e){this._resolution.equals(e)||(this._resolution=e,this._applyConstraints())}},{key:"_toggleAudio",value:function(e){this.isAudioEnabled!==e&&(this.stream.getAudioTracks().forEach((function(t){t.enabled=e})),this.isAudioEnabled=e,this._sendAudioCommand(e).catch((function(e){return fo.debug(e)})))}},{key:"_toggleVideo",value:function(e){this.isVideoEnabled!==e&&(this.stream.getVideoTracks().forEach((function(t){t.enabled=e})),this.isVideoEnabled=e,this._sendVideoCommand(e).catch((function(e){return fo.debug(e)})))}},{key:"_isMediaEnabled",value:function(e){switch(e){case"audio":return this.isAudioEnabled;case"video":return this.isVideoEnabled;default:return fo.error(new Error("unrecognized media type ".concat(e))),!1}}},{key:"_applyConstraints",value:function(){var e;if(fo.debug("_applyConstraints()"),this.stream&&null!==(e=this._localStream)&&void 0!==e&&e.hasVideoPermission){var t,n=fr(this.stream.getVideoTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value,i=void 0;i=this._resolution.equals(il._360P)&&co?{height:this._resolution.value.height}:this._resolution.value,r.applyConstraints(i).catch((function(e){return fo.error("Fail change local video resolution error = ",e)}))}}catch(e){n.e(e)}finally{n.f()}}}},{key:"_onStream",value:function(e){var t,n=fr(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.enabled=this._isMediaEnabled(r.kind)}}catch(e){n.e(e)}finally{n.f()}this._applyConstraints(),this._mediaView&&(this._mediaView.srcObject=e)}},{key:"_release",value:function(){this._localStream.release(),delete this._localStream}},{key:"_sendAudioCommand",value:function(e){var t=Ic.createAudio(this._ctx.roomId,this.id,e);return this._ctx.sender.send(t)}},{key:"_sendVideoCommand",value:function(e){var t=Ic.createVideo(this._ctx.roomId,this.id,e);return this._ctx.sender.send(t)}}]),r}(Sl),Dl=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"isLocalParticipant",!1),Kn(rr(e),"_onStream",(function(){var t=rr(e).stream;e._mediaView&&e._updateMediaViewStream(e._mediaView,t)})),e}return Wn(n,[{key:"viewerEndpoint",set:function(e){var t;null===(t=this._unsubscribeRemoteStream)||void 0===t||t.call(this),this._viewerEndpoint=e,e&&(this._unsubscribeRemoteStream=e.on("remoteStream",this._onStream)),this._onStream()}},{key:"stream",get:function(){var e;return null===(e=this._viewerEndpoint)||void 0===e?void 0:e.remoteStream}}]),n}(Sl);!function(e){e.ENTERED="entered",e.CONNECTED="connected",e.EXITED="exited"}(Tl||(Tl={}));var Nl,Ll=function(e){Qn(r,e);var t,n=ir(r);function r(){return Hn(this,r),n.apply(this,arguments)}return Wn(r,[{key:"onSelfEntered",value:function(){this._updateLocalResolution(this._localResolution),ar(Xn(r.prototype),"onSelfEntered",this).call(this),this._createRecvSessionsForConnectedParticipants()}},{key:"_onEndpointReconnected",value:function(e){ar(Xn(r.prototype),"_onEndpointReconnected",this).call(this,e),"viewer"===e.type&&e.attachedTo&&this._attach(e,e.attachedTo)}},{key:"_onParticipantEntered",value:function(e){ar(Xn(r.prototype),"_onParticipantEntered",this).call(this,e),this._updateLocalResolution(this._localResolution)}},{key:"_onParticipantConnected",value:(t=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ar(Xn(r.prototype),"_onParticipantConnected",this).call(this,t),e.abrupt("return",this._createParticipantRecvSession(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_onParticipantExited",value:function(e){ar(Xn(r.prototype),"_onParticipantExited",this).call(this,e),this._updateLocalResolution(this._localResolution)}},{key:"_createParticipantRecvSession",value:function(e){fo.debug("_createParticipantRecvSession(".concat(e.id,")"));var t=this._endpointManager.createViewer();return this._attach(t,e),t}},{key:"_attach",value:function(e,t){var n=this;e.attach(t),e.once("attached",(function(){n._dispatchEvent("remoteParticipantStream",t)}))}},{key:"_createRecvSessionsForConnectedParticipants",value:function(){fo.debug("_createRecvSessionForConnectedParticipant()");var e,t=fr(this._collection.remoteParticipants);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLocalParticipant||n.state===Tl.CONNECTED&&this._createParticipantRecvSession(n)}}catch(e){t.e(e)}finally{t.f()}}},{key:"_localResolution",get:function(){switch(this._collection.connectedRemoteParticipants.length){case 0:case 1:return il._720P;case 2:return il._540P;case 3:return il._480P;default:return il._360P}}}]),r}(rl),Pl=function(e){Qn(s,e);var t,n,r,i,a,o=ir(s);function s(e,t){var n;return Hn(this,s),(n=o.call(this,e,t))._ctx=e,n._collection=t,t.localStream.on("audioOutputChanged",(function(){n._onAudioOutputChanged()})),n}return Wn(s,[{key:"onSelfEntered",value:(a=qn(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ar(Xn(s.prototype),"onSelfEntered",this).call(this),this._localParticipant.masterEndpoint.on("remoteStream",(function(e){t._onRemoteStream(e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_onParticipantEntered",value:function(e){}},{key:"_onParticipantConnected",value:(i=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"_onParticipantExited",value:function(e){}},{key:"_onRemoteStream",value:function(e){this._mediaView&&(this._mediaView.srcObject=e)}},{key:"setMediaView",value:(r=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._mediaView!==t){e.next=2;break}return e.abrupt("return");case 2:if(this._mediaView&&(this._mediaView.srcObject=null),t){e.next=6;break}return delete this._mediaView,e.abrupt("return");case 6:return e.next=8,this._updateMediaViewStream(t,this._stream);case 8:this._mediaView=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_updateMediaViewStream",value:(n=qn(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._ctx.deviceManager.getCurrentAudioOutputDevice())){e.next=4;break}return e.next=4,null===(i=t.setSinkId)||void 0===i?void 0:i.call(t,r.deviceId);case 4:return n&&(t.srcObject=n),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"_onAudioOutputChanged",value:(t=qn(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._ctx.deviceManager.getCurrentAudioOutputDevice(),e.next=3,null===(t=this._mediaView)||void 0===t||null===(n=t.setSinkId)||void 0===n?void 0:n.call(t,r.deviceId);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_stream",get:function(){return this._localParticipant.masterEndpoint.remoteStream}}]),s}(rl),xl=function(e){Qn(r,e);var t,n=ir(r);function r(e,t){var i;return Hn(this,r),(i=n.call(this))._ctx=e,i._participantCollection=t,i._aliveFailureCount=0,i}return Wn(r,[{key:"onEntered",value:function(){var e=this;switch(this._keepAliveInterval=setInterval((function(){Promise.race([e._sendAlive(),new Promise((function(e,t){return setTimeout(t,5e3)}))]).then((function(){e._aliveFailureCount=0})).catch((function(t){t&&(t.code!==Ln.ERR_ROOM_DELETED?(e._aliveFailureCount+=1,(e._aliveFailureCount>=8||t.code===Ln.ERR_INVALID_ROOM_PARTICIPANT)&&e._dispatchEvent("aliveFailed")):e._dispatchEvent("deleted"))}))}),5e3),this._ctx.roomType){case"small_room_for_video":this._participantManager=new Ll(this._ctx,this._participantCollection);break;case"large_room_for_audio_only":this._participantManager=new Pl(this._ctx,this._participantCollection);break;default:throw new Error("Unsupported room type : ".concat(this._ctx.roomType))}this._registerEventListeners(),this._participantManager.onSelfEntered()}},{key:"exit",value:function(){clearInterval(this._keepAliveInterval),delete this._keepAliveInterval,this._participantManager.removeAllEventListeners(),this._participantManager.exit()}},{key:"setAudioForLargeRoom",value:(t=qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fo.info("setAudioForLargeRoom()"),"large_room_for_audio_only"===this._ctx.roomType){e.next=5;break}throw n=new Error("Room type not audio mcu"),fo.error(n),n;case 5:return e.abrupt("return",this._participantManager.setMediaView(t));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_sendAlive",value:function(){var e=Ic.createAlive(this._ctx.roomId,this._localParticipant.id);return this._ctx.sender.send(e)}},{key:"_registerEventListeners",value:function(){var e=this;this._participantManager.on("remoteParticipantStream",(function(t){e._dispatchEvent("remoteParticipantStream",t)})),this._participantManager.on("localParticipantConnected",(function(t,n){e._dispatchEvent("localParticipantConnected",t,n)})),this._participantManager.on("localParticipantDisconnected",(function(t){e._dispatchEvent("localParticipantDisconnected",t)}))}},{key:"_localParticipant",get:function(){return this._participantCollection.localParticipant}}]),r}(zo),Ml=function(e){Qn(r,e);var t,n=ir(r);function r(){return Hn(this,r),n.call(this)}return Wn(r,[{key:"startStream",value:(t=qn(regeneratorRuntime.mark((function e(){var t,n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getDisplayMedia({video:!0});case 3:t=e.sent,this._stream=t,this._stream.getVideoTracks()[0].onended=function(){r._releaseStream(),r._dispatchEvent("streamStopped")},e.next=23;break;case 8:e.prev=8,e.t0=e.catch(0),e.t1=e.t0.name,e.next="InvalidStateError"===e.t1?13:"NotAllowedError"===e.t1?15:"NotFoundError"===e.t1?17:"NotReadableError"===e.t1?19:21;break;case 13:return n=Ln.ERR_NOT_SUPPORTED_APP_STATE_FOR_SCREEN_SHARE,e.abrupt("break",22);case 15:return n=Ln.ERR_PERMISSION_DENIED_FOR_SCREEN_SHARE,e.abrupt("break",22);case 17:return n=Ln.ERR_SELECTED_CONTENT_NOT_EXIST,e.abrupt("break",22);case 19:return n=Ln.ERR_SELECTED_CONTENT_INACCESSIBLE,e.abrupt("break",22);case 21:n=Ln.ERR_SCREEN_SHARE_FAILED_DUE_TO_UNKNOWN_REASON;case 22:throw new Ja(n);case 23:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return t.apply(this,arguments)})},{key:"stopStream",value:function(){this._releaseStream(),this._dispatchEvent("streamStopped")}},{key:"_releaseStream",value:function(){if(this._stream){var e,t=fr(this._stream.getTracks());try{for(t.s();!(e=t.n()).done;){e.value.stop()}}catch(e){t.e(e)}finally{t.f()}delete this._stream}}},{key:"stream",get:function(){return this._stream}},{key:"isSharing",get:function(){return!!this._stream}}]),r}(zo),Ul=function(e){Qn(r,e);var t,n=ir(r);function r(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};return Hn(this,r),(t=n.call(this))._deviceManager=e,t._mediaConstraints=i,t._screenShare=new Ml,t._screenShare.on("streamStopped",(function(){t._releaseMergedStream(),t._dispatchEvent("screenShareStreamStopped")})),t}return Wn(r,[{key:"useScreenStream",value:(t=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _o(),e.next=3,this._screenShare.startStream();case 3:this._mergeScreenShareStream(),this._dispatchEvent("streamChanged",this.localStream);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLocalMediaStream",value:function(){return this._mediaAccess||this._grantMediaAccess(this._mediaConstraints),this._mediaAccess.stream}},{key:"stopScreenShare",value:function(){this._screenShare.isSharing&&this._screenShare.stopStream()}},{key:"revokeMediaAccess",value:function(){this._mediaAccess&&(this._mediaAccess.dispose(),this._mediaAccess=null)}},{key:"release",value:function(){this.stopScreenShare(),this.revokeMediaAccess()}},{key:"_grantMediaAccess",value:function(e){var t=this;this._mediaAccess=this._deviceManager.useMedia(e),this._mediaAccess.on("streamChanged",(function(){t._screenShare.isSharing&&t._mergeScreenShareStream(),t._dispatchEvent("streamChanged",t.localStream)})),this._mediaAccess.on("audioOutputChanged",(function(){return t._dispatchEvent("audioOutputChanged")}))}},{key:"_mergeScreenShareStream",value:function(){if(this._screenShare.isSharing){var e=new MediaStream;this._mediaAccess.stream&&this._mediaAccess.stream.getAudioTracks().length>0&&e.addTrack(this._mediaAccess.stream.getAudioTracks()[0]),e.addTrack(this.screenStream.getVideoTracks()[0]),this._mergedStream=e}}},{key:"_releaseMergedStream",value:function(){this._mergedStream&&(this._mergedStream.removeTrack(this._mergedStream.getAudioTracks()[0]),delete this._mergedStream,this._dispatchEvent("streamChanged",this.localStream))}},{key:"mediaConstraints",set:function(e){this._mediaConstraints=e}},{key:"hasVideoPermission",get:function(){var e;return null===(e=this._mediaAccess)||void 0===e?void 0:e.hasVideoPermission}},{key:"localStream",get:function(){return this.isScreenSharing?this._mergedStream:this.getLocalMediaStream()}},{key:"mergedStream",get:function(){return this._mergedStream}},{key:"screenStream",get:function(){return this._screenShare.stream}},{key:"isScreenSharing",get:function(){return this._screenShare.isSharing}}]),r}(zo),Vl=function(e){Qn(n,e);var t=ir(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Hn(this,n),Kn(rr(r=t.call(this)),"_remoteParticipants",[]),r._ctx=e,r.initialize(i),r}return Wn(n,[{key:"_getMediaConstraints",value:function(){switch(this._ctx.roomType){case"large_room_for_audio_only":case"small_room_for_audio_only":return{audio:!0,video:!1};default:return{audio:!0,video:!0}}}},{key:"findRemoteById",value:function(e){return this._remoteParticipants.find((function(t){return t.participantId===e}))}},{key:"initialize",value:function(e){var t=this;fo.debug("initialize()",e),this._localStream=new Ul(this._ctx.deviceManager),this._localStream.mediaConstraints=this._getMediaConstraints(),e.forEach((function(e){e.isLocalParticipant?t._localParticipant=new Ol(t._ctx,e,t._localStream):t._remoteParticipants.push(new Dl(t._ctx,e,t._localStream))}))}},{key:"updateInfo",value:function(e){fo.debug("updateInfo()",e),this._stampLocalParticipant(e);var t=e.filter((function(e){return e.isLocalParticipant}))[0],n=e.filter((function(e){return!e.isLocalParticipant}));t&&this._upsertLocalParticipantInfo(t),this._updateRemoteParticipantsInfo(n)}},{key:"exit",value:function(){fo.debug("exit()"),this._localParticipant.exit(),delete this._localParticipant}},{key:"onEvent",value:function(e){switch(e.type){case Xo.PARTICIPANT_ENTERED:this._onEntered(e.payload.participant);break;case Xo.PARTICIPANT_CONNECTED:this._onConnected(e.payload.participant);break;case Xo.PARTICIPANT_EXITED:this._onExited(e.payload.participant);break;case Xo.PARTICIPANT_DISCONNECTED:this._onDisconnected(e.payload.participant,e.payload.reason);break;case Xo.PARTICIPANT_AUDIO_STATUS_CHANGED:this._onAudioSettingsChanged(e.payload.participant);break;case Xo.PARTICIPANT_VIDEO_STATUS_CHANGED:this._onVideoSettingsChanged(e.payload.participant)}}},{key:"_upsertLocalParticipantInfo",value:function(e){fo.debug("_upsertLocalParticipantInfo()"),this._localParticipant?this._localParticipant.updateInfo(e):this._localParticipant=new Ol(this._ctx,e,this._localStream)}},{key:"_updateRemoteParticipantsInfo",value:function(e){var t=this;fo.debug("_updateRemoteParticipantsInfo()"),e.forEach((function(e){return t._upsertParticipantInfo(e)})),this._remoteParticipants.filter((function(t){return!e.some((function(e){return e.participantId===t.id}))})).forEach((function(e){t._deleteParticipantInfo(e)}))}},{key:"_upsertParticipantInfo",value:function(e){fo.debug("_upsertParticipantInfo()");var t=this._updateParticipantInfo(e);return t||this._insertParticipantInfo(e)}},{key:"_insertParticipantInfo",value:function(e){fo.debug("_insertParticipantInfo()");var t=new Dl(this._ctx,e,this._localStream);return this._dispatchEventIfOnCall("entered",t),"connected"===t.state&&this._dispatchEventIfOnCall("connected",t),this._remoteParticipants.push(t),t}},{key:"_updateParticipantInfo",value:function(e){fo.debug("_updateParticipantInfo()");var t=this.findRemoteById(e.participantId);if(!t)return!1;var n,r=fr(t.updateInfo(e).entries());try{for(r.s();!(n=r.n()).done;){var i=or(n.value,2),a=i[0],o=i[1];switch(a){case"isAudioEnabled":this._dispatchEventIfOnCall("audioSettingsChanged",t);break;case"isVideoEnabled":this._dispatchEventIfOnCall("videoSettingsChanged",t);break;case"state":"connected"===o&&this._dispatchEventIfOnCall("connected",t);break;default:fo.debug("_updateParticipantInfo() => Ignore diff\nkey : ",a,"\nvalue : ",o)}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"_deleteParticipantInfo",value:function(e){fo.debug("_deleteParticipantInfo()");var t=this.findRemoteById(e.participantId);if(t){var n=this._remoteParticipants.indexOf(t);this._remoteParticipants.splice(n,1),this._dispatchEventIfOnCall("exited",t)}}},{key:"_stampLocalParticipant",value:function(e){var t=this;this._localParticipant&&(e.find((function(e){return e.participantId===t._localParticipant.participantId})).isLocalParticipant=!0)}},{key:"_onEntered",value:function(e){fo.debug("_onEntered()"),this._upsertParticipantInfo(e)}},{key:"_onConnected",value:function(e){fo.debug("_onConnected()"),this._upsertParticipantInfo(e)}},{key:"_onExited",value:function(e){fo.debug("_onExited()"),this._deleteParticipantInfo(e)}},{key:"_onDisconnected",value:function(e,t){fo.debug("_onDisconnected()"),this._localParticipant.participantId===e.participantId?this._dispatchEvent("selfDisconnected",t):this._deleteParticipantInfo(e)}},{key:"_onAudioSettingsChanged",value:function(e){fo.debug("_onAudioSettingsChanged()"),this._upsertParticipantInfo(e)}},{key:"_onVideoSettingsChanged",value:function(e){fo.debug("_onVideoSettingsChanged()"),this._upsertParticipantInfo(e)}},{key:"_dispatchEventIfOnCall",value:function(e){if(this._isOnCall){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this._dispatchEvent.apply(this,[e].concat(n))}}},{key:"participants",get:function(){var e=sr(this._remoteParticipants);return this._localParticipant&&e.unshift(this._localParticipant),e}},{key:"localParticipant",get:function(){return this._localParticipant}},{key:"remoteParticipants",get:function(){return this._remoteParticipants}},{key:"connectedRemoteParticipants",get:function(){return this._remoteParticipants.filter((function(e){return e.state===Tl.CONNECTED}))}},{key:"localStream",get:function(){return this._localStream}},{key:"_isOnCall",get:function(){return this._ctx.room.isOnCall}}]),n}(zo),Fl=function(){function e(t){var n=t.sender,r=t.room,i=t.inviter,a=t.invitee;Hn(this,e),this._sender=n,this.room=r,this.inviter=i,this.invitee=a}var t,n,r;return Wn(e,[{key:"accept",value:(r=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ic.createAcceptInvitation(this.room.roomId,this.inviter.userId),e.abrupt("return",this._sender.send(t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"decline",value:(n=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ic.createDeclineInvitation(this.room.roomId,this.inviter.userId),e.abrupt("return",this._sender.send(t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"cancel",value:(t=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ic.createCancelInvitation(this.room.roomId,this.invitee.userId),e.abrupt("return",this._sender.send(t));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();!function(e){e.SMALL_ROOM_FOR_AUDIO_ONLY="small_room_for_audio_only",e.LARGE_ROOM_FOR_AUDIO_ONLY="large_room_for_audio_only",e.SMALL_ROOM_FOR_VIDEO="small_room_for_video",e.LARGE_ROOM_FOR_VIDEO="large_room_for_video"}(Nl||(Nl={}));var Gl,Bl=function(e){Qn(o,e);var t,n,r,i,a=ir(o);function o(e,t){var n;return Hn(this,o),Kn(rr(n=a.call(this)),"_enterLock",new $o),Kn(rr(n),"_customItemsUpdatedAt",0),n._ctx=Zn(Zn({},e),{},{room:rr(n),roomId:t.roomId,roomType:t.roomType,customItems:t.customItems}),n.initialize(t),n._registerCollectionEventListeners(),n}return Wn(o,[{key:"_send",value:function(e){return this._ctx.sender.send(e)}},{key:"initialize",value:function(e){var t=e.participants,n=nr(e,["participants"]);Object.assign(this,n),this._participantCollection?this._participantCollection.initialize(t):this._participantCollection=new Vl(this._ctx,e.participants)}},{key:"updateInfo",value:function(e){var t=e.participants,n=nr(e,["participants"]);return Object.assign(this,n),this._participantCollection.updateInfo(t),this}},{key:"onEvent",value:function(e){var t=this;this._enterLock.acquire().then((function(){t._processEvent(e),t._enterLock.release()}))}},{key:"fetchCustomItems",value:function(){var e=this,t=Ic.createFetchCustomItems(this.roomId);return this._send(t).then((function(t){var n=t.payload;return e._setCustomItems(n.customItems,n.affectedAt),n})).catch((function(e){throw fo.error("failed to update customItems"),e}))}},{key:"updateCustomItems",value:function(e){var t=this,n=or(ro(e),2)[1];if(n)return n;var r=Ic.createUpdateCustomItems(this.roomId,e,"upsert");return this._send(r).then((function(e){var n=e.payload;return t._setCustomItems(n.customItems,n.affectedAt),n})).catch((function(e){throw fo.error("failed to update customItems"),e}))}},{key:"deleteCustomItems",value:function(e){var t=this,n=or(io(e),2)[1];if(n)return n;var r=Ic.createDeleteCustomItems(this.roomId,e);return this._send(r).then((function(e){var n=e.payload;return t._setCustomItems(n.customItems,n.affectedAt),n})).catch((function(e){throw fo.error("failed to delete customItems"),e}))}},{key:"_setCustomItems",value:function(e,t){return t>this._customItemsUpdatedAt&&(this._customItemsUpdatedAt=t,this.customItems=e||{},!0)}},{key:"_processEvent",value:function(e){switch(e.type){case Xo.CUSTOM_ITEMS_UPDATE:this._updateCustomItems(e);break;case Xo.CUSTOM_ITEMS_DELETE:this._deleteCustomItems(e);break;case Xo.ROOM_DELETED:this._dispatchEvent("deleted"),this._teardown();break;case Xo.INVITATION_DECLINED:this._dispatchEvent("invitationDeclined",new Fl({sender:this._ctx.sender,room:this,inviter:e.payload.inviter,invitee:e.payload.invitee}));break;case Xo.INVITATION_ACCEPTED:this._dispatchEvent("invitationAccepted",new Fl({sender:this._ctx.sender,room:this,inviter:e.payload.inviter,invitee:e.payload.invitee}));break;case Xo.INVITATION_CANCELED:this._dispatchEvent("invitationCanceled",new Fl({sender:this._ctx.sender,room:this,inviter:e.payload.inviter,invitee:e.payload.invitee}));break;case Xo.PARTICIPANT_ENTERED:case Xo.PARTICIPANT_CONNECTED:case Xo.PARTICIPANT_EXITED:case Xo.PARTICIPANT_DISCONNECTED:case Xo.PARTICIPANT_AUDIO_STATUS_CHANGED:case Xo.PARTICIPANT_VIDEO_STATUS_CHANGED:this._passToCollection(e)}}},{key:"enter",value:(i=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fo.info("enter()"),!this._session){e.next=5;break}throw n=new Ja(Ln.ERR_CLIENT_ALREADY_ENTERED),fo.debug(n),n;case 5:return e.next=7,this._enterLock.acquire();case 7:return e.prev=7,e.next=10,this._sendEnter(t);case 10:r=e.sent,e.next=18;break;case 13:throw e.prev=13,e.t0=e.catch(7),this._enterLock.release(),fo.error(e.t0),e.t0;case 18:this.updateInfo(r.payload.room),this._session=new xl(this._ctx,this._participantCollection),this._registerSessionEventListeners(),this._session.onEntered(),this._enterLock.release();case 23:case"end":return e.stop()}}),e,this,[[7,13]])}))),function(e){return i.apply(this,arguments)})},{key:"exit",value:function(){fo.info("exit()"),this._validateEntered();var e=this.localParticipant.id;this._teardown(),this._sendExit(e).catch((function(e){fo.error("_sendExit() failed : ",e)}))}},{key:"setAudioForLargeRoom",value:(r=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fo.info("setAudioForLargeRoom()"),this._validateEntered(),e.abrupt("return",this._session.setAudioForLargeRoom(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"sendInvitation",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Ic.createSendInvitation(this.roomId,t),e.next=3,this._ctx.sender.send(n);case 3:return r=e.sent,e.abrupt("return",new Fl({sender:this._ctx.sender,room:this,inviter:r.payload.inviter,invitee:r.payload.invitee}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"delete",value:(t=qn(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sendDelete(this.roomId);case 2:t=e.sent,this.updateInfo(t.payload.room),this._dispatchEvent("deleted");case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_validateEntered",value:function(){if(!this._session){var e=new Ja(Ln.ERR_PARTICIPANT_NOT_IN_ROOM);throw fo.debug(e),e}}},{key:"_registerSessionEventListeners",value:function(){var e=this;this._session.on("remoteParticipantStream",(function(t){e._dispatchEvent("remoteParticipantStreamStarted",t)})),this._session.on("localParticipantConnected",(function(t,n){n&&e._dispatchEvent("localParticipantReconnected",t)})),this._session.on("localParticipantDisconnected",(function(t){e._dispatchEvent("localParticipantDisconnected",t)})),this._session.on("aliveFailed",(function(){e._dispatchEvent("error",new Ja(Ln.ERR_LOCAL_PARTICIPANT_LOST_CONNECTION)),e._teardown()})),this._session.on("deleted",(function(){e._dispatchEvent("deleted"),e._teardown()}))}},{key:"_registerCollectionEventListeners",value:function(){var e=this;this._participantCollection.on("entered",(function(t){e._dispatchEvent("remoteParticipantEntered",t)})),this._participantCollection.on("connected",(function(t){e._dispatchEvent("remoteParticipantConnected",t)})),this._participantCollection.on("exited",(function(t){e._dispatchEvent("remoteParticipantExited",t)})),this._participantCollection.on("audioSettingsChanged",(function(t){e._dispatchEvent("remoteAudioSettingsChanged",t)})),this._participantCollection.on("videoSettingsChanged",(function(t){e._dispatchEvent("remoteVideoSettingsChanged",t)})),this._participantCollection.on("selfDisconnected",(function(t){if(e._teardown(),"sibling_kicked"===t)e._dispatchEvent("error",new Ja(Ln.ERR_LOCAL_PARTICIPANT_KICKED_OUT));else e._dispatchEvent("error",new Ja(Ln.ERR_LOCAL_PARTICIPANT_LOST_CONNECTION))}))}},{key:"_updateCustomItems",value:function(e){var t=e.payload,n=t.customItems,r=t.updated,i=t.affectedAt;this._setCustomItems(n,i)&&this._dispatchEvent("customItemsUpdated",n,r)}},{key:"_deleteCustomItems",value:function(e){var t=e.payload,n=t.customItems,r=t.deleted,i=t.affectedAt;this._setCustomItems(n,i)&&this._dispatchEvent("customItemsDeleted",n,r)}},{key:"_passToCollection",value:function(e){this._participantCollection.onEvent(e)}},{key:"_sendEnter",value:function(e){var t=Ic.createEnter(this._ctx.roomId,e);return this._ctx.sender.send(t)}},{key:"_sendExit",value:function(e){var t=Ic.createExit(this._ctx.roomId,e);return this._ctx.sender.send(t)}},{key:"_sendDelete",value:function(e){var t=Ic.createDeleteRoom(e);return this._ctx.sender.send(t)}},{key:"_teardown",value:function(){this._session.removeAllEventListeners(),this._session.exit(),this._participantCollection.exit(),delete this._session}},{key:"participants",get:function(){return this._participantCollection.participants}},{key:"localParticipant",get:function(){return this._participantCollection.localParticipant}},{key:"remoteParticipants",get:function(){return this._participantCollection.remoteParticipants}},{key:"isOnCall",get:function(){return!!this._session}}]),o}(zo);!function(e){e.OPEN="open",e.DELETED="deleted"}(Gl||(Gl={}));var jl,ql=function(){function e(t){Hn(this,e),this._ctx=t}return Wn(e,[{key:"createRoom",value:function(e){return new Bl(this._ctx,e)}}]),e}(),Hl=function(){function e(t){Hn(this,e),this._ctx=t,this._factory=new ql(t),this._rooms=new Map,this._sendbirdCallListeners=new Map}var t,n;return Wn(e,[{key:"_hasRoom",value:function(e){return this._rooms.has(e)}},{key:"onEvent",value:function(e){switch(e.type){case Xo.INVITATION_SENT:this._onInvitation(e);break;case Xo.CUSTOM_ITEMS_UPDATE:case Xo.CUSTOM_ITEMS_DELETE:case Xo.ROOM_DELETED:case Xo.PARTICIPANT_CONNECTED:case Xo.PARTICIPANT_ENTERED:case Xo.PARTICIPANT_EXITED:case Xo.PARTICIPANT_DISCONNECTED:case Xo.PARTICIPANT_AUDIO_STATUS_CHANGED:case Xo.PARTICIPANT_VIDEO_STATUS_CHANGED:case Xo.INVITATION_CANCELED:case Xo.INVITATION_ACCEPTED:case Xo.INVITATION_DECLINED:this._passToRoom(e);break;default:fo.error(new Error("unhandled room event ".concat(e.type)))}}},{key:"addListener",value:function(e,t){this._sendbirdCallListeners.set(e,t)}},{key:"removeListener",value:function(e){this._sendbirdCallListeners.delete(e)}},{key:"removeAllListeners",value:function(){this._sendbirdCallListeners.clear()}},{key:"_onInvitation",value:function(e){var t;this._sendInvitationReceiveCommand(e),(t=this._rooms.get(e.payload.room.roomId))||(t=this._factory.createRoom(e.payload.room),this._rooms.set(t.roomId,t));var n,r=new Fl({sender:this._ctx.sender,room:t,inviter:e.payload.inviter,invitee:e.payload.invitee}),i=fr(this._sendbirdCallListeners.values());try{for(i.s();!(n=i.n()).done;){var a,o=n.value;null===(a=o.onInvitationReceived)||void 0===a||a.call(o,r)}}catch(e){i.e(e)}finally{i.f()}}},{key:"_sendInvitationReceiveCommand",value:function(e){var t=Ic.createInvitationReceive(e.payload.room.roomId,e.payload.inviter.userId,e.payload.shortLivedToken);return this._ctx.sender.send(t).catch((function(){}))}},{key:"_passToRoom",value:function(e){this._hasRoom(e.getRoomId())?this._rooms.get(e.getRoomId()).onEvent(e):fo.debug("received command ".concat(e.type," for non-existing room ").concat(e.getRoomId()))}},{key:"createRoom",value:(n=qn(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sendCreate(t);case 2:return n=e.sent,r=this._factory.createRoom(n.payload.room),this._rooms.set(r.roomId,r),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getCachedRoomById",value:function(e){return this._rooms.get(e)}},{key:"fetchRoomById",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._sendGetRoom(t);case 2:if(n=e.sent,!(r=this._rooms.get(t))){e.next=7;break}return r.updateInfo(n.payload.room),e.abrupt("return",r);case 7:return i=this._factory.createRoom(n.payload.room),this._rooms.set(i.roomId,i),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_sendCreate",value:function(e){var t=Ic.createCreate(e);return this._ctx.sender.send(t)}},{key:"_sendGetRoom",value:function(e){var t=Ic.createGet(e);return this._ctx.sender.send(t)}},{key:"clear",value:function(){var e,t=fr(this._rooms.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isOnCall&&n.exit()}}catch(e){t.e(e)}finally{t.f()}this._rooms.clear()}}]),e}();!function(e){e.DIALING="DIALING",e.RINGING="RINGING",e.RECONNECTING="RECONNECTING",e.RECONNECTED="RECONNECTED"}(jl||(jl={}));var zl,Wl,Kl,Yl=function(){function e(){Hn(this,e),this.audioElms=new Map}var t,n;return Wn(e,[{key:"loadSound",value:(n=qn(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof n&&n){e.next=2;break}return e.abrupt("return",!1);case 2:return(r=this._createAudio(t)).src=n,r.volume=0,e.prev=5,e.next=8,r.play();case 8:r.pause(),r.currentTime=0,r.volume=1,this.audioElms.set(t,r),e.next=18;break;case 14:return e.prev=14,e.t0=e.catch(5),fo.error(e.t0),e.abrupt("return",!1);case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e,t){return n.apply(this,arguments)})},{key:"unloadSound",value:function(e){return!!this.audioElms.get(e)&&this.audioElms.delete(e)}},{key:"playSound",value:(t=qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.audioElms.get(t)){e.next=3;break}return e.abrupt("return",!1);case 3:return e.prev=3,n.currentTime=0,e.next=7,n.play();case 7:e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),fo.error(e.t0),e.abrupt("return",!1);case 13:return e.abrupt("return",!0);case 14:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return t.apply(this,arguments)})},{key:"stopSound",value:function(e){var t=this.audioElms.get(e);return!!t&&t.pause()}},{key:"stopAllSound",value:function(){var e,t=fr(this.audioElms.values());try{for(t.s();!(e=t.n()).done;){e.value.pause()}}catch(e){t.e(e)}finally{t.f()}}},{key:"isPlaying",value:function(e){var t=this.audioElms.get(e);return t&&!t.paused}},{key:"_isLoop",value:function(e){return e===jl.DIALING||e===jl.RINGING}},{key:"_createAudio",value:function(e){var t=new Audio;return t.autoplay=!1,t.muted=!1,t.loop=this._isLoop(e),t}}]),e}();function Zl(e){return function(t){var n=t.descriptor.value;return t.descriptor.value=function(){if(Zl.checkIE())throw new Error(null!=e?e:"Method ".concat(t.key," is not supported in Internet Explorer"));for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return n.call.apply(n,[this].concat(i))},t}}!function(e){e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.NONE="NONE"}(zl||(zl={})),function(e){e.RECORDING="recording",e.NONE="none"}(Wl||(Wl={})),function(e){e.APNS="apns_voip",e.FCM="fcm_voip"}(Kl||(Kl={})),Zl.checkIE=function(){return!!window&&(window.navigator.userAgent.indexOf("MSIE ")>0||!!navigator.userAgent.match(/Trident.*rv:11\./))},Zl.messages={CALL_IS_NOT_SUPPORTED:"Call is not supported in Internet Explorer"};var Ql,Xl,$l,Jl,ed="1.10.5",td=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}($a),nd=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.call(this)}return Wn(n,[{key:"getApiOption",value:function(){return{auth:this.getAuth(),path:this.getPath(),method:this.getMethod(),body:this.getData(),headers:this.getHeaders()}}},{key:"getAuth",value:function(){return!0}},{key:"getHeaders",value:function(){return{}}}]),n}(Jo),rd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).statsLog=e,r}return Wn(n,[{key:"getData",value:function(){return{log_group:"sdk_webrtc_statistics_v1.1",log_data:this.statsLog}}},{key:"getPath",value:function(){return"/v1/sdk/logs"}},{key:"getMethod",value:function(){return"POST"}}]),n}(nd),id=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).version=1,i.isOverflowLogs=r,i.logs=e,i}return Wn(n,[{key:"getData",value:function(){return{version:this.version,is_overflow_logs:this.isOverflowLogs,logs:this.getLogsData()}}},{key:"getPath",value:function(){return"/v1/sdk/debug_logs"}},{key:"getMethod",value:function(){return"POST"}},{key:"getLogsData",value:function(){return this.logs.map((function(e){return{log_dt:e.logDt,log_level:e.logLevel,log_message:e.logMessage}}))}}]),n}(nd),ad=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).appId=e,a.userId=r,a.accessToken=i,a}return Wn(n,[{key:"getAuth",value:function(){return!1}},{key:"getData",value:function(){return{app_id:this.appId,user_id:this.userId,access_token:this.accessToken}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/login")}},{key:"getMethod",value:function(){return"POST"}}]),n}(nd),od=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).userId=e,a.params=r,a.next=i,a}return Wn(n,[{key:"getData",value:function(){}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/calls?").concat(this._createQuery())}},{key:"getMethod",value:function(){return"GET"}},{key:"_createQuery",value:function(){var e;return Ss.createQuery({role:this.params.myRole,limit:this._applyLimitConstraints(null===(e=this.params)||void 0===e?void 0:e.limit),end_result:this.params.endResults,next:this.next})}},{key:"_applyLimitConstraints",value:function(e){return null!=e?Math.min(Math.max(e,10),100):void 0}}]),n}(nd),sd=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).userId=e,a.pushToken=r,a.tokenType=i,a}return Wn(n,[{key:"getAuth",value:function(){return!0}},{key:"getData",value:function(){return{token:this.pushToken,is_unique:!0}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/push/").concat(this.tokenType)}},{key:"getMethod",value:function(){return"POST"}}]),n}(nd),cd=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).userId=e,a.pushToken=r,a.tokenType=i,a}return Wn(n,[{key:"getAuth",value:function(){return!0}},{key:"getData",value:function(){return{}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/push/").concat(this.tokenType,"/").concat(this.pushToken)}},{key:"getMethod",value:function(){return"DELETE"}}]),n}(nd),ud=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).userId=e,i.tokenType=r,i}return Wn(n,[{key:"getAuth",value:function(){return!0}},{key:"getData",value:function(){return{}}},{key:"getPath",value:function(){return"/v1/users/".concat(encodeURIComponent(this.userId),"/push/").concat(this.tokenType)}},{key:"getMethod",value:function(){return"DELETE"}}]),n}(nd),ld=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"getPath",value:function(){return"/v1/direct_calls".concat(this.getSubPath())}}]),n}(nd);!function(e){e.CALL="CALL",e.SGNL="SGNL",e.COMM="COMM",e.UTIL="UTIL"}(Ql||(Ql={})),function(e){e[e.WS=0]="WS",e[e.API=1]="API",e[e.BOTH=2]="BOTH"}(Xl||(Xl={})),function(e){e.API="api",e.CMD_RETRIEVING="cmd_retrieving",e.WEBHOOK="webhook",e.WS="ws",e.PUSH="push"}($l||($l={})),function(e){e.REMOTE_PUSH="remote_push",e.VOIP_PUSH="voip_push",e.WEBHOOK="webhook",e.WS="ws"}(Jl||(Jl={}));var dd,hd=function(e){Qn(n,e);var t=ir(n);function n(){var e;return Hn(this,n),(e=t.call(this)).version=1,e.requestId=Nc(),e}return Wn(n,[{key:"getApiOption",value:function(){return{auth:!0,path:"/v1/action/direct_call",method:"POST",headers:this.getHeaders(),body:{version:this.version,request_id:this.requestId,cmd:this.getCMD(),type:this.getType(),payload:this.getData()}}}},{key:"serialize",value:function(){return JSON.stringify({version:this.version,request_id:this.requestId,cmd:this.getCMD(),type:this.getType(),payload:this.getData()})}},{key:"requireResponse",value:function(){return!1}},{key:"getHeaders",value:function(){return{}}},{key:"sendStrategy",get:function(){return Xl.WS}}]),n}(Jo),fd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).cmd=e.cmd,r.type=e.type,r.payload=e.payload||{},r}return n}(Jo),_d=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getCallId",value:function(){return this.payload.callId}}]),n}(fd),vd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).version=e.version,r.messageId=e.message_id,r.cmd=e.cmd,r.type=e.type,r.deliveryInfo=e.delivery_info,r.sequenceNumber=e.sequence_number,r.payload=r.parseData(e.payload),r}return Wn(n,[{key:"getCallId",value:function(){return this.payload.callId}},{key:"isSequential",value:function(){return"number"==typeof this.sequenceNumber}}]),n}(Jo),pd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).version=e.version,r.requestId=e.request_id,r.cmd=e.cmd,r.type=e.type,r.deliveryInfo=e.delivery_info,r.sequenceNumber=e.sequence_number,r.payload=r.parseData(e.payload),r}return Wn(n,[{key:"getCallId",value:function(){return this.payload.callId}},{key:"isSequential",value:function(){return"number"==typeof this.sequenceNumber}}]),n}(Jo),yd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).version=e.version,r.messageId=e.message_id,r.cmd=e.cmd,r.type=e.type,r.deliveryInfo=e.delivery_info,r.sequenceNumber=e.sequence_number,r.payload=r.parseData(e.payload),r}return Wn(n,[{key:"isSequential",value:function(){return"number"==typeof this.sequenceNumber}}]),n}(Jo),md=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getCallId",value:function(){return this.payload.callId}}]),n}(yd),gd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this,null)).callIds=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getData",value:function(){}},{key:"getSubPath",value:function(){var e=this.callIds.join(",");return"/missed_signal?call_ids=".concat(encodeURIComponent(e))}},{key:"getMethod",value:function(){return"GET"}}]),n}(ld),Ed=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"getData",value:function(){return{}}},{key:"getSubPath",value:function(){return"/".concat(this.callId,"/custom_items")}},{key:"getMethod",value:function(){return"DELETE"}}]),n}(ld),kd=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this,e)).keys=r,i}return Wn(n,[{key:"getData",value:function(){return{keys:this.keys}}},{key:"getSubPath",value:function(){return"/".concat(this.callId,"/custom_items")}},{key:"getMethod",value:function(){return"DELETE"}}]),n}(ld),Rd=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this,e)).customItems=r,i}return Wn(n,[{key:"getData",value:function(){return{custom_items:this.customItems,mode:"upsert"}}},{key:"getSubPath",value:function(){return"/".concat(this.callId,"/custom_items")}},{key:"getMethod",value:function(){return"PUT"}}]),n}(ld),Cd=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this,e)).userRole=r,a.data=i,a}return Wn(n,[{key:"getData",value:function(){return{version:1,user_role:this.userRole,summary_data:this.data}}},{key:"getSubPath",value:function(){return"/".concat(this.callId,"/summary")}},{key:"getMethod",value:function(){return"POST"}}]),n}(ld);!function(e){e.DIAL="dial",e.DIAL_ACK="dial_ack",e.DIAL_RCV="dial_rcv",e.CANCEL="cancel",e.ACCEPT="accept",e.ACCEPT_ACK="accept_ack",e.OTHER_DEVICE_ACCEPTED="other_device_accepted",e.DECLINE="decline",e.DECLINE_ACK="decline_ack",e.OFFER="offer",e.ANSWER="answer",e.CANDIDATE="candidate",e.REMOVE_CANDIDATES="remove_candidates",e.AUDIO="audio",e.VIDEO="video",e.HOLD="hold",e.HOLD_ACK="hold_ack",e.CUSTOM_ITEMS_UPDATE="custom_items_update",e.CUSTOM_ITEMS_DELETE="custom_items_delete",e.RECORDING="recording",e.END="end",e.TIME_OUT="timeout",e.CONNECTION_LOST="connection_lost",e.UNKNOWN_END="unknown_end",e.ALIVE="alive",e.NO_ANSWER="no_answer",e.CANCEL_ACK="cancel_ack",e.END_ACK="end_ack",e.TIMEOUT_ACK="timeout_ack",e.NO_ANSWER_ACK="no_answer_ack",e.CONNECTION_LOST_ACK="connection_lost_ack",e.UNKNOWN_END_ACK="unknown_end_ack",e.ALIVE_ACK="alive_ack",e.CONNECTED="connected",e.SNAPSHOT="snapshot",e.TURN_CHANGED="turn_changed"}(dd||(dd={}));var Id=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,{type:dd.DECLINE_ACK,cmd:Ql.SGNL,payload:e})),"type",dd.DECLINE_ACK),r}return n}(_d),wd=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),Kn(rr(r=t.call(this,{type:dd.SNAPSHOT,cmd:Ql.SGNL,payload:e})),"type",dd.SNAPSHOT),r}return n}(_d),Ad=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.ACCEPT),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,turnCredential:{username:e.turn_credential.username,password:e.turn_credential.password,turnUrls:e.turn_credential.turn_urls,transportPolicy:e.turn_credential.transport_policy},constraints:{audio:e.audio,video:e.video},capabilities:e.capabilities||[]}}}]),n}(vd),Td=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.OTHER_DEVICE_ACCEPTED),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id}}}]),n}(vd),bd=t((function(e,t){var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,r,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+r),i);else for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){var t,n,r,i,a,o;for(r=0,t=0,n=e.length;t<n;t++)r+=e[t].length;for(o=new Uint8Array(r),i=0,t=0,n=e.length;t<n;t++)a=e[t],o.set(a,i),i+=a.length;return o}},a={arraySet:function(e,t,n,r,i){for(var a=0;a<r;a++)e[i+a]=t[n+a]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(n)})),Sd=(bd.assign,bd.shrinkBuf,bd.setTyped,bd.Buf8,bd.Buf16,bd.Buf32,4),Od=0,Dd=1,Nd=2;function Ld(e){for(var t=e.length;--t>=0;)e[t]=0}var Pd=0,xd=1,Md=2,Ud=29,Vd=256,Fd=Vd+1+Ud,Gd=30,Bd=19,jd=2*Fd+1,qd=15,Hd=16,zd=7,Wd=256,Kd=16,Yd=17,Zd=18,Qd=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Xd=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],$d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Jd=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],eh=new Array(2*(Fd+2));Ld(eh);var th=new Array(2*Gd);Ld(th);var nh=new Array(512);Ld(nh);var rh=new Array(256);Ld(rh);var ih=new Array(Ud);Ld(ih);var ah,oh,sh,ch=new Array(Gd);function uh(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function lh(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function dh(e){return e<256?nh[e]:nh[256+(e>>>7)]}function hh(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function fh(e,t,n){e.bi_valid>Hd-n?(e.bi_buf|=t<<e.bi_valid&65535,hh(e,e.bi_buf),e.bi_buf=t>>Hd-e.bi_valid,e.bi_valid+=n-Hd):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function _h(e,t,n){fh(e,n[2*t],n[2*t+1])}function vh(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function ph(e,t,n){var r,i,a=new Array(qd+1),o=0;for(r=1;r<=qd;r++)a[r]=o=o+n[r-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=vh(a[s]++,s))}}function yh(e){var t;for(t=0;t<Fd;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Gd;t++)e.dyn_dtree[2*t]=0;for(t=0;t<Bd;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Wd]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function mh(e){e.bi_valid>8?hh(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function gh(e,t,n,r){var i=2*t,a=2*n;return e[i]<e[a]||e[i]===e[a]&&r[t]<=r[n]}function Eh(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&gh(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!gh(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r}function kh(e,t,n){var r,i,a,o,s=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===r?_h(e,i,t):(_h(e,(a=rh[i])+Vd+1,t),0!==(o=Qd[a])&&fh(e,i-=ih[a],o),_h(e,a=dh(--r),n),0!==(o=Xd[a])&&fh(e,r-=ch[a],o))}while(s<e.last_lit);_h(e,Wd,t)}function Rh(e,t){var n,r,i,a=t.dyn_tree,o=t.stat_desc.static_tree,s=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=jd,n=0;n<c;n++)0!==a[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):a[2*n+1]=0;for(;e.heap_len<2;)a[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=o[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)Eh(e,a,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Eh(e,a,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,a[2*i]=a[2*n]+a[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,a[2*n+1]=a[2*r+1]=i,e.heap[1]=i++,Eh(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,a,o,s,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,_=t.stat_desc.max_length,v=0;for(a=0;a<=qd;a++)e.bl_count[a]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<jd;n++)(a=c[2*c[2*(r=e.heap[n])+1]+1]+1)>_&&(a=_,v++),c[2*r+1]=a,r>u||(e.bl_count[a]++,o=0,r>=f&&(o=h[r-f]),s=c[2*r],e.opt_len+=s*(a+o),d&&(e.static_len+=s*(l[2*r+1]+o)));if(0!==v){do{for(a=_-1;0===e.bl_count[a];)a--;e.bl_count[a]--,e.bl_count[a+1]+=2,e.bl_count[_]--,v-=2}while(v>0);for(a=_;0!==a;a--)for(r=e.bl_count[a];0!==r;)(i=e.heap[--n])>u||(c[2*i+1]!==a&&(e.opt_len+=(a-c[2*i+1])*c[2*i],c[2*i+1]=a),r--)}}(e,t),ph(a,u,e.bl_count)}function Ch(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=t[2*(r+1)+1],++s<c&&i===o||(s<u?e.bl_tree[2*i]+=s:0!==i?(i!==a&&e.bl_tree[2*i]++,e.bl_tree[2*Kd]++):s<=10?e.bl_tree[2*Yd]++:e.bl_tree[2*Zd]++,s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4))}function Ih(e,t,n){var r,i,a=-1,o=t[1],s=0,c=7,u=4;for(0===o&&(c=138,u=3),r=0;r<=n;r++)if(i=o,o=t[2*(r+1)+1],!(++s<c&&i===o)){if(s<u)do{_h(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==a&&(_h(e,i,e.bl_tree),s--),_h(e,Kd,e.bl_tree),fh(e,s-3,2)):s<=10?(_h(e,Yd,e.bl_tree),fh(e,s-3,3)):(_h(e,Zd,e.bl_tree),fh(e,s-11,7));s=0,a=i,0===o?(c=138,u=3):i===o?(c=6,u=3):(c=7,u=4)}}Ld(ch);var wh=!1;function Ah(e,t,n,r){fh(e,(Pd<<1)+(r?1:0),3),function(e,t,n,r){mh(e),r&&(hh(e,n),hh(e,~n)),bd.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}(e,t,n,!0)}var Th=function(e,t,n,r){var i,a,o=0;e.level>0?(e.strm.data_type===Nd&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return Od;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Dd;for(t=32;t<Vd;t++)if(0!==e.dyn_ltree[2*t])return Dd;return Od}(e)),Rh(e,e.l_desc),Rh(e,e.d_desc),o=function(e){var t;for(Ch(e,e.dyn_ltree,e.l_desc.max_code),Ch(e,e.dyn_dtree,e.d_desc.max_code),Rh(e,e.bl_desc),t=Bd-1;t>=3&&0===e.bl_tree[2*Jd[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=i&&(i=a)):i=a=n+5,n+4<=i&&-1!==t?Ah(e,t,n,r):e.strategy===Sd||a===i?(fh(e,(xd<<1)+(r?1:0),3),kh(e,eh,th)):(fh(e,(Md<<1)+(r?1:0),3),function(e,t,n,r){var i;for(fh(e,t-257,5),fh(e,n-1,5),fh(e,r-4,4),i=0;i<r;i++)fh(e,e.bl_tree[2*Jd[i]+1],3);Ih(e,e.dyn_ltree,t-1),Ih(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),kh(e,e.dyn_ltree,e.dyn_dtree)),yh(e),r&&mh(e)},bh={_tr_init:function(e){wh||(!function(){var e,t,n,r,i,a=new Array(qd+1);for(n=0,r=0;r<Ud-1;r++)for(ih[r]=n,e=0;e<1<<Qd[r];e++)rh[n++]=r;for(rh[n-1]=r,i=0,r=0;r<16;r++)for(ch[r]=i,e=0;e<1<<Xd[r];e++)nh[i++]=r;for(i>>=7;r<Gd;r++)for(ch[r]=i<<7,e=0;e<1<<Xd[r]-7;e++)nh[256+i++]=r;for(t=0;t<=qd;t++)a[t]=0;for(e=0;e<=143;)eh[2*e+1]=8,e++,a[8]++;for(;e<=255;)eh[2*e+1]=9,e++,a[9]++;for(;e<=279;)eh[2*e+1]=7,e++,a[7]++;for(;e<=287;)eh[2*e+1]=8,e++,a[8]++;for(ph(eh,Fd+1,a),e=0;e<Gd;e++)th[2*e+1]=5,th[2*e]=vh(e,5);ah=new uh(eh,Qd,Vd+1,Fd,qd),oh=new uh(th,Xd,0,Gd,qd),sh=new uh(new Array(0),$d,0,Bd,zd)}(),wh=!0),e.l_desc=new lh(e.dyn_ltree,ah),e.d_desc=new lh(e.dyn_dtree,oh),e.bl_desc=new lh(e.bl_tree,sh),e.bi_buf=0,e.bi_valid=0,yh(e)},_tr_stored_block:Ah,_tr_flush_block:Th,_tr_tally:function(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(rh[n]+Vd+1)]++,e.dyn_dtree[2*dh(t)]++),e.last_lit===e.lit_bufsize-1},_tr_align:function(e){fh(e,xd<<1,3),_h(e,Wd,eh),function(e){16===e.bi_valid?(hh(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}};var Sh=function(e,t,n,r){for(var i=65535&e|0,a=e>>>16&65535|0,o=0;0!==n;){n-=o=n>2e3?2e3:n;do{a=a+(i=i+t[r++]|0)|0}while(--o);i%=65521,a%=65521}return i|a<<16|0};var Oh=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();var Dh,Nh=function(e,t,n,r){var i=Oh,a=r+n;e^=-1;for(var o=r;o<a;o++)e=e>>>8^i[255&(e^t[o])];return-1^e},Lh={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Ph=0,xh=1,Mh=3,Uh=4,Vh=5,Fh=0,Gh=1,Bh=-2,jh=-3,qh=-5,Hh=-1,zh=1,Wh=2,Kh=3,Yh=4,Zh=0,Qh=2,Xh=8,$h=9,Jh=15,ef=8,tf=286,nf=30,rf=19,af=2*tf+1,of=15,sf=3,cf=258,uf=cf+sf+1,lf=32,df=42,hf=69,ff=73,_f=91,vf=103,pf=113,yf=666,mf=1,gf=2,Ef=3,kf=4,Rf=3;function Cf(e,t){return e.msg=Lh[t],t}function If(e){return(e<<1)-(e>4?9:0)}function wf(e){for(var t=e.length;--t>=0;)e[t]=0}function Af(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(bd.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Tf(e,t){bh._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Af(e.strm)}function bf(e,t){e.pending_buf[e.pending++]=t}function Sf(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Of(e,t){var n,r,i=e.max_chain_length,a=e.strstart,o=e.prev_length,s=e.nice_match,c=e.strstart>e.w_size-uf?e.strstart-(e.w_size-uf):0,u=e.window,l=e.w_mask,d=e.prev,h=e.strstart+cf,f=u[a+o-1],_=u[a+o];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(u[(n=t)+o]===_&&u[n+o-1]===f&&u[n]===u[a]&&u[++n]===u[a+1]){a+=2,n++;do{}while(u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&u[++a]===u[++n]&&a<h);if(r=cf-(h-a),a=h-cf,r>o){if(e.match_start=t,o=r,r>=s)break;f=u[a+o-1],_=u[a+o]}}}while((t=d[t&l])>c&&0!=--i);return o<=e.lookahead?o:e.lookahead}function Df(e){var t,n,r,i,a,o,s,c,u,l,d=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-uf)){bd.arraySet(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=d?r-d:0}while(--n);t=n=d;do{r=e.prev[--t],e.prev[t]=r>=d?r-d:0}while(--n);i+=d}if(0===e.strm.avail_in)break;if(o=e.strm,s=e.window,c=e.strstart+e.lookahead,u=i,l=void 0,(l=o.avail_in)>u&&(l=u),n=0===l?0:(o.avail_in-=l,bd.arraySet(s,o.input,o.next_in,l,c),1===o.state.wrap?o.adler=Sh(o.adler,s,l,c):2===o.state.wrap&&(o.adler=Nh(o.adler,s,l,c)),o.next_in+=l,o.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=sf)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+sf-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<sf)););}while(e.lookahead<uf&&0!==e.strm.avail_in)}function Nf(e,t){for(var n,r;;){if(e.lookahead<uf){if(Df(e),e.lookahead<uf&&t===Ph)return mf;if(0===e.lookahead)break}if(n=0,e.lookahead>=sf&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+sf-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-uf&&(e.match_length=Of(e,n)),e.match_length>=sf)if(r=bh._tr_tally(e,e.strstart-e.match_start,e.match_length-sf),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=sf){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+sf-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=bh._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Tf(e,!1),0===e.strm.avail_out))return mf}return e.insert=e.strstart<sf-1?e.strstart:sf-1,t===Uh?(Tf(e,!0),0===e.strm.avail_out?Ef:kf):e.last_lit&&(Tf(e,!1),0===e.strm.avail_out)?mf:gf}function Lf(e,t){for(var n,r,i;;){if(e.lookahead<uf){if(Df(e),e.lookahead<uf&&t===Ph)return mf;if(0===e.lookahead)break}if(n=0,e.lookahead>=sf&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+sf-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=sf-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-uf&&(e.match_length=Of(e,n),e.match_length<=5&&(e.strategy===zh||e.match_length===sf&&e.strstart-e.match_start>4096)&&(e.match_length=sf-1)),e.prev_length>=sf&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-sf,r=bh._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-sf),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+sf-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=sf-1,e.strstart++,r&&(Tf(e,!1),0===e.strm.avail_out))return mf}else if(e.match_available){if((r=bh._tr_tally(e,0,e.window[e.strstart-1]))&&Tf(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return mf}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=bh._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<sf-1?e.strstart:sf-1,t===Uh?(Tf(e,!0),0===e.strm.avail_out?Ef:kf):e.last_lit&&(Tf(e,!1),0===e.strm.avail_out)?mf:gf}function Pf(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}function xf(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Xh,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new bd.Buf16(2*af),this.dyn_dtree=new bd.Buf16(2*(2*nf+1)),this.bl_tree=new bd.Buf16(2*(2*rf+1)),wf(this.dyn_ltree),wf(this.dyn_dtree),wf(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new bd.Buf16(of+1),this.heap=new bd.Buf16(2*tf+1),wf(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new bd.Buf16(2*tf+1),wf(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Mf(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=Qh,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?df:pf,e.adler=2===t.wrap?0:1,t.last_flush=Ph,bh._tr_init(t),Fh):Cf(e,Bh)}function Uf(e){var t,n=Mf(e);return n===Fh&&((t=e.state).window_size=2*t.w_size,wf(t.head),t.max_lazy_match=Dh[t.level].max_lazy,t.good_match=Dh[t.level].good_length,t.nice_match=Dh[t.level].nice_length,t.max_chain_length=Dh[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=sf-1,t.match_available=0,t.ins_h=0),n}function Vf(e,t,n,r,i,a){if(!e)return Bh;var o=1;if(t===Hh&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>$h||n!==Xh||r<8||r>15||t<0||t>9||a<0||a>Yh)return Cf(e,Bh);8===r&&(r=9);var s=new xf;return e.state=s,s.strm=e,s.wrap=o,s.gzhead=null,s.w_bits=r,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+sf-1)/sf),s.window=new bd.Buf8(2*s.w_size),s.head=new bd.Buf16(s.hash_size),s.prev=new bd.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new bd.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=a,s.method=n,Uf(e)}Dh=[new Pf(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Df(e),0===e.lookahead&&t===Ph)return mf;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+n;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,Tf(e,!1),0===e.strm.avail_out))return mf;if(e.strstart-e.block_start>=e.w_size-uf&&(Tf(e,!1),0===e.strm.avail_out))return mf}return e.insert=0,t===Uh?(Tf(e,!0),0===e.strm.avail_out?Ef:kf):(e.strstart>e.block_start&&(Tf(e,!1),e.strm.avail_out),mf)})),new Pf(4,4,8,4,Nf),new Pf(4,5,16,8,Nf),new Pf(4,6,32,32,Nf),new Pf(4,4,16,16,Lf),new Pf(8,16,32,32,Lf),new Pf(8,16,128,128,Lf),new Pf(8,32,128,256,Lf),new Pf(32,128,258,1024,Lf),new Pf(32,258,258,4096,Lf)];var Ff=function(e,t){return e&&e.state?2!==e.state.wrap?Bh:(e.state.gzhead=t,Fh):Bh},Gf=function(e,t){var n,r,i,a;if(!e||!e.state||t>Vh||t<0)return e?Cf(e,Bh):Bh;if(r=e.state,!e.output||!e.input&&0!==e.avail_in||r.status===yf&&t!==Uh)return Cf(e,0===e.avail_out?qh:Bh);if(r.strm=e,n=r.last_flush,r.last_flush=t,r.status===df)if(2===r.wrap)e.adler=0,bf(r,31),bf(r,139),bf(r,8),r.gzhead?(bf(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),bf(r,255&r.gzhead.time),bf(r,r.gzhead.time>>8&255),bf(r,r.gzhead.time>>16&255),bf(r,r.gzhead.time>>24&255),bf(r,9===r.level?2:r.strategy>=Wh||r.level<2?4:0),bf(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(bf(r,255&r.gzhead.extra.length),bf(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(e.adler=Nh(e.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=hf):(bf(r,0),bf(r,0),bf(r,0),bf(r,0),bf(r,0),bf(r,9===r.level?2:r.strategy>=Wh||r.level<2?4:0),bf(r,Rf),r.status=pf);else{var o=Xh+(r.w_bits-8<<4)<<8;o|=(r.strategy>=Wh||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(o|=lf),o+=31-o%31,r.status=pf,Sf(r,o),0!==r.strstart&&(Sf(r,e.adler>>>16),Sf(r,65535&e.adler)),e.adler=1}if(r.status===hf)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),Af(e),i=r.pending,r.pending!==r.pending_buf_size));)bf(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=ff)}else r.status=ff;if(r.status===ff)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),Af(e),i=r.pending,r.pending===r.pending_buf_size)){a=1;break}a=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,bf(r,a)}while(0!==a);r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),0===a&&(r.gzindex=0,r.status=_f)}else r.status=_f;if(r.status===_f)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),Af(e),i=r.pending,r.pending===r.pending_buf_size)){a=1;break}a=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,bf(r,a)}while(0!==a);r.gzhead.hcrc&&r.pending>i&&(e.adler=Nh(e.adler,r.pending_buf,r.pending-i,i)),0===a&&(r.status=vf)}else r.status=vf;if(r.status===vf&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&Af(e),r.pending+2<=r.pending_buf_size&&(bf(r,255&e.adler),bf(r,e.adler>>8&255),e.adler=0,r.status=pf)):r.status=pf),0!==r.pending){if(Af(e),0===e.avail_out)return r.last_flush=-1,Fh}else if(0===e.avail_in&&If(t)<=If(n)&&t!==Uh)return Cf(e,qh);if(r.status===yf&&0!==e.avail_in)return Cf(e,qh);if(0!==e.avail_in||0!==r.lookahead||t!==Ph&&r.status!==yf){var s=r.strategy===Wh?function(e,t){for(var n;;){if(0===e.lookahead&&(Df(e),0===e.lookahead)){if(t===Ph)return mf;break}if(e.match_length=0,n=bh._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Tf(e,!1),0===e.strm.avail_out))return mf}return e.insert=0,t===Uh?(Tf(e,!0),0===e.strm.avail_out?Ef:kf):e.last_lit&&(Tf(e,!1),0===e.strm.avail_out)?mf:gf}(r,t):r.strategy===Kh?function(e,t){for(var n,r,i,a,o=e.window;;){if(e.lookahead<=cf){if(Df(e),e.lookahead<=cf&&t===Ph)return mf;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=sf&&e.strstart>0&&(r=o[i=e.strstart-1])===o[++i]&&r===o[++i]&&r===o[++i]){a=e.strstart+cf;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<a);e.match_length=cf-(a-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=sf?(n=bh._tr_tally(e,1,e.match_length-sf),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=bh._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Tf(e,!1),0===e.strm.avail_out))return mf}return e.insert=0,t===Uh?(Tf(e,!0),0===e.strm.avail_out?Ef:kf):e.last_lit&&(Tf(e,!1),0===e.strm.avail_out)?mf:gf}(r,t):Dh[r.level].func(r,t);if(s!==Ef&&s!==kf||(r.status=yf),s===mf||s===Ef)return 0===e.avail_out&&(r.last_flush=-1),Fh;if(s===gf&&(t===xh?bh._tr_align(r):t!==Vh&&(bh._tr_stored_block(r,0,0,!1),t===Mh&&(wf(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),Af(e),0===e.avail_out))return r.last_flush=-1,Fh}return t!==Uh?Fh:r.wrap<=0?Gh:(2===r.wrap?(bf(r,255&e.adler),bf(r,e.adler>>8&255),bf(r,e.adler>>16&255),bf(r,e.adler>>24&255),bf(r,255&e.total_in),bf(r,e.total_in>>8&255),bf(r,e.total_in>>16&255),bf(r,e.total_in>>24&255)):(Sf(r,e.adler>>>16),Sf(r,65535&e.adler)),Af(e),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?Fh:Gh)},Bf={deflateInit:function(e,t){return Vf(e,t,Xh,Jh,ef,Zh)},deflateInit2:Vf,deflateReset:Uf,deflateResetKeep:Mf,deflateSetHeader:Ff,deflate:Gf,deflateEnd:function(e){var t;return e&&e.state?(t=e.state.status)!==df&&t!==hf&&t!==ff&&t!==_f&&t!==vf&&t!==pf&&t!==yf?Cf(e,Bh):(e.state=null,t===pf?Cf(e,jh):Fh):Bh},deflateSetDictionary:function(e,t){var n,r,i,a,o,s,c,u,l=t.length;if(!e||!e.state)return Bh;if(2===(a=(n=e.state).wrap)||1===a&&n.status!==df||n.lookahead)return Bh;for(1===a&&(e.adler=Sh(e.adler,t,l,0)),n.wrap=0,l>=n.w_size&&(0===a&&(wf(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new bd.Buf8(n.w_size),bd.arraySet(u,t,l-n.w_size,n.w_size,0),t=u,l=n.w_size),o=e.avail_in,s=e.next_in,c=e.input,e.avail_in=l,e.next_in=0,e.input=t,Df(n);n.lookahead>=sf;){r=n.strstart,i=n.lookahead-(sf-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+sf-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--i);n.strstart=r,n.lookahead=sf-1,Df(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=sf-1,n.match_available=0,e.next_in=s,e.input=c,e.avail_in=o,n.wrap=a,Fh},deflateInfo:"pako deflate (from Nodeca project)"},jf=!0,qf=!0;try{String.fromCharCode.apply(null,[0])}catch(e){jf=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){qf=!1}for(var Hf=new bd.Buf8(256),zf=0;zf<256;zf++)Hf[zf]=zf>=252?6:zf>=248?5:zf>=240?4:zf>=224?3:zf>=192?2:1;Hf[254]=Hf[254]=1;function Wf(e,t){if(t<65534&&(e.subarray&&qf||!e.subarray&&jf))return String.fromCharCode.apply(null,bd.shrinkBuf(e,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}var Kf={string2buf:function(e){var t,n,r,i,a,o=e.length,s=0;for(i=0;i<o;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),s+=n<128?1:n<2048?2:n<65536?3:4;for(t=new bd.Buf8(s),a=0,i=0;a<s;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<o&&56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},buf2binstring:function(e){return Wf(e,e.length)},binstring2buf:function(e){for(var t=new bd.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},buf2string:function(e,t){var n,r,i,a,o=t||e.length,s=new Array(2*o);for(r=0,n=0;n<o;)if((i=e[n++])<128)s[r++]=i;else if((a=Hf[i])>4)s[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<o;)i=i<<6|63&e[n++],a--;a>1?s[r++]=65533:i<65536?s[r++]=i:(i-=65536,s[r++]=55296|i>>10&1023,s[r++]=56320|1023&i)}return Wf(s,r)},utf8border:function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Hf[e[n]]>t?n:t}};var Yf=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},Zf=Object.prototype.toString,Qf=0,Xf=-1,$f=0,Jf=8;function e_(e){if(!(this instanceof e_))return new e_(e);this.options=bd.assign({level:Xf,method:Jf,chunkSize:16384,windowBits:15,memLevel:8,strategy:$f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yf,this.strm.avail_out=0;var n=Bf.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==Qf)throw new Error(Lh[n]);if(t.header&&Bf.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?Kf.string2buf(t.dictionary):"[object ArrayBuffer]"===Zf.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Bf.deflateSetDictionary(this.strm,r))!==Qf)throw new Error(Lh[n]);this._dict_set=!0}}function t_(e,t){var n=new e_(t);if(n.push(e,!0),n.err)throw n.msg||Lh[n.err];return n.result}e_.prototype.push=function(e,t){var n,r,i=this.strm,a=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=Kf.string2buf(e):"[object ArrayBuffer]"===Zf.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new bd.Buf8(a),i.next_out=0,i.avail_out=a),1!==(n=Bf.deflate(i,r))&&n!==Qf)return this.onEnd(n),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(Kf.buf2binstring(bd.shrinkBuf(i.output,i.next_out))):this.onData(bd.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==n);return 4===r?(n=Bf.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Qf):2!==r||(this.onEnd(Qf),i.avail_out=0,!0)},e_.prototype.onData=function(e){this.chunks.push(e)},e_.prototype.onEnd=function(e){e===Qf&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=bd.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var n_={Deflate:e_,deflate:t_,deflateRaw:function(e,t){return(t=t||{}).raw=!0,t_(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,t_(e,t)}},r_=function(e,t){var n,r,i,a,o,s,c,u,l,d,h,f,_,v,p,y,m,g,E,k,R,C,I,w,A;n=e.state,r=e.next_in,w=e.input,i=r+(e.avail_in-5),a=e.next_out,A=e.output,o=a-(t-e.avail_out),s=a+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,h=n.window,f=n.hold,_=n.bits,v=n.lencode,p=n.distcode,y=(1<<n.lenbits)-1,m=(1<<n.distbits)-1;e:do{_<15&&(f+=w[r++]<<_,_+=8,f+=w[r++]<<_,_+=8),g=v[f&y];t:for(;;){if(f>>>=E=g>>>24,_-=E,0===(E=g>>>16&255))A[a++]=65535&g;else{if(!(16&E)){if(0==(64&E)){g=v[(65535&g)+(f&(1<<E)-1)];continue t}if(32&E){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}k=65535&g,(E&=15)&&(_<E&&(f+=w[r++]<<_,_+=8),k+=f&(1<<E)-1,f>>>=E,_-=E),_<15&&(f+=w[r++]<<_,_+=8,f+=w[r++]<<_,_+=8),g=p[f&m];n:for(;;){if(f>>>=E=g>>>24,_-=E,!(16&(E=g>>>16&255))){if(0==(64&E)){g=p[(65535&g)+(f&(1<<E)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(R=65535&g,_<(E&=15)&&(f+=w[r++]<<_,(_+=8)<E&&(f+=w[r++]<<_,_+=8)),(R+=f&(1<<E)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(f>>>=E,_-=E,R>(E=a-o)){if((E=R-E)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(C=0,I=h,0===d){if(C+=u-E,E<k){k-=E;do{A[a++]=h[C++]}while(--E);C=a-R,I=A}}else if(d<E){if(C+=u+d-E,(E-=d)<k){k-=E;do{A[a++]=h[C++]}while(--E);if(C=0,d<k){k-=E=d;do{A[a++]=h[C++]}while(--E);C=a-R,I=A}}}else if(C+=d-E,E<k){k-=E;do{A[a++]=h[C++]}while(--E);C=a-R,I=A}for(;k>2;)A[a++]=I[C++],A[a++]=I[C++],A[a++]=I[C++],k-=3;k&&(A[a++]=I[C++],k>1&&(A[a++]=I[C++]))}else{C=a-R;do{A[a++]=A[C++],A[a++]=A[C++],A[a++]=A[C++],k-=3}while(k>2);k&&(A[a++]=A[C++],k>1&&(A[a++]=A[C++]))}break}}break}}while(r<i&&a<s);r-=k=_>>3,f&=(1<<(_-=k<<3))-1,e.next_in=r,e.next_out=a,e.avail_in=r<i?i-r+5:5-(r-i),e.avail_out=a<s?s-a+257:257-(a-s),n.hold=f,n.bits=_},i_=15,a_=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o_=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],s_=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c_=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],u_=function(e,t,n,r,i,a,o,s){var c,u,l,d,h,f,_,v,p,y=s.bits,m=0,g=0,E=0,k=0,R=0,C=0,I=0,w=0,A=0,T=0,b=null,S=0,O=new bd.Buf16(16),D=new bd.Buf16(16),N=null,L=0;for(m=0;m<=i_;m++)O[m]=0;for(g=0;g<r;g++)O[t[n+g]]++;for(R=y,k=i_;k>=1&&0===O[k];k--);if(R>k&&(R=k),0===k)return i[a++]=20971520,i[a++]=20971520,s.bits=1,0;for(E=1;E<k&&0===O[E];E++);for(R<E&&(R=E),w=1,m=1;m<=i_;m++)if(w<<=1,(w-=O[m])<0)return-1;if(w>0&&(0===e||1!==k))return-1;for(D[1]=0,m=1;m<i_;m++)D[m+1]=D[m]+O[m];for(g=0;g<r;g++)0!==t[n+g]&&(o[D[t[n+g]]++]=g);if(0===e?(b=N=o,f=19):1===e?(b=a_,S-=257,N=o_,L-=257,f=256):(b=s_,N=c_,f=-1),T=0,g=0,m=E,h=a,C=R,I=0,l=-1,d=(A=1<<R)-1,1===e&&A>852||2===e&&A>592)return 1;for(;;){_=m-I,o[g]<f?(v=0,p=o[g]):o[g]>f?(v=N[L+o[g]],p=b[S+o[g]]):(v=96,p=0),c=1<<m-I,E=u=1<<C;do{i[h+(T>>I)+(u-=c)]=_<<24|v<<16|p|0}while(0!==u);for(c=1<<m-1;T&c;)c>>=1;if(0!==c?(T&=c-1,T+=c):T=0,g++,0==--O[m]){if(m===k)break;m=t[n+o[g]]}if(m>R&&(T&d)!==l){for(0===I&&(I=R),h+=E,w=1<<(C=m-I);C+I<k&&!((w-=O[C+I])<=0);)C++,w<<=1;if(A+=1<<C,1===e&&A>852||2===e&&A>592)return 1;i[l=T&d]=R<<24|C<<16|h-a|0}}return 0!==T&&(i[h+T]=m-I<<24|64<<16|0),s.bits=R,0},l_=0,d_=1,h_=2,f_=4,__=5,v_=6,p_=0,y_=1,m_=2,g_=-2,E_=-3,k_=-4,R_=-5,C_=8,I_=1,w_=2,A_=3,T_=4,b_=5,S_=6,O_=7,D_=8,N_=9,L_=10,P_=11,x_=12,M_=13,U_=14,V_=15,F_=16,G_=17,B_=18,j_=19,q_=20,H_=21,z_=22,W_=23,K_=24,Y_=25,Z_=26,Q_=27,X_=28,$_=29,J_=30,ev=31,tv=852,nv=592,rv=15;function iv(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function av(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new bd.Buf16(320),this.work=new bd.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function ov(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=I_,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new bd.Buf32(tv),t.distcode=t.distdyn=new bd.Buf32(nv),t.sane=1,t.back=-1,p_):g_}function sv(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,ov(e)):g_}function cv(e,t){var n,r;return e&&e.state?(r=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?g_:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,sv(e))):g_}function uv(e,t){var n,r;return e?(r=new av,e.state=r,r.window=null,(n=cv(e,t))!==p_&&(e.state=null),n):g_}var lv,dv,hv=!0;function fv(e){if(hv){var t;for(lv=new bd.Buf32(512),dv=new bd.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(u_(d_,e.lens,0,288,lv,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;u_(h_,e.lens,0,32,dv,0,e.work,{bits:5}),hv=!1}e.lencode=lv,e.lenbits=9,e.distcode=dv,e.distbits=5}function _v(e,t,n,r){var i,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new bd.Buf8(a.wsize)),r>=a.wsize?(bd.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((i=a.wsize-a.wnext)>r&&(i=r),bd.arraySet(a.window,t,n-r,i,a.wnext),(r-=i)?(bd.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=i,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=i))),0}var vv=function(e,t){var n,r,i,a,o,s,c,u,l,d,h,f,_,v,p,y,m,g,E,k,R,C,I,w,A=0,T=new bd.Buf8(4),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return g_;(n=e.state).mode===x_&&(n.mode=M_),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,d=s,h=c,C=p_;e:for(;;)switch(n.mode){case I_:if(0===n.wrap){n.mode=M_;break}for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,T[0]=255&u,T[1]=u>>>8&255,n.check=Nh(n.check,T,2,0),u=0,l=0,n.mode=w_;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=J_;break}if((15&u)!==C_){e.msg="unknown compression method",n.mode=J_;break}if(l-=4,R=8+(15&(u>>>=4)),0===n.wbits)n.wbits=R;else if(R>n.wbits){e.msg="invalid window size",n.mode=J_;break}n.dmax=1<<R,e.adler=n.check=1,n.mode=512&u?L_:x_,u=0,l=0;break;case w_:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.flags=u,(255&n.flags)!==C_){e.msg="unknown compression method",n.mode=J_;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=J_;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(T[0]=255&u,T[1]=u>>>8&255,n.check=Nh(n.check,T,2,0)),u=0,l=0,n.mode=A_;case A_:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(T[0]=255&u,T[1]=u>>>8&255,T[2]=u>>>16&255,T[3]=u>>>24&255,n.check=Nh(n.check,T,4,0)),u=0,l=0,n.mode=T_;case T_:for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(T[0]=255&u,T[1]=u>>>8&255,n.check=Nh(n.check,T,2,0)),u=0,l=0,n.mode=b_;case b_:if(1024&n.flags){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(T[0]=255&u,T[1]=u>>>8&255,n.check=Nh(n.check,T,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=S_;case S_:if(1024&n.flags&&((f=n.length)>s&&(f=s),f&&(n.head&&(R=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),bd.arraySet(n.head.extra,r,a,f,R)),512&n.flags&&(n.check=Nh(n.check,r,f,a)),s-=f,a+=f,n.length-=f),n.length))break e;n.length=0,n.mode=O_;case O_:if(2048&n.flags){if(0===s)break e;f=0;do{R=r[a+f++],n.head&&R&&n.length<65536&&(n.head.name+=String.fromCharCode(R))}while(R&&f<s);if(512&n.flags&&(n.check=Nh(n.check,r,f,a)),s-=f,a+=f,R)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=D_;case D_:if(4096&n.flags){if(0===s)break e;f=0;do{R=r[a+f++],n.head&&R&&n.length<65536&&(n.head.comment+=String.fromCharCode(R))}while(R&&f<s);if(512&n.flags&&(n.check=Nh(n.check,r,f,a)),s-=f,a+=f,R)break e}else n.head&&(n.head.comment=null);n.mode=N_;case N_:if(512&n.flags){for(;l<16;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=J_;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=x_;break;case L_:for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}e.adler=n.check=iv(u),u=0,l=0,n.mode=P_;case P_:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,m_;e.adler=n.check=1,n.mode=x_;case x_:if(t===__||t===v_)break e;case M_:if(n.last){u>>>=7&l,l-=7&l,n.mode=Q_;break}for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=U_;break;case 1:if(fv(n),n.mode=q_,t===v_){u>>>=2,l-=2;break e}break;case 2:n.mode=G_;break;case 3:e.msg="invalid block type",n.mode=J_}u>>>=2,l-=2;break;case U_:for(u>>>=7&l,l-=7&l;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=J_;break}if(n.length=65535&u,u=0,l=0,n.mode=V_,t===v_)break e;case V_:n.mode=F_;case F_:if(f=n.length){if(f>s&&(f=s),f>c&&(f=c),0===f)break e;bd.arraySet(i,r,a,f,o),s-=f,a+=f,c-=f,o+=f,n.length-=f;break}n.mode=x_;break;case G_:for(;l<14;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=J_;break}n.have=0,n.mode=B_;case B_:for(;n.have<n.ncode;){for(;l<3;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.lens[b[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[b[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},C=u_(l_,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,C){e.msg="invalid code lengths set",n.mode=J_;break}n.have=0,n.mode=j_;case j_:for(;n.have<n.nlen+n.ndist;){for(;y=(A=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&A,!((p=A>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(m<16)u>>>=p,l-=p,n.lens[n.have++]=m;else{if(16===m){for(w=p+2;l<w;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(u>>>=p,l-=p,0===n.have){e.msg="invalid bit length repeat",n.mode=J_;break}R=n.lens[n.have-1],f=3+(3&u),u>>>=2,l-=2}else if(17===m){for(w=p+3;l<w;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}l-=p,R=0,f=3+(7&(u>>>=p)),u>>>=3,l-=3}else{for(w=p+7;l<w;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}l-=p,R=0,f=11+(127&(u>>>=p)),u>>>=7,l-=7}if(n.have+f>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=J_;break}for(;f--;)n.lens[n.have++]=R}}if(n.mode===J_)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=J_;break}if(n.lenbits=9,I={bits:n.lenbits},C=u_(d_,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,C){e.msg="invalid literal/lengths set",n.mode=J_;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},C=u_(h_,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,C){e.msg="invalid distances set",n.mode=J_;break}if(n.mode=q_,t===v_)break e;case q_:n.mode=H_;case H_:if(s>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,r_(e,h),o=e.next_out,i=e.output,c=e.avail_out,a=e.next_in,r=e.input,s=e.avail_in,u=n.hold,l=n.bits,n.mode===x_&&(n.back=-1);break}for(n.back=0;y=(A=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,m=65535&A,!((p=A>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(y&&0==(240&y)){for(g=p,E=y,k=m;y=(A=n.lencode[k+((u&(1<<g+E)-1)>>g)])>>>16&255,m=65535&A,!(g+(p=A>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=g,l-=g,n.back+=g}if(u>>>=p,l-=p,n.back+=p,n.length=m,0===y){n.mode=Z_;break}if(32&y){n.back=-1,n.mode=x_;break}if(64&y){e.msg="invalid literal/length code",n.mode=J_;break}n.extra=15&y,n.mode=z_;case z_:if(n.extra){for(w=n.extra;l<w;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=W_;case W_:for(;y=(A=n.distcode[u&(1<<n.distbits)-1])>>>16&255,m=65535&A,!((p=A>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(0==(240&y)){for(g=p,E=y,k=m;y=(A=n.distcode[k+((u&(1<<g+E)-1)>>g)])>>>16&255,m=65535&A,!(g+(p=A>>>24)<=l);){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}u>>>=g,l-=g,n.back+=g}if(u>>>=p,l-=p,n.back+=p,64&y){e.msg="invalid distance code",n.mode=J_;break}n.offset=m,n.extra=15&y,n.mode=K_;case K_:if(n.extra){for(w=n.extra;l<w;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=J_;break}n.mode=Y_;case Y_:if(0===c)break e;if(f=h-c,n.offset>f){if((f=n.offset-f)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=J_;break}f>n.wnext?(f-=n.wnext,_=n.wsize-f):_=n.wnext-f,f>n.length&&(f=n.length),v=n.window}else v=i,_=o-n.offset,f=n.length;f>c&&(f=c),c-=f,n.length-=f;do{i[o++]=v[_++]}while(--f);0===n.length&&(n.mode=H_);break;case Z_:if(0===c)break e;i[o++]=n.length,c--,n.mode=H_;break;case Q_:if(n.wrap){for(;l<32;){if(0===s)break e;s--,u|=r[a++]<<l,l+=8}if(h-=c,e.total_out+=h,n.total+=h,h&&(e.adler=n.check=n.flags?Nh(n.check,i,h,o-h):Sh(n.check,i,h,o-h)),h=c,(n.flags?u:iv(u))!==n.check){e.msg="incorrect data check",n.mode=J_;break}u=0,l=0}n.mode=X_;case X_:if(n.wrap&&n.flags){for(;l<32;){if(0===s)break e;s--,u+=r[a++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=J_;break}u=0,l=0}n.mode=$_;case $_:C=y_;break e;case J_:C=E_;break e;case ev:return k_;default:return g_}return e.next_out=o,e.avail_out=c,e.next_in=a,e.avail_in=s,n.hold=u,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<J_&&(n.mode<Q_||t!==f_))&&_v(e,e.output,e.next_out,h-e.avail_out),d-=e.avail_in,h-=e.avail_out,e.total_in+=d,e.total_out+=h,n.total+=h,n.wrap&&h&&(e.adler=n.check=n.flags?Nh(n.check,i,h,e.next_out-h):Sh(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===x_?128:0)+(n.mode===q_||n.mode===V_?256:0),(0===d&&0===h||t===f_)&&C===p_&&(C=R_),C},pv=function(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?g_:(n.head=t,t.done=!1,p_):g_},yv={inflateReset:sv,inflateReset2:cv,inflateResetKeep:ov,inflateInit:function(e){return uv(e,rv)},inflateInit2:uv,inflate:vv,inflateEnd:function(e){if(!e||!e.state)return g_;var t=e.state;return t.window&&(t.window=null),e.state=null,p_},inflateGetHeader:pv,inflateSetDictionary:function(e,t){var n,r=t.length;return e&&e.state?0!==(n=e.state).wrap&&n.mode!==P_?g_:n.mode===P_&&Sh(1,t,r,0)!==n.check?E_:_v(e,t,r,r)?(n.mode=ev,k_):(n.havedict=1,p_):g_},inflateInfo:"pako inflate (from Nodeca project)"},mv={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var gv=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},Ev=Object.prototype.toString;function kv(e){if(!(this instanceof kv))return new kv(e);this.options=bd.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Yf,this.strm.avail_out=0;var n=yv.inflateInit2(this.strm,t.windowBits);if(n!==mv.Z_OK)throw new Error(Lh[n]);if(this.header=new gv,yv.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Kf.string2buf(t.dictionary):"[object ArrayBuffer]"===Ev.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=yv.inflateSetDictionary(this.strm,t.dictionary))!==mv.Z_OK))throw new Error(Lh[n])}function Rv(e,t){var n=new kv(t);if(n.push(e,!0),n.err)throw n.msg||Lh[n.err];return n.result}kv.prototype.push=function(e,t){var n,r,i,a,o,s=this.strm,c=this.options.chunkSize,u=this.options.dictionary,l=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?mv.Z_FINISH:mv.Z_NO_FLUSH,"string"==typeof e?s.input=Kf.binstring2buf(e):"[object ArrayBuffer]"===Ev.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new bd.Buf8(c),s.next_out=0,s.avail_out=c),(n=yv.inflate(s,mv.Z_NO_FLUSH))===mv.Z_NEED_DICT&&u&&(n=yv.inflateSetDictionary(this.strm,u)),n===mv.Z_BUF_ERROR&&!0===l&&(n=mv.Z_OK,l=!1),n!==mv.Z_STREAM_END&&n!==mv.Z_OK)return this.onEnd(n),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&n!==mv.Z_STREAM_END&&(0!==s.avail_in||r!==mv.Z_FINISH&&r!==mv.Z_SYNC_FLUSH)||("string"===this.options.to?(i=Kf.utf8border(s.output,s.next_out),a=s.next_out-i,o=Kf.buf2string(s.output,i),s.next_out=a,s.avail_out=c-a,a&&bd.arraySet(s.output,s.output,i,a,0),this.onData(o)):this.onData(bd.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(l=!0)}while((s.avail_in>0||0===s.avail_out)&&n!==mv.Z_STREAM_END);return n===mv.Z_STREAM_END&&(r=mv.Z_FINISH),r===mv.Z_FINISH?(n=yv.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===mv.Z_OK):r!==mv.Z_SYNC_FLUSH||(this.onEnd(mv.Z_OK),s.avail_out=0,!0)},kv.prototype.onData=function(e){this.chunks.push(e)},kv.prototype.onEnd=function(e){e===mv.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=bd.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Cv={Inflate:kv,inflate:Rv,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Rv(e,t)},ungzip:Rv},Iv={};(0,bd.assign)(Iv,n_,Cv,mv);var wv,Av=Iv.gzip,Tv=Iv.ungzip,bv=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"encode",value:function(e){return btoa(e)}},{key:"decode",value:function(e){return atob(e)}}]),e}(),Sv=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"compress",value:function(e){var t=Av(e,{to:"string"});return bv.encode(t)}},{key:"decompress",value:function(e){var t=bv.decode(e);return Tv(t,{to:"string"})}}]),e}(),Ov=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.ANSWER),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,peerConnectionId:e.peer_connection_id,sdp:Sv.decompress(e.sdp)}}}]),n}(vd),Dv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.AUDIO),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,isEnabled:e.is_enabled}}}]),n}(vd),Nv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.CANDIDATE),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,peerConnectionId:e.peer_connection_id,candidate:{sdpMLineIndex:e.candidate.sdp_mline_index,sdpMid:e.candidate.sdp_mid,sdp:e.candidate.sdp}}}}]),n}(vd),Lv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.CUSTOM_ITEMS_DELETE),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,deleted:e.deleted,customItems:e.custom_items}}}]),n}(vd),Pv=function e(t){Hn(this,e),this.userId=t.user_id,this.nickname=t.nickname,this.profileUrl=t.profile_url,this.metaData=t.meta_data,this.isActive=t.is_active,this.role=t.role},xv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.DIAL),e}return Wn(n,[{key:"parseData",value:function(e){return{isVideoCall:e.is_video_call,callId:e.call_id,caller:new Pv(e.caller),callee:new Pv(e.callee),turnCredential:{username:e.turn_credential.username,password:e.turn_credential.password,turnUrls:e.turn_credential.turn_urls,transportPolicy:e.turn_credential.transport_policy},constraints:{audio:e.constraints.audio,video:e.constraints.video},customItems:e.custom_items,shortLivedToken:e.sbcall_short_lived_token,capabilities:e.capabilities||[]}}}]),n}(vd),Mv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.DIAL_RCV),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,calleeDeliveryInfo:e.callee_delivery_info,receivedType:e.received_type}}}]),n}(vd),Uv=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Hn(this,e),this.callId=t.call_id,this.isVideoCall=t.is_video_call,this._customItems=t.custom_items,this.userRole=t.user_role,this.startedAt=t.started_at,this.endedAt=t.ended_at,this._participants=t.participants.map((function(e){return new Pv(e)})),this.endedBy=this._participants.find((function(e){return e.userId===t.ended_by})),this.duration=t.duration,this.endResult=t.end_result,this.callType=t.call_type,this._isFromServer=n}return Wn(e,[{key:"caller",get:function(){return this._participants.find((function(e){return e.role===no.CALLER}))}},{key:"callee",get:function(){return this._participants.find((function(e){return e.role===no.CALLEE}))}},{key:"customItems",get:function(){return Zn({},this._customItems)}},{key:"isFromServer",get:function(){return this._isFromServer}}]),e}(),Vv=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,endedCall:new Uv(e.ended_call)}}}]),n}(vd),Fv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.HOLD),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,holdedBy:e.holded_by,isPeerOnHold:e.is_peer_on_hold,isRelayed:e.is_relayed}}}]),n}(vd),Gv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.OFFER),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,peerConnectionId:e.peer_connection_id,sdp:Sv.decompress(e.sdp)}}}]),n}(vd),Bv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.RECORDING),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,recordingId:e.recording_id,recordingType:e.recording_type,recordingStatus:e.recording_status}}}]),n}(vd),jv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.REMOVE_CANDIDATES),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,candidates:e.candidates.map((function(e){return{sdpMLineIndex:e.sdp_mline_index,sdpMid:e.sdp_mid,candidate:e.sdp}}))}}}]),n}(vd),qv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.CUSTOM_ITEMS_UPDATE),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,updated:e.updated,customItems:e.custom_items}}}]),n}(vd),Hv=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.VIDEO),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,isEnabled:e.is_enabled}}}]),n}(vd),zv=["turn_changed"],Wv=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).callId=e,i.constraints=r,i.capabilities=zv,i}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.ACCEPT}},{key:"getData",value:function(){return{call_id:this.callId,constraints:{audio:this.constraints.audio,video:this.constraints.video},capabilities:this.capabilities}}}]),n}(hd),Kv=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"getCMD",value:function(){return Ql.SGNL}},{key:"getType",value:function(){return dd.ALIVE}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),Yv=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).callId=e,a.peerConnectionId=r,a.sdp=i,a}return Wn(n,[{key:"getCMD",value:function(){return Ql.SGNL}},{key:"getType",value:function(){return dd.ANSWER}},{key:"getData",value:function(){var e={call_id:this.callId,sdp:Sv.compress(this.sdp)};return this.peerConnectionId?Zn(Zn({},e),{},{peer_connection_id:this.peerConnectionId}):e}}]),n}(hd),Zv=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).callId=e,i.isEnabled=r,i}return Wn(n,[{key:"getCMD",value:function(){return Ql.COMM}},{key:"getType",value:function(){return dd.AUDIO}},{key:"getData",value:function(){return{call_id:this.callId,is_enabled:this.isEnabled}}}]),n}(hd),Qv=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.CANCEL}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),Xv=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a,o){var s;return Hn(this,n),Kn(rr(s=t.call(this)),"type",dd.CANDIDATE),s.callId=e,s.peerConnectionId=r,s.sdp=i,s.sdpMLineIndex=a,s.sdpMid=o,s}return Wn(n,[{key:"getCMD",value:function(){return Ql.SGNL}},{key:"getType",value:function(){return dd.CANDIDATE}},{key:"getData",value:function(){var e={call_id:this.callId,candidate:{sdp:this.sdp,sdp_mline_index:this.sdpMLineIndex,sdp_mid:this.sdpMid}};return this.peerConnectionId?Zn(Zn({},e),{},{peer_connection_id:this.peerConnectionId}):e}}]),n}(hd),$v=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).callId=e,a.reconnect=i,a.connectionType=r.connectionType,a.relayProtocol=r.relayProtocol,a.protocol=r.protocol,a}return Wn(n,[{key:"getCMD",value:function(){return Ql.SGNL}},{key:"getType",value:function(){return dd.CONNECTED}},{key:"getData",value:function(){return{call_id:this.callId,connection:{connection_type:this.connectionType,relay_protocol:this.relayProtocol,protocol:this.protocol},reconnect:this.reconnect}}}]),n}(hd),Jv=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.CONNECTION_LOST}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),ep=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.DECLINE}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),tp=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a,o){var s;return Hn(this,n),(s=t.call(this)).calleeId=e,s.isVideoCall=r,s.customItems=i,s.sendBirdChatOptions=a,s.constraints=o,s.capabilities=zv,s}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.DIAL}},{key:"getData",value:function(){var e;return{callee_id:this.calleeId,is_video_call:this.isVideoCall,custom_items:this.customItems,sb_chat:{channel_url:null===(e=this.sendBirdChatOptions)||void 0===e?void 0:e.channelUrl},constraints:{audio:this.constraints.audio,video:this.constraints.video},capabilities:this.capabilities}}}]),n}(hd),np=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),(o=t.call(this)).callId=e,o.calleeDeliveryInfo=r,o.receivedType=i,o.shortLivedToken=a,o}return Wn(n,[{key:"getHeaders",value:function(){return{"SBCall-Short-Lived-Token":this.shortLivedToken}}},{key:"getData",value:function(){return{call_id:this.callId,callee_delivery_info:this.calleeDeliveryInfo,received_type:this.receivedType}}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.DIAL_RCV}},{key:"sendStrategy",get:function(){return Xl.API}}]),n}(hd),rp=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.END}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),ip=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).callId=e,a.isOnHold=r,a.wasRelayed=i,a}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.HOLD}},{key:"getData",value:function(){return{call_id:this.callId,is_on_hold:this.isOnHold,was_relayed:this.wasRelayed}}}]),n}(hd),ap=function(e){Qn(n,e);var t=ir(n);function n(e){var r;return Hn(this,n),(r=t.call(this)).callId=e,r}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.NO_ANSWER}},{key:"getData",value:function(){return{call_id:this.callId}}}]),n}(hd),op=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this)).callId=e,a.peerConnectionId=r,a.sdp=i,a}return Wn(n,[{key:"getCMD",value:function(){return Ql.SGNL}},{key:"getType",value:function(){return dd.OFFER}},{key:"getData",value:function(){var e={call_id:this.callId,sdp:Sv.compress(this.sdp)};return this.peerConnectionId?Zn(Zn({},e),{},{peer_connection_id:this.peerConnectionId}):e}}]),n}(hd),sp=function(e){Qn(n,e);var t=ir(n);function n(e,r,i,a){var o;return Hn(this,n),(o=t.call(this)).callId=e,o.recordingId=r,o.recordingType=i,o.recordingStatus=a,o}return Wn(n,[{key:"getCMD",value:function(){return Ql.COMM}},{key:"getType",value:function(){return dd.RECORDING}},{key:"getData",value:function(){return{call_id:this.callId,recording_id:this.recordingId,recording_type:this.recordingType,recording_status:this.recordingStatus}}}]),n}(hd),cp=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).callId=e,i.reason=r,i}return Wn(n,[{key:"requireResponse",value:function(){return!0}},{key:"getCMD",value:function(){return Ql.CALL}},{key:"getType",value:function(){return dd.TIME_OUT}},{key:"getData",value:function(){return{call_id:this.callId,reason:this.reason}}}]),n}(hd),up=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this)).callId=e,i.isEnabled=r,i}return Wn(n,[{key:"getCMD",value:function(){return Ql.COMM}},{key:"getType",value:function(){return dd.VIDEO}},{key:"getData",value:function(){return{call_id:this.callId,is_enabled:this.isEnabled}}}]),n}(hd),lp=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.ACCEPT_ACK),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id}}}]),n}(pd),dp=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.ALIVE_ACK),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,alive_at:e.alive_at}}}]),n}(pd),hp=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.DIAL_ACK),e}return Wn(n,[{key:"parseData",value:function(e){return{isVideoCall:e.is_video_call,callId:e.call_id,caller:new Pv(e.caller),callee:new Pv(e.callee)}}}]),n}(pd),fp=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,endedCall:new Uv(e.ended_call)}}}]),n}(pd),_p=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.HOLD_ACK),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,holdedBy:e.holded_by,isRelayed:e.is_relayed}}}]),n}(pd),vp=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",dd.TURN_CHANGED),e}return Wn(n,[{key:"parseData",value:function(e){return{callId:e.call_id,turnCredential:{username:e.turn_credential.username,password:e.turn_credential.password,turnUrls:e.turn_credential.turn_urls,transportPolicy:e.turn_credential.transport_policy},eventId:e.event_id}}}]),n}(md),pp=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}(yd);!function(e){e.LOG="log"}(wv||(wv={}));var yp,mp=function(e){Qn(n,e);var t=ir(n);function n(){var e;Hn(this,n);for(var r=arguments.length,i=new Array(r),a=0;a<r;a++)i[a]=arguments[a];return Kn(rr(e=t.call.apply(t,[this].concat(i))),"type",wv.LOG),e}return Wn(n,[{key:"parseData",value:function(e){return{logLevel:e.log_level.toUpperCase()}}}]),n}(pp),gp=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}(fd);!function(e){e.CONNECTED="websocket_connected"}(yp||(yp={}));var Ep=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.call(this,{type:yp.CONNECTED})}return n}(gp),kp=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"createAuthRequest",value:function(e,t,n){return new ad(e,t,n)}},{key:"createDial",value:function(e,t,n,r,i){return new tp(e,t,n,r,i)}},{key:"createDialReceive",value:function(e,t,n,r){return new np(e,t,n,r)}},{key:"createAccept",value:function(e,t){return new Wv(e,t)}},{key:"createDecline",value:function(e){return new ep(e)}},{key:"createCancel",value:function(e){return new Qv(e)}},{key:"createEnd",value:function(e){return new rp(e)}},{key:"createTimeout",value:function(e,t){return new cp(e,t)}},{key:"createConnectionLost",value:function(e){return new Jv(e)}},{key:"createNoAnswer",value:function(e){return new ap(e)}},{key:"createOffer",value:function(e,t,n){return new op(e,t,n)}},{key:"createAnswer",value:function(e,t,n){return new Yv(e,t,n)}},{key:"createCandidate",value:function(e,t,n,r,i){return new Xv(e,t,n,r,i)}},{key:"createAudio",value:function(e,t){return new Zv(e,t)}},{key:"createVideo",value:function(e,t){return new up(e,t)}},{key:"createAlive",value:function(e){return new Kv(e)}},{key:"createConnected",value:function(e,t,n){return new $v(e,t,n)}},{key:"createStatsLogCommand",value:function(e){return new rd(e)}},{key:"createCallSummaryCommand",value:function(e,t,n){return new Cd(e,t,n)}},{key:"createUpdateCustomItems",value:function(e,t){return new Rd(e,t)}},{key:"createDeleteCustomItems",value:function(e,t){return new kd(e,t)}},{key:"createDeleteAllCustomItems",value:function(e){return new Ed(e)}},{key:"createRecording",value:function(e,t,n,r){return new sp(e,t,n,r)}},{key:"createHoldCommand",value:function(e,t,n){return new ip(e,t,n)}},{key:"createCommandList",value:function(e){return new gd(e)}},{key:"createUploadLogsCommand",value:function(e,t){return new id(e,t)}},{key:"createRegisterPushToken",value:function(e,t,n){return new sd(e,t,n)}},{key:"createUnregisterPushToken",value:function(e,t,n){return new cd(e,t,n)}},{key:"createUnregisterAllPushTokens",value:function(e,t){return new ud(e,t)}},{key:"createAccepted",value:function(e){return new Td({type:"other_device_accepted",payload:{call_id:e}})}},{key:"createDeclined",value:function(e,t){return new Id({callId:e,endedCall:t})}},{key:"createWebSocketConnectedCommand",value:function(){return new Ep}},{key:"createSnapshot",value:function(e,t){return new wd(Zn({callId:e},t))}},{key:"parse",value:function(e){try{switch(e.type){case dd.DIAL_ACK:return new hp(e);case dd.DIAL:return new xv(e);case dd.DIAL_RCV:return new Mv(e);case dd.NO_ANSWER_ACK:return new fp(e);case dd.NO_ANSWER:return new Vv(e);case dd.CANCEL_ACK:return new fp(e);case dd.CANCEL:return new Vv(e);case dd.ACCEPT_ACK:return new lp(e);case dd.ACCEPT:return new Ad(e);case dd.OTHER_DEVICE_ACCEPTED:return new Td(e);case dd.DECLINE_ACK:return new fp(e);case dd.DECLINE:return new Vv(e);case dd.OFFER:return new Gv(e);case dd.ANSWER:return new Ov(e);case dd.CANDIDATE:return new Nv(e);case dd.REMOVE_CANDIDATES:return new jv(e);case dd.AUDIO:return new Dv(e);case dd.VIDEO:return new Hv(e);case dd.HOLD:return new Fv(e);case dd.HOLD_ACK:return new _p(e);case dd.END_ACK:return new fp(e);case dd.END:return new Vv(e);case dd.TIMEOUT_ACK:return new fp(e);case dd.TIME_OUT:return new Vv(e);case dd.CONNECTION_LOST_ACK:return new fp(e);case dd.CONNECTION_LOST:return new Vv(e);case dd.UNKNOWN_END_ACK:return new fp(e);case dd.UNKNOWN_END:return new Vv(e);case dd.CUSTOM_ITEMS_UPDATE:return new qv(e);case dd.CUSTOM_ITEMS_DELETE:return new Lv(e);case dd.ALIVE_ACK:return new dp(e);case dd.RECORDING:return new Bv(e);case dd.TURN_CHANGED:return new vp(e);case wv.LOG:return new mp(e);default:throw new Error("unhandled command data. ".concat(JSON.stringify(e)))}}catch(e){return void fo.error(new Ja(Ln.ERR_WRONG_RESPONSE,{error:e}))}}}]),e}(),Rp=function(){function e(t){Hn(this,e),Kn(this,"_isOverflowLogs",!1),Kn(this,"_logs",[]),this._ctx=t}return Wn(e,[{key:"addLog",value:function(e){this._logs.length>=500&&(this._isOverflowLogs=!0,this._logs.shift()),this._logs.push(e)}},{key:"_flush",value:function(e){var t=this._logs.filter((function(t){return ti[t.logLevel].level>=ti[e].level})),n=kp.createUploadLogsCommand(t,this._isOverflowLogs);this._isOverflowLogs=!1,this._logs=[],this._ctx.sender.send(n)}},{key:"onEvent",value:function(e){if(e.type===wv.LOG)this._flush(e.payload.logLevel);else console.error("Cannot reach here")}}]),e}(),Cp=c.f,Ip=function(e){return function(t){for(var n,r=v(t),i=nt(r),o=i.length,s=0,c=[];o>s;)n=i[s++],a&&!Cp.call(r,n)||c.push(e?[n,r[n]]:r[n]);return c}},wp={entries:Ip(!0),values:Ip(!1)},Ap=wp.values;Oe({target:"Object",stat:!0},{values:function(e){return Ap(e)}});var Tp=wp.entries;function bp(e,t){var n=0,r=null;if("number"==typeof e){if(!t)throw new Error("'obj' parameter is required");n=e,r=t}else{if(!e||t)throw new Error("'obj' parameter is required");r=e}return function(e){var t=e.descriptor.value;return e.descriptor.value=function(){for(var e=arguments.length,i=new Array(e),a=0;a<e;a++)i[a]=arguments[a];var o=i[n];if("object"!==Bn(o))throw new Error("'object' is expected");return Object.entries(r).forEach((function(e){var t=or(e,2),n=t[0],r=t[1];!o[n]||o[n]instanceof r||(o[n]=new r(o[n]))})),t.call.apply(t,[this].concat(i))},e}}Oe({target:"Object",stat:!0},{entries:function(e){return Tp(e)}});var Sp=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.call(this)}return n}(zo),Op=function(){function e(t,n){Hn(this,e),Kn(this,"_count",0),this._ctx=t,this._call=n}return Wn(e,[{key:"_insertInfo",value:function(){var e=this._call;Object.assign(this._accumulated,{app_id:this._ctx.appId,browser_type:oo(),call_id:e.callId,device_timestamp:(new Date).getTime(),role:e.myRole,caller_id:e.caller.userId,callee_id:e.callee.userId,is_video_call:e.isVideoCall,metadata:{measure_count:e.options.statsIntervalValue/1e3,measure_interval:e.options.statsIntervalValue/1e3}})}},{key:"insertStatsLog",value:function(e){var t=this._accumulated;this._count+=1;var n=cu(e,t);this._accumulated=hu(n,this._accumulated,this._count),this._count%(this._interval/1e3)==0&&(this._sendStatsLogCommand(this._accumulated),delete this._accumulated,this._count=0)}},{key:"_sendStatsLogCommand",value:function(e){this._insertInfo();var t=kp.createStatsLogCommand(e);return this._ctx.sender.send(t)}},{key:"_interval",get:function(){return this._call.options.statsIntervalValue}}]),e}(),Dp=function(){function e(t){Hn(this,e),Kn(this,"_count",0),this._call=t,this._init()}return Wn(e,[{key:"_init",value:function(){this._reconnectionCount=0}},{key:"insertStatsLog",value:function(e){var t=this._accumulatedStatsLog;this._count+=1;var n=cu(e,t);this._accumulatedStatsLog=hu(n,this._accumulatedStatsLog,this._count)}},{key:"onDial",value:function(){this._dialSentAt=Date.now()}},{key:"onDialAck",value:function(){this._pdd=Date.now()-this._dialSentAt}},{key:"onAccept",value:function(){this._callSetupStartedAt=Date.now()}},{key:"onAcceptAck",value:function(){this._callSetupStartedAt=Date.now()}},{key:"onConnected",value:function(){this._setupTime=Date.now()-this._callSetupStartedAt}},{key:"increaseReconnectedCount",value:function(){this._reconnectionCount+=1}},{key:"getSummary",value:function(){var e={};if(e.pdd=this._pdd,e.setup_time=this._setupTime,e.reconnection_count=this._reconnectionCount,!this._accumulatedStatsLog)return e;var t=this._accumulatedStatsLog,n=t.transport_info,r=t.audio,i=t.video;return e.network_type=n.network_type,e.transport_info_candidate_type=n.candidate_type,e.audio_codec=r.codec,e.audio_mos=r.mos,e.audio_packets_lost_rate=r.packets_lost_rate,e.audio_rtt=r.rtt,e.video_codec=i.codec,e.video_freeze_count=i.freeze_count,e.video_jitter_buffer_delay=i.jitter_buffer_delay,e.video_jitter_buffer_emitted_count=i.jitter_buffer_emitted_count,e.video_packets_lost_rate=i.packets_lost_rate,e.video_received_frame_height=i.received_frame_height,e.video_received_frame_width=i.received_frame_width,e.video_rtt=i.rtt,e.video_sent_frame_height=i.sent_frame_height,e.video_sent_frame_width=i.sent_frame_width,e.video_total_decode_time=i.total_decode_time,e.video_total_frames_duration=i.total_frames_duration,e.video_total_freezes_duration=i.total_freezes_duration,e.video_total_inter_frame_delay=i.total_inter_frame_delay,e.video_source_frames_per_second=i.video_source_frames_per_second,e.video_source_height=i.video_source_height,e.video_source_width=i.video_source_width,e}}]),e}(),Np=function(){function e(t,n){Hn(this,e),this._ctx=t,this._call=n,this._collector=new Op(t,n),this._summary=new Dp(n)}return Wn(e,[{key:"startGetWebRtcStats",value:function(e){var t=this;this._statsIntervalId||(this._statsIntervalId=setInterval((function(){e.getStatsLog().then((function(e){t._summary.insertStatsLog(e),t._collector.insertStatsLog(e)}))}),1e3))}},{key:"stopGetWebRtcStats",value:function(){this._statsIntervalId&&(clearInterval(this._statsIntervalId),delete this._statsIntervalId)}},{key:"getCallSummary",value:function(){return this._summary.getSummary()}},{key:"summary",get:function(){return this._summary}}]),e}(),Lp=Ge("iterator"),Pp=!i((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Lp]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),xp=2147483647,Mp=/[^\0-\u007E]/,Up=/[.\u3002\uFF0E\uFF61]/g,Vp="Overflow: input needs wider integers to process",Fp=Math.floor,Gp=String.fromCharCode,Bp=function(e){return e+22+75*(e<26)},jp=function(e,t,n){var r=0;for(e=n?Fp(e/700):e>>1,e+=Fp(e/t);e>455;r+=36)e=Fp(e/35);return Fp(r+36*e/(e+38))},qp=function(e){var t=[];e=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var a=e.charCodeAt(n++);56320==(64512&a)?t.push(((1023&i)<<10)+(1023&a)+65536):(t.push(i),n--)}else t.push(i)}return t}(e);var n,r,i=e.length,a=128,o=0,s=72;for(n=0;n<e.length;n++)(r=e[n])<128&&t.push(Gp(r));var c=t.length,u=c;for(c&&t.push("-");u<i;){var l=xp;for(n=0;n<e.length;n++)(r=e[n])>=a&&r<l&&(l=r);var d=u+1;if(l-a>Fp((xp-o)/d))throw RangeError(Vp);for(o+=(l-a)*d,a=l,n=0;n<e.length;n++){if((r=e[n])<a&&++o>xp)throw RangeError(Vp);if(r==a){for(var h=o,f=36;;f+=36){var _=f<=s?1:f>=s+26?26:f-s;if(h<_)break;var v=h-_,p=36-_;t.push(Gp(Bp(_+v%p))),h=Fp(v/p)}t.push(Gp(Bp(h))),s=jp(o,d,u==c),o=0,++u}}++o,++a}return t.join("")},Hp=function(e){var t=nn(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return A(t.call(e))},zp=re("fetch"),Wp=re("Headers"),Kp=Ge("iterator"),Yp="URLSearchParams",Zp=Yp+"Iterator",Qp=J.set,Xp=J.getterFor(Yp),$p=J.getterFor(Zp),Jp=/\+/g,ey=Array(4),ty=function(e){return ey[e-1]||(ey[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},ny=function(e){try{return decodeURIComponent(e)}catch(t){return e}},ry=function(e){var t=e.replace(Jp," "),n=4;try{return decodeURIComponent(t)}catch(e){for(;n;)t=t.replace(ty(n--),ny);return t}},iy=/[!'()~]|%20/g,ay={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},oy=function(e){return ay[e]},sy=function(e){return encodeURIComponent(e).replace(iy,oy)},cy=function(e,t){if(t)for(var n,r,i=t.split("&"),a=0;a<i.length;)(n=i[a++]).length&&(r=n.split("="),e.push({key:ry(r.shift()),value:ry(r.join("="))}))},uy=function(e){this.entries.length=0,cy(this.entries,e)},ly=function(e,t){if(e<t)throw TypeError("Not enough arguments")},dy=Dt((function(e,t){Qp(this,{type:Zp,iterator:Hp(Xp(e).entries),kind:t})}),"Iterator",(function(){var e=$p(this),t=e.kind,n=e.iterator.next(),r=n.value;return n.done||(n.value="keys"===t?r.key:"values"===t?r.value:[r.key,r.value]),n})),hy=function(){sn(this,hy,Yp);var e,t,n,r,i,a,o,s,c,u=arguments.length>0?arguments[0]:void 0,l=[];if(Qp(this,{type:Yp,entries:l,updateURL:function(){},updateSearchParams:uy}),void 0!==u)if(p(u))if("function"==typeof(e=nn(u)))for(n=(t=e.call(u)).next;!(r=n.call(t)).done;){if((o=(a=(i=Hp(A(r.value))).next).call(i)).done||(s=a.call(i)).done||!a.call(i).done)throw TypeError("Expected sequence with length 2");l.push({key:o.value+"",value:s.value+""})}else for(c in u)g(u,c)&&l.push({key:c,value:u[c]+""});else cy(l,"string"==typeof u?"?"===u.charAt(0)?u.slice(1):u:u+"")},fy=hy.prototype;_n(fy,{append:function(e,t){ly(arguments.length,2);var n=Xp(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){ly(arguments.length,1);for(var t=Xp(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){ly(arguments.length,1);for(var t=Xp(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){ly(arguments.length,1);for(var t=Xp(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){ly(arguments.length,1);for(var t=Xp(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){ly(arguments.length,1);for(var n,r=Xp(this),i=r.entries,a=!1,o=e+"",s=t+"",c=0;c<i.length;c++)(n=i[c]).key===o&&(a?i.splice(c--,1):(a=!0,n.value=s));a||i.push({key:o,value:s}),r.updateURL()},sort:function(){var e,t,n,r=Xp(this),i=r.entries,a=i.slice();for(i.length=0,n=0;n<a.length;n++){for(e=a[n],t=0;t<n;t++)if(i[t].key>e.key){i.splice(t,0,e);break}t===n&&i.push(e)}r.updateURL()},forEach:function(e){for(var t,n=Xp(this).entries,r=Ne(e,arguments.length>1?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new dy(this,"keys")},values:function(){return new dy(this,"values")},entries:function(){return new dy(this,"entries")}},{enumerable:!0}),ee(fy,Kp,fy.entries),ee(fy,"toString",(function(){for(var e,t=Xp(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(sy(e.key)+"="+sy(e.value));return n.join("&")}),{enumerable:!0}),bt(hy,Yp),Oe({global:!0,forced:!Pp},{URLSearchParams:hy}),Pp||"function"!=typeof zp||"function"!=typeof Wp||Oe({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,r,i=[e];return arguments.length>1&&(p(t=arguments[1])&&(n=t.body,en(n)===Yp&&((r=t.headers?new Wp(t.headers):new Wp).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=dt(t,{body:u(0,String(n)),headers:u(0,r)}))),i.push(t)),zp.apply(this,i)}});var _y,vy={URLSearchParams:hy,getState:Xp},py=In.codeAt,yy=r.URL,my=vy.URLSearchParams,gy=vy.getState,Ey=J.set,ky=J.getterFor("URL"),Ry=Math.floor,Cy=Math.pow,Iy="Invalid scheme",wy="Invalid host",Ay="Invalid port",Ty=/[A-Za-z]/,by=/[\d+-.A-Za-z]/,Sy=/\d/,Oy=/^(0x|0X)/,Dy=/^[0-7]+$/,Ny=/^\d+$/,Ly=/^[\dA-Fa-f]+$/,Py=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,xy=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,My=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,Uy=/[\u0009\u000A\u000D]/g,Vy=function(e,t){var n,r,i;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return wy;if(!(n=Gy(t.slice(1,-1))))return wy;e.host=n}else if(Yy(e)){if(t=function(e){var t,n,r=[],i=e.toLowerCase().replace(Up,".").split(".");for(t=0;t<i.length;t++)n=i[t],r.push(Mp.test(n)?"xn--"+qp(n):n);return r.join(".")}(t),Py.test(t))return wy;if(null===(n=Fy(t)))return wy;e.host=n}else{if(xy.test(t))return wy;for(n="",r=Ac(t),i=0;i<r.length;i++)n+=Wy(r[i],jy);e.host=n}},Fy=function(e){var t,n,r,i,a,o,s,c=e.split(".");if(c.length&&""==c[c.length-1]&&c.pop(),(t=c.length)>4)return e;for(n=[],r=0;r<t;r++){if(""==(i=c[r]))return e;if(a=10,i.length>1&&"0"==i.charAt(0)&&(a=Oy.test(i)?16:8,i=i.slice(8==a?1:2)),""===i)o=0;else{if(!(10==a?Ny:8==a?Dy:Ly).test(i))return e;o=parseInt(i,a)}n.push(o)}for(r=0;r<t;r++)if(o=n[r],r==t-1){if(o>=Cy(256,5-t))return null}else if(o>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*Cy(256,3-r);return s},Gy=function(e){var t,n,r,i,a,o,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,d=0,h=function(){return e.charAt(d)};if(":"==h()){if(":"!=e.charAt(1))return;d+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(t=n=0;n<4&&Ly.test(h());)t=16*t+parseInt(h(),16),d++,n++;if("."==h()){if(0==n)return;if(d-=n,u>6)return;for(r=0;h();){if(i=null,r>0){if(!("."==h()&&r<4))return;d++}if(!Sy.test(h()))return;for(;Sy.test(h());){if(a=parseInt(h(),10),null===i)i=a;else{if(0==i)return;i=10*i+a}if(i>255)return;d++}c[u]=256*c[u]+i,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==h()){if(d++,!h())return}else if(h())return;c[u++]=t}else{if(null!==l)return;d++,l=++u}}if(null!==l)for(o=u-l,u=7;0!=u&&o>0;)s=c[u],c[u--]=c[l+o-1],c[l+--o]=s;else if(8!=u)return;return c},By=function(e){var t,n,r,i;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=Ry(e/256);return t.join(".")}if("object"==typeof e){for(t="",r=function(e){for(var t=null,n=1,r=null,i=0,a=0;a<8;a++)0!==e[a]?(i>n&&(t=r,n=i),r=null,i=0):(null===r&&(r=a),++i);return i>n&&(t=r,n=i),t}(e),n=0;n<8;n++)i&&0===e[n]||(i&&(i=!1),r===n?(t+=n?":":"::",i=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},jy={},qy=Lo({},jy,{" ":1,'"':1,"<":1,">":1,"`":1}),Hy=Lo({},qy,{"#":1,"?":1,"{":1,"}":1}),zy=Lo({},Hy,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Wy=function(e,t){var n=py(e,0);return n>32&&n<127&&!g(t,e)?e:encodeURIComponent(e)},Ky={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Yy=function(e){return g(Ky,e.scheme)},Zy=function(e){return""!=e.username||""!=e.password},Qy=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Xy=function(e,t){var n;return 2==e.length&&Ty.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},$y=function(e){var t;return e.length>1&&Xy(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},Jy=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&Xy(t[0],!0)||t.pop()},em=function(e){return"."===e||"%2e"===e.toLowerCase()},tm={},nm={},rm={},im={},am={},om={},sm={},cm={},um={},lm={},dm={},hm={},fm={},_m={},vm={},pm={},ym={},mm={},gm={},Em={},km={},Rm=function(e,t,n,r){var i,a,o,s,c,u=n||tm,l=0,d="",h=!1,f=!1,_=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(My,"")),t=t.replace(Uy,""),i=Ac(t);l<=i.length;){switch(a=i[l],u){case tm:if(!a||!Ty.test(a)){if(n)return Iy;u=rm;continue}d+=a.toLowerCase(),u=nm;break;case nm:if(a&&(by.test(a)||"+"==a||"-"==a||"."==a))d+=a.toLowerCase();else{if(":"!=a){if(n)return Iy;d="",u=rm,l=0;continue}if(n&&(Yy(e)!=g(Ky,d)||"file"==d&&(Zy(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=d,n)return void(Yy(e)&&Ky[e.scheme]==e.port&&(e.port=null));d="","file"==e.scheme?u=_m:Yy(e)&&r&&r.scheme==e.scheme?u=im:Yy(e)?u=cm:"/"==i[l+1]?(u=am,l++):(e.cannotBeABaseURL=!0,e.path.push(""),u=gm)}break;case rm:if(!r||r.cannotBeABaseURL&&"#"!=a)return Iy;if(r.cannotBeABaseURL&&"#"==a){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,u=km;break}u="file"==r.scheme?_m:om;continue;case im:if("/"!=a||"/"!=i[l+1]){u=om;continue}u=um,l++;break;case am:if("/"==a){u=lm;break}u=mm;continue;case om:if(e.scheme=r.scheme,a==_y)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==a||"\\"==a&&Yy(e))u=sm;else if("?"==a)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",u=Em;else{if("#"!=a){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),u=mm;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",u=km}break;case sm:if(!Yy(e)||"/"!=a&&"\\"!=a){if("/"!=a){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,u=mm;continue}u=lm}else u=um;break;case cm:if(u=um,"/"!=a||"/"!=d.charAt(l+1))continue;l++;break;case um:if("/"!=a&&"\\"!=a){u=lm;continue}break;case lm:if("@"==a){h&&(d="%40"+d),h=!0,o=Ac(d);for(var v=0;v<o.length;v++){var p=o[v];if(":"!=p||_){var y=Wy(p,zy);_?e.password+=y:e.username+=y}else _=!0}d=""}else if(a==_y||"/"==a||"?"==a||"#"==a||"\\"==a&&Yy(e)){if(h&&""==d)return"Invalid authority";l-=Ac(d).length+1,d="",u=dm}else d+=a;break;case dm:case hm:if(n&&"file"==e.scheme){u=pm;continue}if(":"!=a||f){if(a==_y||"/"==a||"?"==a||"#"==a||"\\"==a&&Yy(e)){if(Yy(e)&&""==d)return wy;if(n&&""==d&&(Zy(e)||null!==e.port))return;if(s=Vy(e,d))return s;if(d="",u=ym,n)return;continue}"["==a?f=!0:"]"==a&&(f=!1),d+=a}else{if(""==d)return wy;if(s=Vy(e,d))return s;if(d="",u=fm,n==hm)return}break;case fm:if(!Sy.test(a)){if(a==_y||"/"==a||"?"==a||"#"==a||"\\"==a&&Yy(e)||n){if(""!=d){var m=parseInt(d,10);if(m>65535)return Ay;e.port=Yy(e)&&m===Ky[e.scheme]?null:m,d=""}if(n)return;u=ym;continue}return Ay}d+=a;break;case _m:if(e.scheme="file","/"==a||"\\"==a)u=vm;else{if(!r||"file"!=r.scheme){u=mm;continue}if(a==_y)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==a)e.host=r.host,e.path=r.path.slice(),e.query="",u=Em;else{if("#"!=a){$y(i.slice(l).join(""))||(e.host=r.host,e.path=r.path.slice(),Jy(e)),u=mm;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",u=km}}break;case vm:if("/"==a||"\\"==a){u=pm;break}r&&"file"==r.scheme&&!$y(i.slice(l).join(""))&&(Xy(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),u=mm;continue;case pm:if(a==_y||"/"==a||"\\"==a||"?"==a||"#"==a){if(!n&&Xy(d))u=mm;else if(""==d){if(e.host="",n)return;u=ym}else{if(s=Vy(e,d))return s;if("localhost"==e.host&&(e.host=""),n)return;d="",u=ym}continue}d+=a;break;case ym:if(Yy(e)){if(u=mm,"/"!=a&&"\\"!=a)continue}else if(n||"?"!=a)if(n||"#"!=a){if(a!=_y&&(u=mm,"/"!=a))continue}else e.fragment="",u=km;else e.query="",u=Em;break;case mm:if(a==_y||"/"==a||"\\"==a&&Yy(e)||!n&&("?"==a||"#"==a)){if(".."===(c=(c=d).toLowerCase())||"%2e."===c||".%2e"===c||"%2e%2e"===c?(Jy(e),"/"==a||"\\"==a&&Yy(e)||e.path.push("")):em(d)?"/"==a||"\\"==a&&Yy(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Xy(d)&&(e.host&&(e.host=""),d=d.charAt(0)+":"),e.path.push(d)),d="","file"==e.scheme&&(a==_y||"?"==a||"#"==a))for(;e.path.length>1&&""===e.path[0];)e.path.shift();"?"==a?(e.query="",u=Em):"#"==a&&(e.fragment="",u=km)}else d+=Wy(a,Hy);break;case gm:"?"==a?(e.query="",u=Em):"#"==a?(e.fragment="",u=km):a!=_y&&(e.path[0]+=Wy(a,jy));break;case Em:n||"#"!=a?a!=_y&&("'"==a&&Yy(e)?e.query+="%27":e.query+="#"==a?"%23":Wy(a,jy)):(e.fragment="",u=km);break;case km:a!=_y&&(e.fragment+=Wy(a,qy))}l++}},Cm=function(e){var t,n,r=sn(this,Cm,"URL"),i=arguments.length>1?arguments[1]:void 0,o=String(e),s=Ey(r,{type:"URL"});if(void 0!==i)if(i instanceof Cm)t=ky(i);else if(n=Rm(t={},String(i)))throw TypeError(n);if(n=Rm(s,o,null,t))throw TypeError(n);var c=s.searchParams=new my,u=gy(c);u.updateSearchParams(s.query),u.updateURL=function(){s.query=String(c)||null},a||(r.href=wm.call(r),r.origin=Am.call(r),r.protocol=Tm.call(r),r.username=bm.call(r),r.password=Sm.call(r),r.host=Om.call(r),r.hostname=Dm.call(r),r.port=Nm.call(r),r.pathname=Lm.call(r),r.search=Pm.call(r),r.searchParams=xm.call(r),r.hash=Mm.call(r))},Im=Cm.prototype,wm=function(){var e=ky(this),t=e.scheme,n=e.username,r=e.password,i=e.host,a=e.port,o=e.path,s=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",Zy(e)&&(u+=n+(r?":"+r:"")+"@"),u+=By(i),null!==a&&(u+=":"+a)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?o[0]:o.length?"/"+o.join("/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},Am=function(){var e=ky(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&Yy(e)?t+"://"+By(e.host)+(null!==n?":"+n:""):"null"},Tm=function(){return ky(this).scheme+":"},bm=function(){return ky(this).username},Sm=function(){return ky(this).password},Om=function(){var e=ky(this),t=e.host,n=e.port;return null===t?"":null===n?By(t):By(t)+":"+n},Dm=function(){var e=ky(this).host;return null===e?"":By(e)},Nm=function(){var e=ky(this).port;return null===e?"":String(e)},Lm=function(){var e=ky(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Pm=function(){var e=ky(this).query;return e?"?"+e:""},xm=function(){return ky(this).searchParams},Mm=function(){var e=ky(this).fragment;return e?"#"+e:""},Um=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(a&&rt(Im,{href:Um(wm,(function(e){var t=ky(this),n=String(e),r=Rm(t,n);if(r)throw TypeError(r);gy(t.searchParams).updateSearchParams(t.query)})),origin:Um(Am),protocol:Um(Tm,(function(e){var t=ky(this);Rm(t,String(e)+":",tm)})),username:Um(bm,(function(e){var t=ky(this),n=Ac(String(e));if(!Qy(t)){t.username="";for(var r=0;r<n.length;r++)t.username+=Wy(n[r],zy)}})),password:Um(Sm,(function(e){var t=ky(this),n=Ac(String(e));if(!Qy(t)){t.password="";for(var r=0;r<n.length;r++)t.password+=Wy(n[r],zy)}})),host:Um(Om,(function(e){var t=ky(this);t.cannotBeABaseURL||Rm(t,String(e),dm)})),hostname:Um(Dm,(function(e){var t=ky(this);t.cannotBeABaseURL||Rm(t,String(e),hm)})),port:Um(Nm,(function(e){var t=ky(this);Qy(t)||(""==(e=String(e))?t.port=null:Rm(t,e,fm))})),pathname:Um(Lm,(function(e){var t=ky(this);t.cannotBeABaseURL||(t.path=[],Rm(t,e+"",ym))})),search:Um(Pm,(function(e){var t=ky(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Rm(t,e,Em)),gy(t.searchParams).updateSearchParams(t.query)})),searchParams:Um(xm),hash:Um(Mm,(function(e){var t=ky(this);""!=(e=String(e))?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Rm(t,e,km)):t.fragment=null}))}),ee(Im,"toJSON",(function(){return wm.call(this)}),{enumerable:!0}),ee(Im,"toString",(function(){return wm.call(this)}),{enumerable:!0}),yy){var Vm=yy.createObjectURL,Fm=yy.revokeObjectURL;Vm&&ee(Cm,"createObjectURL",(function(e){return Vm.apply(yy,arguments)})),Fm&&ee(Cm,"revokeObjectURL",(function(e){return Fm.apply(yy,arguments)}))}bt(Cm,"URL"),Oe({global:!0,forced:!Pp,sham:!a},{URL:Cm});var Gm,Bm=null,jm=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"downloadRecordedFile",value:function(e,t){var n=window.URL.createObjectURL(e),r=document.createElement("a");r.style.display="none",r.href=n,r.download=t,document.body.appendChild(r),r.click(),setTimeout((function(){document.body.removeChild(r),window.URL.revokeObjectURL(n)}),100)}},{key:"getMergedAudioStream",value:function(e,t){var n=[];Bm||(Bm=new(window.AudioContext||window.webkitAudioContext));var r=Bm.createGain();r.gain.value=1;var i=new MediaStream;i.addTrack(e),n.push(Bm.createMediaStreamSource(i).connect(r));var a=new MediaStream;a.addTrack(t),n.push(Bm.createMediaStreamSource(a).connect(r));for(var o=Bm.createMediaStreamDestination(),s=0,c=n;s<c.length;s++){c[s].connect(o)}return o.stream.getAudioTracks()[0]}},{key:"getVideoStream",value:function(e){var t=document.createElement("canvas"),n=al.value,r=n.width,i=n.height;t.width=r,t.height=i;var a=e.videoWidth,o=e.videoHeight,s=t.getContext("2d"),c=setInterval((function(){var n=e.videoWidth,c=e.videoHeight;if((o<c||a<n)&&(a=n,o=c,s.fillRect(0,0,r,i)),c>t.height){var u=e.videoWidth/e.videoHeight;n=(c=t.height)*u}s.drawImage(e,t.width/2-n/2,t.height/2-c/2,n,c)}),10);return{stream:t.captureStream(),cleanup:function(){return clearInterval(c)}}}}]),e}(),qm=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"getRecorderMimeType",value:function(e){switch(e){case Co.REMOTE_AUDIO_AND_VIDEO:case Co.LOCAL_AUDIO_REMOTE_AUDIO_AND_VIDEO:case Co.LOCAL_AUDIO_AND_VIDEO_REMOTE_AUDIO:return this.getVideoRecordFileMimeType();case Co.REMOTE_AUDIO_ONLY:case Co.LOCAL_REMOTE_AUDIOS:return this.getAudioRecordFileMimeType();default:return this.getVideoRecordFileMimeType()}}},{key:"getVideoRecordFileMimeType",value:function(){var e="video/mp4";return MediaRecorder.isTypeSupported(e)||(e="video/webm"),e}},{key:"getAudioRecordFileMimeType",value:function(){var e="audio/mp4";return MediaRecorder.isTypeSupported(e)||(e="audio/webm"),e}},{key:"createStream",value:function(e,t){var n={mimeType:this.getRecorderMimeType(t)},r=e.localMediaView.srcObject,i=e.remoteMediaView.srcObject;switch(t){case Co.REMOTE_AUDIO_AND_VIDEO:return{stream:i,options:n};case Co.REMOTE_AUDIO_ONLY:var a=new MediaStream;return a.addTrack(i.getAudioTracks()[0]),{stream:a,options:n};case Co.LOCAL_REMOTE_AUDIOS:var o=new MediaStream,s=jm.getMergedAudioStream(r.getAudioTracks()[0],i.getAudioTracks()[0]);return o.addTrack(s),{stream:o,options:n};case Co.LOCAL_AUDIO_REMOTE_AUDIO_AND_VIDEO:var c=jm.getVideoStream(e.remoteMediaView),u=c.stream,l=c.cleanup,d=jm.getMergedAudioStream(r.getAudioTracks()[0],i.getAudioTracks()[0]);return u.addTrack(d),{stream:u,options:n,cleanup:l};case Co.LOCAL_AUDIO_AND_VIDEO_REMOTE_AUDIO:var h=jm.getVideoStream(e.localMediaView),f=h.stream,_=h.cleanup,v=jm.getMergedAudioStream(r.getAudioTracks()[0],i.getAudioTracks()[0]);return f.addTrack(v),{stream:f,options:n,cleanup:_};default:return fo.error("Cannot reach here!"),{options:n}}}}]),e}(),Hm=function(){function e(t,n){Hn(this,e),this.call=t,this.stateManager=n,this.timer=null}return Wn(e,[{key:"dialSent",value:function(){fo.verbose("[".concat(this.type,"] dialSent"))}},{key:"dialFailed",value:function(){fo.verbose("[".concat(this.type,"] dialFailed"))}},{key:"accept",value:function(e){fo.verbose("[".concat(this.type,"] accept"))}},{key:"acceptSent",value:function(e){fo.verbose("[".concat(this.type,"] acceptSent"))}},{key:"acceptFailed",value:function(){fo.verbose("[".concat(this.type,"] acceptFailed"))}},{key:"receiveAccept",value:function(){fo.verbose("[".concat(this.type,"] receiveAccept"))}},{key:"receiveAccepted",value:function(){fo.verbose("[".concat(this.type,"] receiveAccepted"))}},{key:"end",value:function(){fo.verbose("[".concat(this.type,"] end"))}},{key:"endSent",value:function(e){fo.verbose("[".concat(this.type,"] endSent"))}},{key:"receiveOffer",value:function(){fo.verbose("[".concat(this.type,"] receiveOffer"))}},{key:"receiveEnd",value:function(e){fo.verbose("[".concat(this.type,"] receiveEnd"))}},{key:"timeout",value:function(){fo.verbose("[".concat(this.type,"] timeout"))}},{key:"pcConnected",value:function(){fo.verbose("[".concat(this.type,"] pc connected"))}},{key:"pcReconnecting",value:function(){fo.verbose("[".concat(this.type,"] pc reconnecting"))}},{key:"closed",value:function(){fo.verbose("[".concat(this.type,"] closed"))}},{key:"onStart",value:function(){}},{key:"onDestroy",value:function(){}},{key:"fireTimeout",value:function(){}},{key:"toggleVideo",value:function(e){fo.verbose("[".concat(this.type,"] toggleVideo ").concat(e))}},{key:"toggleMicrophone",value:function(e){fo.verbose("[".concat(this.type,"] toggleMicrophone ").concat(e))}},{key:"_createTimer",value:function(e,t){var n=this;this.timer?fo.error("Only one timer allowed"):this.timer=setTimeout((function(){n._removeTimer(),e()}),t)}},{key:"_removeTimer",value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}();!function(e){e.IDLE="idle",e.DIALING="dialing",e.RINGING="ringing",e.ACCEPTING="accepting",e.ESTABLISHED="established",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.ICERESTART="icerestart",e.ENDED="ended",e.ABORTED="aborted",e.CLOSING="closing",e.ENDING="ending",e.CANCELED="canceled"}(Gm||(Gm={}));var zm,Wm=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){this.call.stopToSendAlive(),this.call.fireOnEnded()}},{key:"dialSent",value:function(){this.call.sendCancelCommand().catch((function(e){return fo.debug(e)}))}},{key:"dialFailed",value:function(){this.stateManager.toEnded()}},{key:"endSent",value:function(e){this.call.setEndInfo(e.payload.endedCall),this.stateManager.toEnded()}},{key:"receiveEnd",value:function(e){this.call.setEndInfo(e.payload.endedCall),this.stateManager.toEnded()}},{key:"type",get:function(){return Gm.ABORTED}}]),n}(Hm);!function(e){e.ACCEPTING="accepting_timeout",e.ANSWERING="answering_timeout",e.OFFERING="offering_timeout"}(zm||(zm={}));var Km=function(e){Qn(r,e);var t,n=ir(r);function r(){return Hn(this,r),n.apply(this,arguments)}return Wn(r,[{key:"onStart",value:function(){this.call.sendAcceptCommand().catch((function(e){return fo.debug(e)})),this.call.startCallConnectionTimer()}},{key:"acceptSent",value:function(){this.stateManager.toEstablished()}},{key:"receiveOffer",value:(t=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.stateManager.toEstablished();case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"acceptFailed",value:function(){this.call.setEndResult(to.ACCEPT_FAILED),this.stateManager.toClosing()}},{key:"end",value:function(){this.call.sendEndCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.COMPLETED),this.stateManager.toClosing()}},{key:"fireTimeout",value:function(){this.call.sendTimeoutCommand(zm.ACCEPTING).catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.TIMED_OUT),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e),this.call.sendAudioCommand().catch((function(e){return fo.debug(e)}))}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e),this.call.sendVideoCommand().catch((function(e){return fo.debug(e)}))}},{key:"type",get:function(){return Gm.ACCEPTING}}]),r}(Hm),Ym=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){this.call.stopCallConnectionTimer(),this.call.fireOnRinging(),this.stateManager.toClosing()}},{key:"type",get:function(){return Gm.CANCELED}}]),n}(Hm),Zm=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){this.call.stopCallConnectionTimer(),this.call.stopToSendAlive(),this.call.stopCurrentRecording(),this.call.stopScreenShare(),this.call.closeRTCConnection(),this.closed()}},{key:"endSent",value:function(e){this.call.setEndInfo(e.payload.endedCall)}},{key:"closed",value:function(){this.stateManager.toEnding()}},{key:"type",get:function(){return Gm.CLOSING}}]),n}(Hm),Qm=function(e){Qn(n,e);var t=ir(n);function n(e,r,i){var a;return Hn(this,n),(a=t.call(this,e,r)).isReconnected=i,a}return Wn(n,[{key:"onStart",value:function(){this.call.stopCallConnectionTimer(),this.call.startGetWebRtcStats(),this.call.sendConnectedInfo(),this.isReconnected?(this.call.setIsReconnected(!0),this.call.fireOnReconnected(),this.call.playSound(jl.RECONNECTED)):(this.call.calcCallSetupTime(),this.call.fireOnConnected())}},{key:"onDestroy",value:function(){this.call.stopGetWebRtcStats(),this.isReconnected&&this.call.stopSound(jl.RECONNECTED)}},{key:"pcReconnecting",value:function(){this.stateManager.toReconnecting()}},{key:"end",value:function(){this.call.sendEndCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.COMPLETED),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e),this.call.sendAudioCommand().catch((function(e){return fo.debug(e)}))}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e),this.call.sendVideoCommand().catch((function(e){return fo.debug(e)}))}},{key:"type",get:function(){return Gm.CONNECTED}}]),n}(Hm),Xm=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){var e=this;this._createTimer((function(){e._noAnswer()}),this._getTimeoutTime()),this.call.startToSendAlive(),this.call.playSound(jl.DIALING)}},{key:"onDestroy",value:function(){this._removeTimer(),this.call.stopSound(jl.DIALING)}},{key:"receiveAccept",value:function(){this.stateManager.toEstablished()}},{key:"end",value:function(){this.call.sendCancelCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.CANCELED),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"_noAnswer",value:function(){this.call.sendNoAnswerCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.NO_ANSWER),this.stateManager.toClosing()}},{key:"_getTimeoutTime",value:function(){return this.call.options.ringingTimeoutValue}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e),this.call.sendAudioCommand().catch((function(e){return fo.debug(e)}))}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e),this.call.sendVideoCommand().catch((function(e){return fo.debug(e)}))}},{key:"type",get:function(){return Gm.DIALING}}]),n}(Hm),$m=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){this.call.stopAllSound()}},{key:"endSent",value:function(e){this.call.setEndInfo(e.payload.endedCall)}},{key:"type",get:function(){return Gm.ENDED}}]),n}(Hm),Jm=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){this.call.sendCallSummary(),this.call.fireOnEnded(),this.stateManager.toEnded()}},{key:"type",get:function(){return Gm.ENDING}}]),n}(Hm),eg=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this,e,r)).isInitiator=e.isCaller,i}return Wn(n,[{key:"onStart",value:function(){this.call.fireOnEstablished(),this.call.sendAudioCommand(),this.call.sendVideoCommand(),this.call.createPeerConnection(),this.isInitiator&&this.call.startCallConnectionTimer()}},{key:"onDestroy",value:function(){}},{key:"pcConnected",value:function(){this.stateManager.toConnected(!1)}},{key:"end",value:function(){this.call.sendEndCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.COMPLETED),this.stateManager.toClosing()}},{key:"fireTimeout",value:function(){this.call.sendTimeoutCommand(this.isInitiator?zm.OFFERING:zm.ANSWERING).catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.TIMED_OUT),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e),this.call.sendAudioCommand().catch((function(e){return fo.debug(e)}))}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e),this.call.sendVideoCommand().catch((function(e){return fo.debug(e)}))}},{key:"type",get:function(){return Gm.ESTABLISHED}}]),n}(Hm),tg=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"dialSent",value:function(){this.stateManager.toDialing()}},{key:"dialFailed",value:function(){this.call.setEndResult(to.DIAL_FAILED),this.stateManager.toClosing()}},{key:"end",value:function(){this.call.setEndResult(to.CANCELED),this.stateManager.toAborted()}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e)}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e)}},{key:"type",get:function(){return Gm.IDLE}}]),n}(Hm),ng=function(e){Qn(n,e);var t=ir(n);function n(e,r){return Hn(this,n),t.call(this,e,r)}return Wn(n,[{key:"onStart",value:function(){var e=this;this._createTimer((function(){e.call.sendConnectionLostCommand().catch((function(e){return fo.debug(e)}))}),this._getTimeoutTime()),this.call.fireOnReconnecting(),this.call.playSound(jl.RECONNECTING)}},{key:"onDestroy",value:function(){this._removeTimer(),this.call.stopSound(jl.RECONNECTING)}},{key:"pcConnected",value:function(){this.stateManager.toConnected(!0)}},{key:"end",value:function(){this.call.sendEndCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.COMPLETED),this.stateManager.toClosing()}},{key:"endSent",value:function(e){this.call.setEndResult(to.CONNECTION_LOST),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"_getTimeoutTime",value:function(){return 3e4}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e),this.call.sendAudioCommand().catch((function(e){return fo.debug(e)}))}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e),this.call.sendVideoCommand().catch((function(e){return fo.debug(e)}))}},{key:"type",get:function(){return Gm.RECONNECTING}}]),n}(Hm),rg=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return Wn(n,[{key:"onStart",value:function(){var e=this;this._createTimer((function(){e._noAnswer()}),this._getTimeoutTime()),this.call.startToSendAlive(),this.call.playSound(jl.RINGING),this.call.fireOnRinging()}},{key:"onDestroy",value:function(){this._removeTimer(),this.call.stopSound(jl.RINGING)}},{key:"accept",value:function(e){this.stateManager.toAccepting()}},{key:"receiveAccepted",value:function(){this.call.setEndResult(to.OTHER_DEVICE_ACCEPTED),this.stateManager.toClosing()}},{key:"end",value:function(){this.call.sendDeclineCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.DECLINED),this.stateManager.toClosing()}},{key:"endSent",value:function(e){this.call.setEndResult(to.DECLINED),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"receiveEnd",value:function(e){this.call.setEndResult(e.payload.endedCall.endResult),this.call.setEndInfo(e.payload.endedCall),this.stateManager.toClosing()}},{key:"toggleMicrophone",value:function(e){this.call.toggleMicrophone(e)}},{key:"toggleVideo",value:function(e){this.call.toggleVideo(e)}},{key:"_noAnswer",value:function(){this.call.sendNoAnswerCommand().catch((function(e){return fo.debug(e)})),this.call.setEndResult(to.NO_ANSWER),this.stateManager.toClosing()}},{key:"_getTimeoutTime",value:function(){return this.call.options.ringingTimeoutValue}},{key:"type",get:function(){return Gm.RINGING}}]),n}(Hm),ig=function(){function e(t){Hn(this,e),this.call=t,this._state=null}return Wn(e,[{key:"toAborted",value:function(){this._changeState(new Wm(this.call,this))}},{key:"toAccepting",value:function(){this._changeState(new Km(this.call,this))}},{key:"toCanceled",value:function(){this._changeState(new Ym(this.call,this))}},{key:"toClosing",value:function(){this._changeState(new Zm(this.call,this))}},{key:"toConnected",value:function(e){this._changeState(new Qm(this.call,this,e))}},{key:"toDialing",value:function(){this._changeState(new Xm(this.call,this))}},{key:"toEnded",value:function(){this._changeState(new $m(this.call,this))}},{key:"toEnding",value:function(){this._changeState(new Jm(this.call,this))}},{key:"toEstablished",value:function(){this._changeState(new eg(this.call,this))}},{key:"toIdle",value:function(){this._changeState(new tg(this.call,this))}},{key:"toReconnecting",value:function(){this._changeState(new ng(this.call,this))}},{key:"toRinging",value:function(){this._changeState(new rg(this.call,this))}},{key:"_changeState",value:function(e){this._state&&this._state.type===e.type?fo.error(new Error("self-transition is not allowed")):(fo.debug("state: ".concat(this._state?this._state.type:"null"," -> ").concat(e.type)),this._state&&this._state.onDestroy(),this._state=e,this._state.onStart())}},{key:"state",get:function(){return this._state}}]),e}(),ag=function(){function e(t,n,r){Hn(this,e),this._ctx=t,this.peerConnectionId=n,this.callId=r}return Wn(e,[{key:"sendOfferSdp",value:function(e){var t=kp.createOffer(this.callId,this.peerConnectionId,e.sdp);return this._ctx.sender.send(t)}},{key:"sendAnswerSdp",value:function(e){var t=kp.createAnswer(this.callId,this.peerConnectionId,e.sdp);return this._ctx.sender.send(t)}},{key:"sendCandidate",value:function(e){var t=kp.createCandidate(this.callId,this.peerConnectionId,e.candidate,e.sdpMLineIndex,e.sdpMid);return this._ctx.sender.send(t)}}]),e}(),og=vr(null,(function(e,t){var n,r,i,a,o,s,c,u,l,d;return{F:function(t){Qn(r,t);var n=ir(r);function r(t,i){var a;return Hn(this,r),a=n.call(this),e(rr(a)),a._ctx=t,a._options=i,a._localMediaView=null,a._remoteMediaView=null,a._caller=null,a._callee=null,a._localConstraints={audio:!0,video:!0},a._remoteConstraints={audio:void 0,video:void 0},a._endResult=null,a._endInfo=null,a._customItems=null,a._remoteRecordingStatus=Wl.NONE,a._sendBirdChatOptions=null,a._holdedBy=[],a._wasRelayed=!1,a._logManager=new Np(t,rr(a)),a._stateManager=new ig(rr(a)),a._isReconnected=!1,a._rotatablePeerConnection=new Uu(t,{audio:"sendrecv",video:"sendrecv"}),a._rotatablePeerConnection.once("initialized",(function(){a._onPeerConnectionInitialized()})),a._rotatablePeerConnection.on("replaced",(function(){a._onPeerConnectionReplaced()})),a._localStream=new Ul(t.deviceManager),a._localStream.on("streamChanged",(function(){a._onLocalStream()})),a._localStream.on("audioOutputChanged",(function(){a._onAudioOutputChanged()})),a._localStream.on("screenShareStreamStopped",(function(){a.onScreenShareStopped&&a.onScreenShareStopped(),a._dispatchEvent("onScreenShareStopped")})),a}return r}(t),d:[{kind:"field",key:"_remoteCapabilities",value:function(){return[]}},{kind:"get",key:"_pc",value:function(){return this._rotatablePeerConnection.activePeerConnection}},{kind:"get",key:"callId",value:function(){return this._callId}},{kind:"get",key:"isVideoCall",value:function(){return this._isVideoCall}},{kind:"get",key:"isCaller",value:function(){return this._isCaller}},{kind:"get",key:"caller",value:function(){return this._caller}},{kind:"get",key:"callee",value:function(){return this._callee}},{kind:"get",key:"localUser",value:function(){return this._isCaller?this.caller:this.callee}},{kind:"get",key:"remoteUser",value:function(){return this._isCaller?this.callee:this.caller}},{kind:"get",key:"isLocalAudioEnabled",value:function(){return this._localConstraints.audio}},{kind:"get",key:"isRemoteAudioEnabled",value:function(){return this._remoteConstraints.audio}},{kind:"get",key:"isLocalVideoEnabled",value:function(){return this._localConstraints.video}},{kind:"get",key:"isRemoteVideoEnabled",value:function(){return this._remoteConstraints.video}},{kind:"get",key:"localRecordingStatus",value:function(){var e,t;return null!==(e=null===(t=this._record)||void 0===t?void 0:t.recordingStatus)&&void 0!==e?e:Wl.NONE}},{kind:"get",key:"remoteRecordingStatus",value:function(){return this._remoteRecordingStatus}},{kind:"get",key:"localMediaView",value:function(){return this._localMediaView}},{kind:"get",key:"remoteMediaView",value:function(){return this._remoteMediaView}},{kind:"get",key:"myRole",value:function(){return this._isCaller?no.CALLER:no.CALLEE}},{kind:"get",key:"endedBy",value:function(){return this._endInfo?this._endInfo.endedBy:void 0}},{kind:"get",key:"options",value:function(){return this._options}},{kind:"get",key:"isOngoing",value:function(){return!this.isEnded}},{kind:"get",key:"isOnHold",value:function(){return this._holdedBy.length>0}},{kind:"get",key:"_isLocalOnHold",value:function(){return this._holdedBy.indexOf(this.localUser.userId)>-1}},{kind:"get",key:"isEnded",value:function(){return!!this._endResult}},{kind:"get",key:"endResult",value:function(){return this._endResult}},{kind:"get",key:"_state",value:function(){return this._stateManager.state}},{kind:"get",key:"customItems",value:function(){return Zn({},this._customItems)}},{kind:"get",key:"rtcConnection",value:function(){var e;return null===(e=this._pc)||void 0===e?void 0:e.rtcConnection}},{kind:"get",key:"callLog",value:function(){var e=this._state.type;if(e!==Gm.ENDING&&e!==Gm.ENDED)return null;var t=this._endInfo;return new Uv({call_id:t?t.callId:this.callId,is_video_call:t?t.isVideoCall:this.isVideoCall,custom_items:t?t.customItems:this._customItems,user_role:t?t.userRole:this.myRole,started_at:t?t.startedAt:this._startedAt||Date.now(),ended_at:t?t.endedAt:Date.now(),participants:t?t._participants:[this.caller,this.callee],ended_by:this.endedBy,duration:t?t.duration:this.getDuration(),end_result:t?t.endResult:this.endResult,call_type:t?t.callType:"direct"},!1)}},{kind:"get",key:"_record",value:function(){return this._ctx.recordingManager.getRecord(this._recordId)}},{kind:"get",key:"_isTurnChangedSupported",value:function(){return zv.includes("turn_changed")&&this._remoteCapabilities.includes("turn_changed")}},{kind:"method",key:"setLocalMediaView",value:(d=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._updateLocalMediaView(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{kind:"method",key:"setRemoteMediaView",value:(l=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._updateRemoteMediaView(t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{kind:"method",key:"startDuration",value:function(){void 0===this._startedAt&&(this._startedAt=Date.now())}},{kind:"method",key:"getDuration",value:function(){return this._endInfo?this._endInfo.duration:void 0===this._startedAt?0:Date.now()-this._startedAt}},{kind:"method",key:"_send",value:function(e){return this._ctx.sender.send(e)}},{kind:"method",decorators:[bp({callOption:po})],key:"dial",value:function(e){var t=this,n=e.userId,r=e.isVideoCall,i=e.callOption,a=e.customItems,o=e.sendBirdChatOptions;this._isCaller=!0,this._stateManager.toIdle();var s=new Vu;return this._dialDeferred=s,this._isVideoCall=r,this._localStream.mediaConstraints={audio:!0,video:r},this._sendBirdChatOptions=o,this._setLocalOption(i),this._getLocalStream(),this._setCustomItems(a),this._logManager.summary.onDial(),this.sendDialCommand(n).then((function(){var e;null===(e=t._dialDeferred)||void 0===e||e.resolve(),delete t._dialDeferred})).catch((function(e){var n;null===(n=t._dialDeferred)||void 0===n||n.reject(e),delete t._dialDeferred})),s.promise}},{kind:"method",key:"_dialed",value:function(e){this._isCaller=!1;var t=e.payload;this._isVideoCall=t.isVideoCall,this._localStream.mediaConstraints={audio:!0,video:t.isVideoCall},this._remoteCapabilities=t.capabilities,this._initTurnCredential=t.turnCredential,this._isTurnChangedSupported&&(this._initTurnCredential.turnUrls=[this._initTurnCredential.turnUrls[0]]),this._setCallInfo(t.callId,t.caller,t.callee),this._setCustomItems(t.customItems),this._setRemoteOption(t.constraints),this._stateManager.toRinging()}},{kind:"method",key:"_dialSent",value:function(e){var t=e.payload;this._setCallInfo(t.callId,t.caller,t.callee),this._logManager.summary.onDialAck(),this._state.dialSent()}},{kind:"method",decorators:[Zl(Zl.messages.CALL_IS_NOT_SUPPORTED),bp({callOption:po})],key:"accept",value:function(e){var t=e.callOption,n=e.holdActiveCall;fo.info("accept()"),n?this._ctx.callManager.holdExcept(this):this._ctx.callManager.endExcept(this),this._setLocalOption(t),this._getLocalStream(),this._logManager.summary.onAccept(),this._state.accept(t)}},{kind:"method",key:"_receiveAccept",value:function(e){var t=e.payload;this._remoteCapabilities=t.capabilities,this._initTurnCredential=t.turnCredential,this._isTurnChangedSupported&&(this._initTurnCredential.turnUrls=[this._initTurnCredential.turnUrls[0]]),this._setRemoteOption(t.constraints),this._logManager.summary.onAcceptAck(),this._state.receiveAccept()}},{kind:"method",key:"_canceled",value:function(e){var t=e.payload.endedCall;this._setCallInfo(t.callId,t.caller,t.callee),this._setCustomItems(t.customItems),this.setEndResult(t.endResult),this.setEndInfo(t),this._stateManager.toCanceled()}},{kind:"method",key:"end",value:function(){fo.info("end()"),this._dialDeferred&&(this._dialDeferred.reject(new td(Ln.DIAL_CANCELED)),delete this._dialDeferred),this._state.end()}},{kind:"method",key:"_setLocalOption",value:function(e){this._updateLocalMediaView(e.localMediaView),this._updateRemoteMediaView(e.remoteMediaView),this._localConstraints.audio=e.audioEnabled,this._localConstraints.video=e.videoEnabled}},{kind:"method",key:"_setRemoteOption",value:function(e){this._remoteConstraints=e}},{kind:"method",key:"_setCallInfo",value:function(e,t,n){this._callId=e,this._caller=t,this._callee=n}},{kind:"method",key:"setEndResult",value:function(e){this._endResult=e}},{kind:"method",key:"setEndInfo",value:function(e){this._endInfo=e}},{kind:"method",key:"_setRemoteAudioEnabled",value:function(e){var t,n=this._remoteConstraints.audio;(this._remoteConstraints.audio=e,n!==e)&&(this._dispatchEvent("onRemoteAudioSettingsChanged",this),null===(t=this.onRemoteAudioSettingsChanged)||void 0===t||t.call(this,this))}},{kind:"method",key:"_setRemoteVideoEnabled",value:function(e){var t,n=this._remoteConstraints.video;(this._remoteConstraints.video=e,n!==e)&&(this._dispatchEvent("onRemoteVideoSettingsChanged",this),null===(t=this.onRemoteVideoSettingsChanged)||void 0===t||t.call(this,this))}},{kind:"method",key:"_setHoldInfo",value:function(e,t,n){var r,i=t?this.localUser:this.remoteUser;if(this._wasRelayed)if(n){this._holdedBy.indexOf(i.userId)<0&&this._holdedBy.push(i.userId)}else{var a=this._holdedBy.indexOf(i.userId);a>-1&&this._holdedBy.splice(a,1)}else this._holdedBy=e;this._updateStreamByHoldStream(),this._dispatchEvent("onUserHoldStatusChanged",this,t,n),null===(r=this.onUserHoldStatusChanged)||void 0===r||r.call(this,this,t,n)}},{kind:"method",key:"_setCustomItems",value:function(e){this._customItems=e||{}}},{kind:"method",key:"_setRemoteRecordingStatus",value:function(e){var t,n=this._remoteRecordingStatus;(this._remoteRecordingStatus=e,e!==n)&&(this._dispatchEvent("onRemoteRecordingStatusChanged",this),null===(t=this.onRemoteRecordingStatusChanged)||void 0===t||t.call(this,this))}},{kind:"method",key:"closeRTCConnection",value:function(){this._releaseLocalStream(),this._rotatablePeerConnection.removeAllEventListeners(),this._rotatablePeerConnection.close()}},{kind:"method",key:"startVideo",value:function(){fo.info("startVideo()"),this._state.toggleVideo(!0)}},{kind:"method",key:"stopVideo",value:function(){fo.info("stopVideo()"),this._state.toggleVideo(!1)}},{kind:"method",key:"hold",value:(u=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fo.info("hold()"),!this._isLocalOnHold){e.next=3;break}throw new Ja(Ln.ERR_CALL_ALREADY_ON_HOLD);case 3:return e.next=5,this.sendHoldCommand(!0,this._wasRelayed);case 5:case"end":return e.stop()}}),e,this)}))),function(){return u.apply(this,arguments)})},{kind:"method",key:"unhold",value:(c=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fo.info("unhold()"),this._isLocalOnHold){e.next=3;break}throw new Ja(Ln.ERR_ACTIVE_CALL_IN_PROGRESS);case 3:if(t&&this._ctx.callManager.endExcept(this),!(this._ctx.callManager.getActiveCallCount()>0)){e.next=6;break}throw new Ja(Ln.ERR_ANOTHER_CALL_IN_PROGRESS);case 6:return e.next=8,this.sendHoldCommand(!1,this._wasRelayed);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{kind:"method",key:"_holdSent",value:function(e,t){var n=e.payload;n.isRelayed&&(this._wasRelayed=!0),this._setHoldInfo(n.holdedBy,!0,t)}},{kind:"method",key:"_updateStreamByHoldStream",value:function(){var e=this;this.stopScreenShare();var t=this._getLocalStream();t&&(t.getAudioTracks().forEach((function(t){t.enabled=e._isMediaEnabled("audio")})),t.getVideoTracks().forEach((function(t){t.enabled=e._isMediaEnabled("video")}))),this._pc.remoteStream&&(this._pc.remoteStream.getAudioTracks().forEach((function(t){t.enabled=!e.isOnHold})),this._pc.remoteStream.getVideoTracks().forEach((function(t){t.enabled=!e.isOnHold})))}},{kind:"method",key:"_checkRecordingCondition",value:function(e){return this._state.type!==Gm.CONNECTED?(fo.error(Ir.getErrorMessage(Ln.ERR_CALL_NOT_CONNECTED_YET)),!1):!(!this.isVideoCall&&e.isVideo)||(fo.error(Ir.getErrorMessage(Ln.ERR_WRONG_RECORDING_TYPE_FOR_AUDIO_CALL)),!1)}},{kind:"method",key:"startRecording",value:function(e){var t=this,n=new Oo(e);if(!Object.values(Co).includes(n.recordingType))return fo.error(Ir.getErrorMessage(Ln.ERR_INVALID_RECORDING_TYPE)),!1;try{!function(){if(!window.MediaRecorder){var e=Ir.getErrorMessage(Ln.ERR_NOT_SUPPORTED_BROWSER_FOR_RECORDING);throw fo.error(e),e}}()}catch(e){return}if(this._checkRecordingCondition(n))if(this._recordId)fo.error(Ir.getErrorMessage(Ln.ERR_RECORDING_ALREADY_IN_PROGRESS));else{var r=qm.createStream(this,n.recordingType),i=r.stream,a=r.options,o=r.cleanup,s=this._ctx.recordingManager.startRecording(i,a,Zn(Zn({},n),{},{callId:this.callId}));if(s){var c=function(){t.sendRecordingCommand(s.recordId,e.recordingType,s.recordingStatus)};return s.on("start",(function(){return c()})),s.on("stop",(function(){o&&o(),c()})),s.on("pause",(function(){return c()})),s.on("resume",(function(){return c()})),s.on("error",(function(){return c()})),this._recordId=s.recordId,s.recordId}}}},{kind:"method",key:"stopRecording",value:function(e){return e&&this._recordId===e?(this._ctx.recordingManager.stopRecording(e),delete this._recordId,!0):(fo.error(Ir.getErrorMessage(Ln.ERR_FAILED_TO_STOP_RECORDING)),!1)}},{kind:"method",key:"stopCurrentRecording",value:function(){return!!this._recordId&&this.stopRecording(this._recordId)}},{kind:"method",key:"toggleVideo",value:function(e){var t=this;if(this._localConstraints.video!==e){this._localConstraints.video=e;var n=this._getLocalStream();n&&n.getVideoTracks().forEach((function(e){e.enabled=t._isMediaEnabled("video")}))}}},{kind:"method",key:"muteMicrophone",value:function(){fo.info("muteMicrophone()"),this._state.toggleMicrophone(!1)}},{kind:"method",key:"unmuteMicrophone",value:function(){fo.info("unmuteMicrophone()"),this._state.toggleMicrophone(!0)}},{kind:"method",key:"toggleMicrophone",value:function(e){var t=this;if(this._localConstraints.audio!==e){this._localConstraints.audio=e;var n=this._getLocalStream();n&&n.getAudioTracks().forEach((function(e){e.enabled=t._isMediaEnabled("audio")}))}}},{kind:"method",key:"_validateScreenShareAvailability",value:function(){if(this._state.type!==Gm.CONNECTED&&this._state.type!==Gm.RECONNECTING)throw new Ja(Ln.ERR_SCREEN_SHARE_REQUEST_BEFORE_CALL_IS_CONNECTED);if(!this.isVideoCall)throw new Ja(Ln.ERR_SCREEN_SHARE_RESTRICTED_FROM_AUDIO_CALL);if(this.isLocalScreenShareEnabled)throw new Ja(Ln.ERR_SCREEN_SHARE_ALREADY_IN_PROGRESS);if(this.isOnHold)throw new Ja(Ln.ERR_MEDIA_STREAM_NOT_ALLOWED_ON_HOLD)}},{kind:"get",key:"isLocalScreenShareEnabled",value:function(){return this._localStream.isScreenSharing}},{kind:"method",key:"startScreenShare",value:(s=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._validateScreenShareAvailability(),e.next=3,this._localStream.useScreenStream();case 3:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{kind:"method",key:"stopScreenShare",value:function(){this.isLocalScreenShareEnabled&&this._localStream.stopScreenShare()}},{kind:"method",key:"_validateCaptureAvailability",value:function(e){if(this._state.type!==Gm.CONNECTED)throw new Ja(Ln.ERR_VIDEO_CALL_NOT_CONNECTED_YET);if(!this.isVideoCall)throw new Ja(Ln.ERR_CAPTURE_NOT_ALLOWED_ON_AUDIO_CALL);if(e instanceof HTMLAudioElement)throw new Ja(Ln.ERR_VIDEO_VIEW_NOT_READY);if(null==e||!e.srcObject)throw new Ja(Ln.ERR_VIDEO_VIEW_NOT_READY);if(this.isOnHold)throw new Ja(Ln.ERR_MEDIA_STREAM_NOT_ALLOWED_ON_HOLD)}},{kind:"method",key:"captureLocalVideoView",value:function(e){var t=this,n=new Promise((function(e,n){t._validateCaptureAvailability(t._localMediaView),e(t._captureVideoView(t._localMediaView))}));return e&&eo(n)(e),n}},{kind:"method",key:"captureRemoteVideoView",value:function(e){var t=this,n=new Promise((function(e,n){t._validateCaptureAvailability(t.remoteMediaView),e(t._captureVideoView(t._remoteMediaView))}));return e&&eo(n)(e),n}},{kind:"method",key:"_captureVideoView",value:function(e){try{var t,n,r=document.createElement("canvas"),i=r.getContext("2d"),a=e;r.width=null!==(t=a.videoWidth)&&void 0!==t?t:640,r.height=null!==(n=a.videoHeight)&&void 0!==n?n:360,i.drawImage(a,0,0);var o={width:r.width,height:r.height,data:r.toDataURL("image/jpeg",1)};return r.remove(),o}catch(e){throw fo.error(e),new Ja(Ln.ERR_FAILED_TO_GET_IMAGE_FROM_VIDEO_STREAM)}}},{kind:"method",key:"updateCustomItems",value:function(e,t){var n=this,r=or(ro(e,t),2)[1];if(r)return r;var i=kp.createUpdateCustomItems(this.callId,e),a=this._send(i).then((function(e){return n._setCustomItems(e.custom_items),{customItems:e.custom_items,affectedKeys:e.updated}})).catch((function(e){throw fo.error("failed to update customItems"),e}));return t&&eo(a)(t),a}},{kind:"method",key:"deleteCustomItems",value:function(e,t){var n=this,r=or(io(e,t),2)[1];if(r)return r;var i=kp.createDeleteCustomItems(this.callId,e),a=this._send(i).then((function(e){return n._setCustomItems(e.custom_items),{customItems:e.custom_items,affectedKeys:e.deleted}})).catch((function(e){throw fo.error("failed to delete customItems"),e}));return t&&eo(a)(t),a}},{kind:"method",key:"deleteAllCustomItems",value:function(e){var t=this,n=kp.createDeleteAllCustomItems(this.callId),r=this._send(n).then((function(e){return t._setCustomItems(e.custom_items),{customItems:e.custom_items,affectedKeys:e.deleted}})).catch((function(e){throw fo.error("failed to delete all customItems"),e}));return e&&eo(r)(e),r}},{kind:"method",key:"fireOnRinging",value:function(){fo.info("onRinging"),this.onRinging&&this.onRinging()}},{kind:"method",key:"fireOnEstablished",value:function(){var e;fo.info("onEstablished"),this._dispatchEvent("onEstablished",this),null===(e=this.onEstablished)||void 0===e||e.call(this,this)}},{kind:"method",key:"fireOnEnded",value:function(){var e;switch(this.endResult){case to.NO_ANSWER:case to.CANCELED:case to.DECLINED:case to.OTHER_DEVICE_ACCEPTED:case to.COMPLETED:fo.info("onEnded");break;case to.TIMED_OUT:fo.warning("onEnded");break;case to.CONNECTION_LOST:case to.DIAL_FAILED:case to.ACCEPT_FAILED:case to.UNKNOWN:fo.error("onEnded");break;default:fo.info("onEnded")}this._dispatchEvent("onEnded",this),null===(e=this.onEnded)||void 0===e||e.call(this,this)}},{kind:"method",key:"fireOnConnected",value:function(){var e;fo.info("onConnected"),this._dispatchEvent("onConnected",this),null===(e=this.onConnected)||void 0===e||e.call(this,this)}},{kind:"method",key:"fireOnReconnecting",value:function(){var e;fo.info("onReconnecting"),this._dispatchEvent("onReconnecting",this),null===(e=this.onReconnecting)||void 0===e||e.call(this,this)}},{kind:"method",key:"fireOnReconnected",value:function(){var e;fo.info("onReconnected"),this._dispatchEvent("onReconnected",this),null===(e=this.onReconnected)||void 0===e||e.call(this,this)}},{kind:"method",key:"sendDialCommand",value:function(e){var t=this,n=kp.createDial(e,this._isVideoCall,this._customItems,this._sendBirdChatOptions,this._localConstraints);return this._send(n).then((function(e){t.onEvent(e)})).catch((function(e){throw t._state.dialFailed(),e}))}},{kind:"method",key:"sendAcceptCommand",value:function(){var e=this,t=kp.createAccept(this.callId,this._localConstraints);return this._send(t).then((function(t){e.onEvent(t)})).catch((function(t){throw e._state.acceptFailed(),t}))}},{kind:"method",key:"sendCancelCommand",value:function(){var e=this,t=kp.createCancel(this.callId);return this._send(t).then((function(t){e.onEvent(t)}))}},{kind:"method",key:"sendDeclineCommand",value:function(){var e=this,t=kp.createDecline(this.callId);return this._send(t).then((function(t){e.onEvent(t)}))}},{kind:"method",key:"sendEndCommand",value:function(){var e=this,t=kp.createEnd(this.callId);return this._send(t).then((function(t){e.onEvent(t)}))}},{kind:"method",key:"sendTimeoutCommand",value:function(e){var t=this,n=kp.createTimeout(this.callId,e);return this._send(n).then((function(e){t.onEvent(e)}))}},{kind:"method",key:"sendConnectionLostCommand",value:function(){var e=this,t=kp.createConnectionLost(this.callId);return this._send(t).then((function(t){e.onEvent(t)}))}},{kind:"method",key:"sendNoAnswerCommand",value:function(){var e=this,t=kp.createNoAnswer(this.callId);return this._send(t).then((function(t){e.onEvent(t)}))}},{kind:"method",key:"sendAliveCommand",value:function(){var e=kp.createAlive(this.callId);return this._send(e)}},{kind:"method",key:"sendAudioCommand",value:function(){var e=kp.createAudio(this.callId,this._localConstraints.audio);return this._send(e)}},{kind:"method",key:"sendVideoCommand",value:function(){var e=kp.createVideo(this.callId,this._localConstraints.video);return this._send(e)}},{kind:"method",key:"sendCallSummaryCommand",value:function(e){var t=kp.createCallSummaryCommand(this._callId,this.myRole,e);return this._send(t)}},{kind:"method",key:"sendConnectedCommand",value:function(e,t,n){var r=kp.createConnected(e,t,n);return this._send(r)}},{kind:"method",key:"sendRecordingCommand",value:function(e,t,n){var r=kp.createRecording(this.callId,e,t,n);return this._send(r)}},{kind:"method",key:"sendHoldCommand",value:function(e,t){var n=this,r=kp.createHoldCommand(this.callId,e,t);return this._send(r).then((function(t){n._holdSent(t,e)}))}},{kind:"method",key:"startToSendAlive",value:function(){var e=this;this._aliveIntervalId=setInterval((function(){e.sendAliveCommand().catch((function(e){return fo.debug(e)}))}),3e4)}},{kind:"method",key:"stopToSendAlive",value:function(){this._aliveIntervalId&&(clearInterval(this._aliveIntervalId),delete this._aliveIntervalId)}},{kind:"method",key:"startGetWebRtcStats",value:function(){this._logManager.startGetWebRtcStats(this._rotatablePeerConnection)}},{kind:"method",key:"stopGetWebRtcStats",value:function(){this._logManager.stopGetWebRtcStats()}},{kind:"method",key:"sendConnectedInfo",value:function(){var e=this;this._pc.getCandidateInfo().then((function(t){t&&e.sendConnectedCommand(e.callId,t,e._isReconnected)}))}},{kind:"method",key:"sendCallSummary",value:function(){if(this.callId&&this.endResult!==to.OTHER_DEVICE_ACCEPTED){var e=this._logManager.getCallSummary();this.sendCallSummaryCommand(e)}}},{kind:"method",key:"startCallConnectionTimer",value:function(){var e=this;this._callConnectionTimer=setTimeout((function(){e._state.fireTimeout()}),this._options.callConnectionTimeoutValue)}},{kind:"method",key:"stopCallConnectionTimer",value:function(){this._callConnectionTimer&&(clearTimeout(this._callConnectionTimer),delete this._callConnectionTimer)}},{kind:"method",key:"playSound",value:(o=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._ctx.soundManager.playSound(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{kind:"method",key:"stopSound",value:function(e){return this._ctx.soundManager.stopSound(e)}},{kind:"method",key:"stopAllSound",value:function(){return this._ctx.soundManager.stopAllSound()}},{kind:"method",key:"_receiveAudio",value:function(e){this._setRemoteAudioEnabled(e.payload.isEnabled)}},{kind:"method",key:"_receiveVideo",value:function(e){this._setRemoteVideoEnabled(e.payload.isEnabled)}},{kind:"method",key:"_receiveHold",value:function(e){e.payload.isRelayed&&(this._wasRelayed=!0),this._setHoldInfo(e.payload.holdedBy,!1,e.payload.isPeerOnHold)}},{kind:"method",key:"_receiveCustomItemsUpdate",value:function(e){var t;this._setCustomItems(e.payload.customItems),this._dispatchEvent("onCustomItemsUpdated",this,e.payload.updated),null===(t=this.onCustomItemsUpdated)||void 0===t||t.call(this,this,e.payload.updated)}},{kind:"method",key:"_receiveCustomItemsDelete",value:function(e){var t;this._setCustomItems(e.payload.customItems),this._dispatchEvent("onCustomItemsDeleted",this,e.payload.deleted),null===(t=this.onCustomItemsDeleted)||void 0===t||t.call(this,this,e.payload.deleted)}},{kind:"method",key:"_receiveRecording",value:function(e){this._setRemoteRecordingStatus(e.payload.recordingStatus)}},{kind:"method",key:"_receiveTurnChanged",value:function(e){if(this._isTurnChangedSupported){var t=e.payload,n=t.turnCredential,r=t.eventId;this.createPeerConnection(r,n)}}},{kind:"method",key:"_registerPCListeners",value:function(){var e=this,t=this._pc;t.on("connected",(function(){e._onPeerConnectionConnected()})),t.on("reconnecting",(function(){e._onPeerConnectionReconnecting()})),t.on("remoteStream",(function(){e._onRemoteStream()}))}},{kind:"method",key:"createPeerConnection",value:function(e,t){var n=new ag(this._ctx,e,this.callId),r=this._rotatablePeerConnection.createPeerConnection(e,n,this._localStream,this._isCaller,e?t:this._initTurnCredential);return this.isCaller&&r.createOffer(),r}},{kind:"method",key:"_onPeerConnectionConnected",value:function(){this._state.pcConnected()}},{kind:"method",key:"_onPeerConnectionReconnecting",value:function(){this._state.pcReconnecting()}},{kind:"method",key:"_onPeerConnectionInitialized",value:function(){this._registerPCListeners(),this._onRemoteStream()}},{kind:"method",key:"_onPeerConnectionReplaced",value:function(){this._onPeerConnectionInitialized(),this._onPeerConnectionConnected()}},{kind:"method",key:"_receiveSnapshot",value:function(e){fo.verbose("snapshot is received");var t=e.payload,n=t.audioEnabled,r=t.videoEnabled,i=t.customItems,a=t.recording;if("boolean"==typeof n&&this._setRemoteAudioEnabled(n),"boolean"==typeof r&&this._setRemoteVideoEnabled(r),a?this._setRemoteRecordingStatus(Wl.RECORDING):this._setRemoteRecordingStatus(Wl.NONE),i){var o,s,c=i,u=Object.keys(c),l=this._customItems,d=Object.keys(l),h=u.filter((function(e){return!d.includes(e)||c[e]!==l[e]})),f=d.filter((function(e){return!u.includes(e)}));if(this._setCustomItems(i),h.length>0)this._dispatchEvent("onCustomItemsUpdated",this,h),null===(o=this.onCustomItemsUpdated)||void 0===o||o.call(this,this,h);if(f.length>0)this._dispatchEvent("onCustomItemsDeleted",this,f),null===(s=this.onCustomItemsDeleted)||void 0===s||s.call(this,this,f)}}},{kind:"method",key:"_passToPeerConnection",value:function(e){switch(e.type){case dd.CANDIDATE:var t=mu.createCandidate(e.payload.peerConnectionId,e.payload.candidate);this._rotatablePeerConnection.onEvent(t);break;case dd.OFFER:var n=mu.createOffer(e.payload.peerConnectionId,e.payload.sdp);this._rotatablePeerConnection.onEvent(n);break;case dd.ANSWER:var r=mu.createAnswer(e.payload.peerConnectionId,e.payload.sdp);this._rotatablePeerConnection.onEvent(r)}}},{kind:"method",key:"onEvent",value:function(e){switch(fo.verbose("'onEvent' on ".concat(e.constructor.name)),e.type){case dd.DIAL:this._dialed(e);break;case dd.DIAL_ACK:this._dialSent(e);break;case dd.DIAL_RCV:break;case dd.ACCEPT:this._receiveAccept(e);break;case dd.ACCEPT_ACK:this._state.acceptSent(e);break;case dd.OTHER_DEVICE_ACCEPTED:this._state.receiveAccepted();break;case dd.CANCEL:this._canceled(e);break;case dd.DECLINE:case dd.END:case dd.TIME_OUT:case dd.NO_ANSWER:case dd.CONNECTION_LOST:case dd.UNKNOWN_END:this._state.receiveEnd(e);break;case dd.CANCEL_ACK:case dd.DECLINE_ACK:case dd.END_ACK:case dd.TIMEOUT_ACK:case dd.NO_ANSWER_ACK:case dd.CONNECTION_LOST_ACK:case dd.UNKNOWN_END_ACK:this._state.endSent(e);break;case dd.REMOVE_CANDIDATES:break;case dd.AUDIO:this._receiveAudio(e);break;case dd.VIDEO:this._receiveVideo(e);break;case dd.HOLD:this._receiveHold(e);break;case dd.CUSTOM_ITEMS_UPDATE:this._receiveCustomItemsUpdate(e);break;case dd.CUSTOM_ITEMS_DELETE:this._receiveCustomItemsDelete(e);break;case dd.RECORDING:this._receiveRecording(e);break;case dd.TURN_CHANGED:this._receiveTurnChanged(e);break;case dd.SNAPSHOT:this._receiveSnapshot(e);break;case dd.CANDIDATE:this._passToPeerConnection(e);break;case dd.OFFER:this._passToPeerConnection(e),"accepting"===this._state.type&&this._state.receiveOffer(),this._startedAt||this.startDuration();break;case dd.ANSWER:this._passToPeerConnection(e),this._startedAt||this.startDuration();break;default:fo.error(new Error("unhandled call event ".concat(e.type)))}}},{kind:"method",key:"_onAudioOutputChanged",value:(a=qn(regeneratorRuntime.mark((function e(){var t,n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this._ctx.deviceManager.getCurrentAudioOutputDevice(),e.next=3,null===(t=this._localMediaView)||void 0===t||null===(n=t.setSinkId)||void 0===n?void 0:n.call(t,a.deviceId);case 3:return e.next=5,null===(r=this._remoteMediaView)||void 0===r||null===(i=r.setSinkId)||void 0===i?void 0:i.call(r,a.deviceId);case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{kind:"method",key:"_onLocalStream",value:function(){var e=this._getLocalStream();this._localMediaView&&(this._localMediaView.srcObject=e);var t,n=fr(e.getTracks());try{for(n.s();!(t=n.n()).done;){var r,i=t.value;i.enabled=null===(r=this._isMediaEnabled)||void 0===r?void 0:r.call(this,i.kind)}}catch(e){n.e(e)}finally{n.f()}}},{kind:"method",key:"_onRemoteStream",value:function(){this._remoteMediaView&&(this._remoteMediaView.srcObject=this._pc.remoteStream)}},{kind:"method",key:"calcCallSetupTime",value:function(){this._logManager.summary.onConnected()}},{kind:"method",key:"setIsReconnected",value:function(e){this._isReconnected=e,this._logManager.summary.increaseReconnectedCount()}},{kind:"method",key:"_isMediaEnabled",value:function(e){switch(e){case"audio":return this._localConstraints.audio&&!this.isOnHold;case"video":return this._localConstraints.video&&!this.isOnHold;default:return fo.error(new Error("unrecognized media type ".concat(e))),!1}}},{kind:"method",key:"_updateLocalMediaView",value:(i=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._localMediaView!==t){e.next=2;break}return e.abrupt("return");case 2:if(this._localMediaView&&(this._localMediaView.srcObject=null),t){e.next=6;break}return this._localMediaView=null,e.abrupt("return");case 6:return e.next=8,this._updateMediaView(t,this._getLocalStream());case 8:this._localMediaView=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{kind:"method",key:"_updateRemoteMediaView",value:(r=qn(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._remoteMediaView!==t){e.next=2;break}return e.abrupt("return");case 2:if(this._remoteMediaView&&(this._remoteMediaView.srcObject=null),t){e.next=6;break}return this._remoteMediaView=null,e.abrupt("return");case 6:return e.next=8,this._updateMediaView(t,null===(n=this._pc)||void 0===n?void 0:n.remoteStream);case 8:this._remoteMediaView=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{kind:"method",key:"_updateMediaView",value:(n=qn(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this._ctx.deviceManager.getCurrentAudioOutputDevice())){e.next=4;break}return e.next=4,null===(i=t.setSinkId)||void 0===i?void 0:i.call(t,r.deviceId);case 4:return n&&(t.srcObject=n),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{kind:"method",key:"_getLocalStream",value:function(){return this._localStream.localStream}},{kind:"method",key:"_releaseLocalStream",value:function(){this._localStream&&(this._localStream.removeAllEventListeners(),this._localStream.release())}}]}}),Sp),sg=function(){function e(t){var n=t.ringingTimeout,r=t.callConnectionTimeout,i=t.statsInterval;Hn(this,e),this._ringingTimeout=n,this._callConnectionTimeout=r,this._statsInterval=i}return Wn(e,[{key:"ringingTimeoutValue",get:function(){return this._ringingTimeout}},{key:"callConnectionTimeoutValue",get:function(){return this._callConnectionTimeout}},{key:"statsIntervalValue",get:function(){return this._statsInterval}}]),e}(),cg=function(){function e(t){Hn(this,e),this._ctx=t,this.options={ringingTimeout:6e4,callConnectionTimeout:6e4,statsInterval:3e3}}return Wn(e,[{key:"createDirectCall",value:function(){return new og(this._ctx,new sg(this.options))}},{key:"setRingingTimeout",value:function(e){"number"==typeof e&&e>0&&(this.options.ringingTimeout=1e3*e)}},{key:"setStatsInterval",value:function(e){if("number"==typeof e){var t=e;t<1&&(t=1),t>60&&(t=60),this.options.statsInterval=1e3*t}}},{key:"setCallConnectionTimeout",value:function(e){"number"==typeof e&&e>0&&(this.options.callConnectionTimeout=1e3*e)}}]),e}(),ug=function e(t){var n;Hn(this,e),this.audioEnabled=t.is_audio_enabled,this.videoEnabled=t.is_video_enabled,this.customItems=null===(n=t.custom_items)||void 0===n?void 0:n.custom_items},lg=function(){function e(t){Hn(this,e),this.callId=t.call_id,this.callType=t.call_type,this.userRole=t.user_role,this.callerClientId=t.caller_client_id,this.calleeClientId=t.callee_client_id,this.signalSeq=t.signal_seq.map(kp.parse).filter((function(e){return!!e})),this.signalSnapshot=new ug(t.signal_snapshot)}return Wn(e,[{key:"getAcceptResponse",value:function(){return this.signalSeq.find((function(e){return e.type===dd.ACCEPT_ACK}))}},{key:"getDeclineResponse",value:function(){return this.signalSeq.find((function(e){return e.type===dd.DECLINE_ACK}))}},{key:"commands",get:function(){return this.signalSeq}},{key:"snapshot",get:function(){return this.signalSnapshot}}]),e}(),dg=function(){function e(t){Hn(this,e),this._ctx=t,this._callFactory=new cg(t),this._calls=new Map,this.dialListeners=new Map}return Wn(e,[{key:"setRingingTimeout",value:function(e){this._callFactory.setRingingTimeout(e)}},{key:"setStatsInterval",value:function(e){this._callFactory.setStatsInterval(e)}},{key:"setCallConnectionTimeout",value:function(e){this._callFactory.setCallConnectionTimeout(e)}},{key:"getCall",value:function(e){return this._calls.get(e)}},{key:"_hasCall",value:function(e){return this._calls.has(e)}},{key:"getOngoingCalls",value:function(){return sr(this._calls.values())}},{key:"getOngoingCallCount",value:function(){return sr(this._calls.values()).reduce((function(e,t){return t.isOngoing?e+1:e}),0)}},{key:"getActiveCallCount",value:function(){return sr(this._calls.values()).reduce((function(e,t){return t.isOnHold?e:e+1}),0)}},{key:"dial",value:function(e,t){var n=this,r=this._callFactory.createDirectCall();e.holdActiveCall?this.holdExcept(r):this.endExcept(r);var i=r.dial(e).then((function(){return n._register(r.callId,r),r})).catch((function(e){throw fo.error(e),e}));return t&&eo(i)(t),r}},{key:"holdExcept",value:function(e){var t,n=fr(this._calls.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.callId===e.callId||r.isOnHold||r.hold()}}catch(e){n.e(e)}finally{n.f()}}},{key:"endExcept",value:function(e){var t,n=fr(this._calls.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.callId!==e.callId&&r.end()}}catch(e){n.e(e)}finally{n.f()}}},{key:"onEvent",value:function(e){switch(e.type){case dd.DIAL:this._onCallDialed(e);break;case dd.CANCEL:this._hasCall(e.getCallId())?this._passToCall(e):this._onCallCanceled(e);break;case yp.CONNECTED:this._requestCommandLists();break;default:this._passToCall(e)}}},{key:"addListener",value:function(e,t){this.dialListeners.set(e,t)}},{key:"removeListener",value:function(e){this.dialListeners.delete(e)}},{key:"removeAllListeners",value:function(){this.dialListeners.clear()}},{key:"clear",value:function(){var e,t=fr(this._calls.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n.end()}catch(e){fo.error("failed to clear call.")}}}catch(e){t.e(e)}finally{t.f()}this._calls.clear()}},{key:"_register",value:function(e,t){if(!e)throw new Error("call id is not set in call");if(!t)throw new Error("call is null");this._calls.set(e,t)}},{key:"_sendDialReceiveCommand",value:function(e){var t=kp.createDialReceive(e.getCallId(),e.deliveryInfo,e.receivedType,e.payload.shortLivedToken);return this._ctx.sender.send(t).catch((function(){}))}},{key:"_onCallDialed",value:function(e){var t=this,n=this._callFactory.createDirectCall();this._sendDialReceiveCommand(e),this._register(e.getCallId(),n),n.onRinging=function(){return t._onCallRinging(n)},this._passToCall(e)}},{key:"_onCallCanceled",value:function(e){var t=this,n=this._callFactory.createDirectCall();this._register(e.getCallId(),n),n.onRinging=function(){return t._onCallRinging(n)},this._passToCall(e)}},{key:"_onCallRinging",value:function(e){var t,n=fr(this.dialListeners.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.onRinging&&r.onRinging(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_requestCommandLists",value:function(){var e=this;fo.verbose("request command list");var t=Array.from(this._calls.keys()).filter((function(t){return!e._calls.get(t).isEnded})),n=kp.createCommandList(t);this._retrieveCommands(n)}},{key:"_retrieveCommands",value:function(e){var t=this;return this._ctx.sender.send(e).then((function(e){fo.verbose("commandLists is received.");var n=e.call_signal.map((function(e){return new lg(e)}));t._ctx.sender.processCommandLists(n)})).catch((function(e){fo.debug("failed to get commandLists",e)}))}},{key:"_passToCall",value:function(e){this._hasCall(e.getCallId())?this._calls.get(e.getCallId()).onEvent(e):fo.debug("received command ".concat(e.type," for non-existing call ").concat(e.getCallId()))}}]),e}(),hg="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==hg&&hg,fg={searchParams:"URLSearchParams"in hg,iterable:"Symbol"in hg&&"iterator"in Symbol,blob:"FileReader"in hg&&"Blob"in hg&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in hg,arrayBuffer:"ArrayBuffer"in hg};if(fg.arrayBuffer)var _g=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],vg=ArrayBuffer.isView||function(e){return e&&_g.indexOf(Object.prototype.toString.call(e))>-1};function pg(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function yg(e){return"string"!=typeof e&&(e=String(e)),e}function mg(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return fg.iterable&&(t[Symbol.iterator]=function(){return t}),t}function gg(e){this.map={},e instanceof gg?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function Eg(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function kg(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function Rg(e){var t=new FileReader,n=kg(t);return t.readAsArrayBuffer(e),n}function Cg(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Ig(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:fg.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:fg.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:fg.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():fg.arrayBuffer&&fg.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=Cg(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):fg.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||vg(e))?this._bodyArrayBuffer=Cg(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):fg.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},fg.blob&&(this.blob=function(){var e=Eg(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=Eg(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(Rg)}),this.text=function(){var e=Eg(this);if(e)return e;if(this._bodyBlob)return function(e){var t=new FileReader,n=kg(t);return t.readAsText(e),n}(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},fg.formData&&(this.formData=function(){return this.text().then(Tg)}),this.json=function(){return this.text().then(JSON.parse)},this}gg.prototype.append=function(e,t){e=pg(e),t=yg(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},gg.prototype.delete=function(e){delete this.map[pg(e)]},gg.prototype.get=function(e){return e=pg(e),this.has(e)?this.map[e]:null},gg.prototype.has=function(e){return this.map.hasOwnProperty(pg(e))},gg.prototype.set=function(e,t){this.map[pg(e)]=yg(t)},gg.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},gg.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),mg(e)},gg.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),mg(e)},gg.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),mg(e)},fg.iterable&&(gg.prototype[Symbol.iterator]=gg.prototype.entries);var wg=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Ag(e,t){if(!(this instanceof Ag))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,i=(t=t||{}).body;if(e instanceof Ag){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new gg(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new gg(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),wg.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var a=/([?&])_=[^&]*/;if(a.test(this.url))this.url=this.url.replace(a,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function Tg(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function bg(e,t){if(!(this instanceof bg))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"",this.headers=new gg(t.headers),this.url=t.url||"",this._initBody(e)}Ag.prototype.clone=function(){return new Ag(this,{body:this._bodyInit})},Ig.call(Ag.prototype),Ig.call(bg.prototype),bg.prototype.clone=function(){return new bg(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new gg(this.headers),url:this.url})},bg.error=function(){var e=new bg(null,{status:0,statusText:""});return e.type="error",e};var Sg=[301,302,303,307,308];bg.redirect=function(e,t){if(-1===Sg.indexOf(t))throw new RangeError("Invalid status code");return new bg(null,{status:t,headers:{location:e}})};var Og=hg.DOMException;try{new Og}catch(Cf){(Og=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),Og.prototype.constructor=Og}function Dg(e,t){return new Promise((function(n,r){var i=new Ag(e,t);if(i.signal&&i.signal.aborted)return r(new Og("Aborted","AbortError"));var a=new XMLHttpRequest;function o(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new gg,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var i="response"in a?a.response:a.responseText;setTimeout((function(){n(new bg(i,r))}),0)},a.onerror=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},a.ontimeout=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},a.onabort=function(){setTimeout((function(){r(new Og("Aborted","AbortError"))}),0)},a.open(i.method,function(e){try{return""===e&&hg.location.href?hg.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?a.withCredentials=!0:"omit"===i.credentials&&(a.withCredentials=!1),"responseType"in a&&(fg.blob?a.responseType="blob":fg.arrayBuffer&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(a.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof gg?i.headers.forEach((function(e,t){a.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){a.setRequestHeader(e,yg(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",o),a.onreadystatechange=function(){4===a.readyState&&i.signal.removeEventListener("abort",o)}),a.send(void 0===i._bodyInit?null:i._bodyInit)}))}Dg.polyfill=!0,hg.fetch||(hg.fetch=Dg,hg.Headers=gg,hg.Request=Ag,hg.Response=bg);var Ng=function(){var e,t;return null!==(e=window)&&void 0!==e&&e.fetch?(t=window).fetch.apply(t,arguments):Dg.apply(void 0,arguments)},Lg=function(){function e(){Hn(this,e)}return Wn(e,null,[{key:"getOsVersion",value:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"undefined"}}]),e}(),Pg=function(e){Qn(n,e);var t=ir(n);function n(){return Hn(this,n),t.apply(this,arguments)}return n}($a),xg=function(){function e(t){var n;Hn(this,e),this._ctx=t,this._fetch=Ng,this._sessionKey=null,this._hostUrl=null!==(n=this._ctx.apiHost)&&void 0!==n?n:"https://api-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}var t;return Wn(e,[{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._sessionKey=null}},{key:"send",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.getApiOption){e.next=2;break}throw new Error("invalid api request ".concat(JSON.stringify(t)));case 2:if(!(n=t.getApiOption()).auth||this._sessionKey){e.next=5;break}throw new Error("tried to call private api without auth");case 5:return(r=Zn({"Content-Type":"application/json"},n.headers)).SendBird="JS,".concat(Lg.getOsVersion(),",").concat(ed),r["SBCall-Client-Id"]=this._ctx.clientId,this._sessionKey&&(r["SBCall-Session-Token"]=this._sessionKey),e.next=11,this._fetch("".concat(this._getHost()).concat(n.path),{method:n.method,body:JSON.stringify(n.body),headers:r});case 11:return i=e.sent,e.next=14,i.text();case 14:a=e.sent,o=null,e.prev=16,o=JSON.parse(a),e.next=23;break;case 20:throw e.prev=20,e.t0=e.catch(16),new Ja(Ln.ERR_MALFORMED_DATA);case 23:if(i.ok){e.next=33;break}if(!o.error){e.next=28;break}throw new Pg(o.code,{message:o.message});case 28:if(500!==i.status){e.next=30;break}throw new Ja(Ln.INTERNAL_SERVER_ERROR);case 30:if(!(i.status>=300&&i.status<400)){e.next=32;break}throw new Ja(Ln.ERR_MALFORMED_DATA);case 32:throw new Ja(Ln.ERR_REQUEST_FAILED);case 33:if(!(t instanceof as)){e.next=36;break}return s=Ic.parseResponse(t.type,o),e.abrupt("return",s);case 36:if(!o.cmd){e.next=39;break}return c=kp.parse(o),e.abrupt("return",c);case 39:return e.abrupt("return",o);case 40:case"end":return e.stop()}}),e,this,[[16,20]])}))),function(e){return t.apply(this,arguments)})},{key:"_getHost",value:function(){return this._hostUrl}}]),e}(),Mg=function(){function e(){Hn(this,e)}return Wn(e,[{key:"parseToJson",value:function(e){try{return JSON.parse(e)}catch(e){return fo.error("failed to parse JSON message",e),{}}}},{key:"validate",value:function(e){var t=e.cmd,n=e.request_id,r=e.call_type;return!!(n||t||r)}},{key:"parseCommand",value:function(e){return e.error?{isValid:!0,error:{requestId:e.request_id,message:e.message,code:e.code}}:"room"===e.call_type?{isValid:!0,command:Ic.parse(e)}:{isValid:!0,command:kp.parse(e)}}},{key:"parse",value:function(e){var t=this.parseToJson(e);return this.validate(t)?this.parseCommand(t):{isValid:!1}}}]),e}(),Ug=function(){function e(t){var n;Hn(this,e),this._ctx=t,this._ws=null,this._retryTimer=null,this._closed=!0,this._sessionKey=null,this._requestMap=new ju(this._getTimeoutTime()),this._messageParser=new Mg,this._hostUrl=null!==(n=this._ctx.websocketHost)&&void 0!==n?n:"wss://ws-IDENTIFIER.calls.sendbird.com".replace("IDENTIFIER",this._ctx.appId)}return Wn(e,[{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var r;e._sessionKey||n(new Error("tried to connect to websocket server without auth")),0===(null===(r=e._ws)||void 0===r?void 0:r.readyState)&&n(new Error("websocket is reconnecting already")),e._disconnect(),e._ws=e._createWebSocket(),e._closed=!1,e._ws.onopen=function(){e._onOpen(),t(null)},e._ws.onmessage=function(t){var n=e._messageParser.parse(t.data),r=n.isValid,i=n.error,a=n.command;r&&(i?e._processError(i):e.processCommand(a))},e._ws.onerror=function(t){return e._onError(t)},e._ws.onclose=function(){e._onClose(),n(new Ja(Ln.ERR_WEBSOCKET_CONNECTION_FAILED))}}))}},{key:"_processError",value:function(e){var t=e.requestId,n=e.code,r=e.message,i=this._requestMap.unregister(t);i&&(fo.debug(t,e.message),i.reject(new Pg(n,{message:r})))}},{key:"processCommand",value:function(e){var t=this._ctx.router;if(e instanceof vd)t.routeDirectCallPeerCommand(e,Jl.WS);else if(e instanceof pd){var n=this._requestMap.unregister(e.requestId);if(!n)return;t.routeDirectCallResponseCommand(e,n)}else e instanceof md?t.routeDirectCallServerCommand(e,Jl.WS):e instanceof pp?t.routeLogServerCommand(e):e instanceof is?t.routeServerCommand(e):e instanceof ns&&t.routePeerCommand(e)}},{key:"setSessionKey",value:function(e){this._sessionKey=e}},{key:"clearSessionKey",value:function(){this._disconnect(),this._sessionKey=null}},{key:"_disconnect",value:function(){this._ws&&(this._closed=!0,this._removeRetryTimer(),this._ws.onopen=null,this._ws.onmessage=null,this._ws.onerror=null,this._ws.onclose=null,this._ws.close(),this._requestMap.rejectAll(new Ja(Ln.ERR_REQUEST_FAILED_DUE_TO_WEBSOCKET_CONNECTION_LOST)),this._ws=null)}},{key:"send",value:function(e){var t=e.requireResponse()?this._requestMap.register(e.requestId).promise:Promise.resolve(),n=e.serialize();return this._ws.send("".concat(n,"\n")),t}},{key:"_onOpen",value:function(){this._ctx.router.routeWebSocketInternalCommand(kp.createWebSocketConnectedCommand())}},{key:"_onError",value:function(e){fo.error(e)}},{key:"_onClose",value:function(){this.startToReconnect()}},{key:"_createWebSocket",value:function(){var e="/?sbcall_session_token=".concat(encodeURIComponent(this._sessionKey),"&sbcall_client_id=").concat(encodeURIComponent(this._ctx.clientId),"&sendbird=").concat(encodeURIComponent(this._getVersion()));return new WebSocket(this._getHost()+e)}},{key:"_getVersion",value:function(){return"JS,".concat(Lg.getOsVersion(),",").concat(ed)}},{key:"_getHost",value:function(){return this._hostUrl}},{key:"startToReconnect",value:function(){this._closed||this._retryTimer||(this._retryTimer=setTimeout(this._reconnect.bind(this),this._getRetryTime()))}},{key:"_reconnect",value:function(){var e=this;this._removeRetryTimer();Fu(new Bu(5e3,1e3,void 0),(function(){return e.connect()}),{onError:function(e){fo.error("Fail reconnect WebSocket ErrorCode = ".concat(e.code))}})}},{key:"_removeRetryTimer",value:function(){this._retryTimer&&(clearTimeout(this._retryTimer),this._retryTimer=null)}},{key:"_getTimeoutTime",value:function(){return 6e4}},{key:"_getRetryTime",value:function(){return 2e3}},{key:"isConnected",get:function(){return!!this._ws&&1===this._ws.readyState}}]),e}(),Vg=function(){function e(t){Hn(this,e),this._ctx=t,this.wsClient=new Ug(t),this.apiClient=new xg(t)}var t,n;return Wn(e,[{key:"connectWs",value:function(){return this.wsClient.connect()}},{key:"reconnectWs",value:function(){return this.wsClient.startToReconnect()}},{key:"sendAPI",value:function(e){return this.apiClient.send(e)}},{key:"sendWs",value:function(e){return this.wsClient.send(e)}},{key:"send",value:(n=qn(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t instanceof hd)){e.next=11;break}if(t.sendStrategy!==Xl.API){e.next=3;break}return e.abrupt("return",this.sendAPI(t));case 3:if(t.sendStrategy!==Xl.WS){e.next=7;break}if(!this.wsClient.isConnected){e.next=6;break}return e.abrupt("return",this.sendWs(t));case 6:throw new Ja(Ln.ERR_WEBSOCKET_CONNECTION_NOT_OPENED);case 7:if(t.sendStrategy!==Xl.BOTH){e.next=11;break}if(!this.wsClient.isConnected){e.next=10;break}return e.abrupt("return",this.sendWs(t));case 10:case 11:return e.abrupt("return",this.sendAPI(t));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sendWithRetry",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c=this,u=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>1&&void 0!==u[1]?u[1]:new Gu,r=u.length>2&&void 0!==u[2]?u[2]:{count:0,deferred:new Vu},i=r.deferred,a=r.count,e.prev=3,e.next=6,this.send(t);case 6:o=e.sent,i.resolve(o),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),(s=n.calcTimeout(a))>0?setTimeout((function(){c.sendWithRetry(t,n,{count:a+1,deferred:i})}),s):i.reject(e.t0);case 14:return e.abrupt("return",i.promise);case 15:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e){return t.apply(this,arguments)})},{key:"_setSessionKey",value:function(e){this.apiClient.setSessionKey(e),this.wsClient.setSessionKey(e)}},{key:"authenticate",value:function(e){var t=this,n=e.userId,r=e.accessToken,i=kp.createAuthRequest(this._ctx.appId,n,r);return this.send(i).then((function(e){t._setSessionKey(e.sbcall_session_token);var n=lo(e.user);return{user:new Ps(n),statsInterval:e.stats_interval}})).catch((function(e){throw fo.error("failed to authenticate user ".concat(n)),e}))}},{key:"deauthenticate",value:function(){this.apiClient.clearSessionKey(),this.wsClient.clearSessionKey()}},{key:"processCommandLists",value:function(e){var t,n=fr(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.userRole!==no.CALLER||this._ctx.clientId===r.callerClientId){if(r.userRole===no.CALLEE&&this._ctx.clientId!==r.calleeClientId){var i=r.getAcceptResponse();if(i){var a=i.payload.callId,o=kp.createAccepted(a);this._ctx.router.routeDirectCallPeerCommand(o,Jl.WS);continue}var s=r.getDeclineResponse();if(s){var c=s.payload,u=c.callId,l=c.endedCall,d=kp.createDeclined(u,l);this._ctx.router.routeDirectCallInternalCommand(d)}}var h=r.commands,f=r.snapshot;fo.verbose("process commandList. length: ".concat(h.length));var _,v=fr(h);try{for(v.s();!(_=v.n()).done;){var p=_.value;this.wsClient.processCommand(p)}}catch(e){v.e(e)}finally{v.f()}var y=kp.createSnapshot(r.callId,f);this._ctx.router.routeDirectCallInternalCommand(y)}}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),Fg=function(e){Qn(n,e);var t=ir(n);function n(e,r){var i;return Hn(this,n),(i=t.call(this))._recordId=Nc(),i._blobs=[],i._mediaRecorder=new MediaRecorder(e,r),i._mediaRecorder.ondataavailable=function(e){e.data&&e.data.size>0&&i._blobs.push(e.data)},i._mediaRecorder.onstart=function(){return i._onStart()},i._mediaRecorder.onstop=function(){return i._onStop()},i._mediaRecorder.onpause=function(){return i._onPause()},i._mediaRecorder.onresume=function(){return i._onResume()},i._mediaRecorder.onerror=function(){return i._onError()},i}return Wn(n,[{key:"startRecording",value:function(){try{this._mediaRecorder.start()}catch(e){return fo.error("start recording failed with error : ",e),!1}return!0}},{key:"stopRecording",value:function(){try{this._mediaRecorder.stop()}catch(e){return fo.error("stop recording failed with error : ",e),!1}return!0}},{key:"_onStart",value:function(){this._dispatchEvent("start")}},{key:"_onStop",value:function(){this._dispatchEvent("stop"),this._onRecordingSucceeded(new Blob(this._blobs))}},{key:"_onPause",value:function(){this._dispatchEvent("pause")}},{key:"_onResume",value:function(){this._dispatchEvent("resume")}},{key:"_onError",value:function(){this._dispatchEvent("error"),this._onRecordingFailed(new Ja(Ln.ERR_FAILED_TO_STOP_RECORDING))}},{key:"_onRecordingSucceeded",value:function(e){this._dispatchEvent("succeeded",e)}},{key:"_onRecordingFailed",value:function(e){this._dispatchEvent("failed",e)}},{key:"recordId",get:function(){return this._recordId}},{key:"recordingStatus",get:function(){return"recording"===this._mediaRecorder.state?Wl.RECORDING:Wl.NONE}}]),n}(zo),Gg=function(){function e(){Hn(this,e),this._listeners=new Map,this._recorders=new Map}return Wn(e,[{key:"getRecord",value:function(e){return this._recorders.get(e)}},{key:"addListener",value:function(e,t){this._listeners.set(e,t)}},{key:"removeListener",value:function(e){this._listeners.delete(e)}},{key:"removeAllListeners",value:function(){this._listeners.clear()}},{key:"_fireOnSucceeded",value:function(e,t){this._listeners.forEach((function(n){n.onRecordingSucceeded&&n.onRecordingSucceeded(t.callId,e,t.recordingOptions,t.fileName)}))}},{key:"_fireOnFailed",value:function(e,t,n){this._listeners.forEach((function(r){r.onRecordingFailed&&r.onRecordingFailed(t.callId,e,n)}))}},{key:"startRecording",value:function(e,t,n){var r=this,i=new Fg(e,t);if(i.startRecording())return this._recorders.set(i.recordId,i),i.on("succeeded",(function(e){jm.downloadRecordedFile(e,n.fileName),r._fireOnSucceeded(i.recordId,n)})),i.on("failed",(function(e){r._fireOnFailed(i.recordId,n,e)})),i}},{key:"stopRecording",value:function(e){if(this._recorders.size>0){var t=this._recorders.get(e);return!!t&&t.stopRecording()}return!1}},{key:"listeners",get:function(){return this._listeners}}]),e}(),Bg=function(){function e(){Hn(this,e),this.processed=new Map}return Wn(e,[{key:"process",value:function(e){return!e.messageId||(this._isProcessed(e)?(this.processed.delete(e.messageId),!1):(this._setProcessed(e),!0))}},{key:"_isProcessed",value:function(e){return this.processed.has(e.messageId)}},{key:"_setProcessed",value:function(e){this.processed.set(e.messageId,!0)}}]),e}(),jg=function(){function e(){Hn(this,e),this.lastSeqNumber=-1,this.queue=new Map}var t,n;return Wn(e,[{key:"insert",value:(n=qn(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.lastSeqNumber>=t.sequenceNumber)){e.next=2;break}return e.abrupt("return");case 2:return this.queue.set(t.sequenceNumber,{command:t,handler:n}),fo.verbose("".concat(t.constructor.name," is inserted")),e.next=6,this.flush();case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"flush",value:(t=qn(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fo.verbose("try flushing sequence queue"),t=this.next();case 2:if(!t){e.next=10;break}return r=(n=t).command,i=n.handler,fo.verbose("flush ".concat(r.constructor.name)),e.next=7,i(r);case 7:t=this.next(),e.next=2;break;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"next",value:function(){var e=this.lastSeqNumber+1;if(this.queue.has(e)){var t=this.queue.get(e),n=t.command,r=t.handler;return this.queue.delete(e),this.lastSeqNumber=e,{command:n,handler:r}}return null}}]),e}(),qg=function(){function e(){Hn(this,e),this.sequences=new Map,this.lock=new $o}var t;return Wn(e,[{key:"insert",value:(t=qn(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.lock.acquire();case 2:if(e.prev=2,fo.verbose("try to insert in SequenceManager with ".concat(t.constructor.name)),r=t.getCallId(),t.isSequential()&&r){e.next=10;break}return fo.verbose("not sequential; immediately flush ".concat(t.constructor.name)),this.lock.release(),n(t),e.abrupt("return");case 10:if(!this.sequences.has(r)){e.next=16;break}return i=this.sequences.get(r),e.next=14,i.insert(t,n);case 14:e.next=20;break;case 16:return a=new jg,this.sequences.set(r,a),e.next=20,a.insert(t,n);case 20:e.next=25;break;case 22:e.prev=22,e.t0=e.catch(2),fo.warning("failed to SequenceManager.insert()",e.t0);case 25:return e.prev=25,this.lock.release(),e.finish(25);case 28:case"end":return e.stop()}}),e,this,[[2,22,25,28]])}))),function(e,n){return t.apply(this,arguments)})}]),e}(),Hg=function(e){Qn(n,e);var t=ir(n);function n(){var e;return Hn(this,n),(e=t.call(this))._sequenceManager=new qg,e._eventDeduplicator=new Bg,e}return Wn(n,[{key:"routeWebSocketInternalCommand",value:function(e){this._dispatchEvent("webSocketInternal",e)}},{key:"routeLogServerCommand",value:function(e){this._dispatchEvent("logServer",e)}},{key:"routeDirectCallInternalCommand",value:function(e){this._dispatchEvent("directCallInternal",e)}},{key:"routeDirectCallPeerCommand",value:function(e,t){var n=this;this._eventDeduplicator.process(e)&&(e.receivedType=t,this._sequenceManager.insert(e,(function(e){n._dispatchEvent("directCallPeer",e)})))}},{key:"routeDirectCallResponseCommand",value:function(e,t){this._sequenceManager.insert(e,function(){var e=qn(regeneratorRuntime.mark((function e(n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.resolve(n),e.abrupt("return",t.promise);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"routeDirectCallServerCommand",value:function(e,t){var n=this;this._eventDeduplicator.process(e)&&(e.receivedType=t,this._sequenceManager.insert(e,(function(e){n._dispatchEvent("directCallServer",e)})))}},{key:"routeServerCommand",value:function(e){e instanceof cs&&this._dispatchEvent("roomServer",e)}},{key:"routePeerCommand",value:function(e){e instanceof os&&this._dispatchEvent("roomPeer",e)}}]),n}(zo),zg=function(){function e(t,n,r){Hn(this,e),this.isLoading=!1,this.hasNext=!0,this.userId=t,this.params=n,this.sender=r,this.nextToken=null}var t;return Wn(e,[{key:"next",value:(t=qn(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoading){e.next=2;break}throw new Ja(Ln.ERR_QUERY_IN_PROGRESS);case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return this.isLoading=!0,n=this.sender.send(this._createCommand()).then((function(e){return r.nextToken=e.next,r.hasNext=e.has_next,r.isLoading=!1,e.calls.map((function(e){return new Uv(e,!0)}))})),t&&eo(n)(t),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_createCommand",value:function(){return new od(this.userId,this.params,this.nextToken)}}]),e}(),Wg=function(){function e(t,n){Hn(this,e),this.isLoading=!1,this.params=t,this.sender=n,this.prevToken=null,this.nextToken=null}var t,n,r;return Wn(e,[{key:"next",value:(r=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoading){e.next=2;break}throw new Ja(Ln.ERR_QUERY_IN_PROGRESS);case 2:if(this.hasNext){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(null,this.nextToken));case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"prev",value:(n=qn(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isLoading){e.next=2;break}throw new Ja(Ln.ERR_QUERY_IN_PROGRESS);case 2:if(this.hasPrev){e.next=4;break}return e.abrupt("return",[]);case 4:return e.abrupt("return",this._sendQueryCommand(this.prevToken,null));case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"_sendQueryCommand",value:(t=qn(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||!n){e.next=2;break}throw new Error("internal error while creating RoomListQueryCommand");case 2:return r=Ic.createRoomListQuery(this.params,t,n),e.next=5,this.sender.send(r);case 5:return i=e.sent,a=i.payload,this.isLoading=!0,this.prevToken=a.prev,this.nextToken=a.next,this.isLoading=!1,e.abrupt("return",a.rooms);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasPrev",get:function(){return!!this.prevToken}},{key:"hasNext",get:function(){return!this.prevToken&&!this.nextToken||!!this.nextToken}}]),e}(),Kg="active",Yg="passive",Zg="hidden",Qg="frozen",Xg="terminated",$g=function(){return"undefined"!=typeof window&&"object"===Bn(window.safari)&&window.safari.pushNotification},Jg=function(){return["focus","blur","visibilitychange","freeze","resume","pageshow","onpageshow"in window?"pagehide":"unload"]},eE=[[Kg,Yg,Zg,Xg],[Kg,Yg,Zg,Qg],[Zg,Yg,Kg],[Qg,Zg],[Qg,Kg],[Qg,Yg]].map((function(e){return e.reduce((function(e,t,n){return e[t]=n,e}),{})})),tE=function(){return"undefined"==typeof document?Yg:document.visibilityState===Zg?Zg:document.hasFocus()?Kg:Yg},nE=function(e){Qn(n,e);var t=ir(n);function n(){var e;return Hn(this,n),(e=t.call(this))._state=tE(),e._handleEvents=e._handleEvents.bind(rr(e)),Jg().forEach((function(t){return addEventListener(t,e._handleEvents,!0)})),$g()&&addEventListener("beforeunload",(function(t){e._safariBeforeUnloadTimeout=setTimeout((function(){t.defaultPrevented||t.returnValue.length>0||e._dispatchChangesIfNeeded(t,Zg)}),0)})),e}return Wn(n,[{key:"_dispatchChangesIfNeeded",value:function(e,t){if(t!==this._state)for(var n=function(e,t){for(var n,r=0;n=eE[r];++r){var i=n[e],a=n[t];if(i>=0&&a>=0&&a>i)return Object.keys(n).slice(i,a+1)}return[]}(this._state,t),r=0;r<n.length-1;++r){var i=n[r],a=n[r+1];this._state=a,this._dispatchEvent("statechange",{oldState:i,newState:a,originalEvent:e})}}},{key:"_handleEvents",value:function(e){switch($g()&&clearTimeout(this._safariBeforeUnloadTimeout),e.type){case"pageshow":case"resume":this._dispatchChangesIfNeeded(e,tE());break;case"focus":this._dispatchChangesIfNeeded(e,Kg);break;case"blur":this._state===Kg&&this._dispatchChangesIfNeeded(e,tE());break;case"pagehide":case"unload":this._dispatchChangesIfNeeded(e,e.persisted?Qg:Xg);break;case"visibilitychange":this._state!==Qg&&this._state!==Xg&&this._dispatchChangesIfNeeded(e,tE());break;case"freeze":this._dispatchChangesIfNeeded(e,Qg)}}},{key:"state",get:function(){return this._state}},{key:"pageWasDiscarded",get:function(){return"undefined"!=typeof document&&(document.wasDiscarded||!1)}}]),n}(zo),rE=function(e){Qn(n,e);var t=ir(n);function n(){var e;return Hn(this,n),(e=t.call(this))._currentState="active",e._lifecycle=new nE,e}return Wn(n,[{key:"_onStateChanged",value:function(e){"hidden"!==e.newState?"hidden"===this._currentState&&this._dispatchEvent("resume"):"hidden"!==this._currentState&&this._dispatchEvent("pause"),this._currentState=e.newState}},{key:"start",value:function(){var e=this;this._lifecycle.addEventListener("statechange",(function(t){return e._onStateChanged(t)}))}},{key:"stop",value:function(){var e=this;this._lifecycle.removeEventListener("statechange",(function(t){return e._onStateChanged(t)}))}}]),n}(zo),iE=function(){function e(t,n,r){if(Hn(this,e),Kn(this,"_ctx",{}),this._appId=t,this._apiHost=n,this._websocketHost=r,!t)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"appId"});this._ctx.appId=t,this._ctx.apiHost=n,this._ctx.websocketHost=r,this._user=null,this._visibilityDetector=new rE,this.init()}return Wn(e,[{key:"init",value:function(){this._ctx.clientId=Nc();var e=new Hg;this._ctx.router=e,this._ctx.sender=new Vg(this._ctx),this._ctx.deviceManager=new bl,this._ctx.recordingManager=new Gg,this._ctx.soundManager=new Yl;var t=new dg(this._ctx);this._ctx.callManager=t,this._callManager=t;var n=new Hl(this._ctx);this._roomManager=n,e.on("directCallInternal",(function(e){return t.onEvent(e)})),e.on("directCallPeer",(function(e){return t.onEvent(e)})),e.on("directCallServer",(function(e){return t.onEvent(e)})),e.on("webSocketInternal",(function(e){return t.onEvent(e)})),e.on("roomServer",(function(e){return n.onEvent(e)})),e.on("roomPeer",(function(e){return n.onEvent(e)}));var r=new Rp(this._ctx);fo.logCollector=r,e.on("logServer",(function(e){return r.onEvent(e)}))}},{key:"_checkAuthed",value:function(){if(!this.currentUser)throw new vo(Ln.USER_NOT_AUTHENTICATED)}},{key:"authenticate",value:function(e,t){var n=this,r=e.userId,i=e.accessToken;if(fo.info("authenticate()"),!r)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"userId"});var a=this._ctx.sender.authenticate({userId:r,accessToken:i}).then((function(e){return n._user=e.user,n._callManager.setStatsInterval(e.statsInterval),n._user}));return t&&eo(a)(t),a}},{key:"deauthenticate",value:function(){fo.info("deauthenticate()"),this._callManager&&this._callManager.clear(),this._roomManager&&this._roomManager.clear(),this._visibilityDetector.stop(),this._visibilityDetector.removeAllEventListeners(),this._ctx.sender.deauthenticate(),this._user=null}},{key:"connectWebSocket",value:function(){var e=this;return this._visibilityDetector.start(),this._visibilityDetector.on("resume",(function(){e._ctx.sender.reconnectWs(),e._ctx.deviceManager.updateStream()})),this._ctx.sender.connectWs()}},{key:"handleWebhookData",value:function(e){var t=e.sendbird_call;if(!t)throw new Ja(Ln.ERR_MALFORMED_DATA);if(!t.cmd)throw new Ja(Ln.ERR_MALFORMED_DATA);var n=kp.parse(t);n instanceof vd&&this._ctx.router.routeDirectCallPeerCommand(n,Jl.WEBHOOK)}},{key:"addListener",value:function(e,t){if(!t)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"listener"});this._callManager.addListener(e,t),this._roomManager.addListener(e,t),this._ctx.deviceManager.addSendBirdCallListener(e,t)}},{key:"removeListener",value:function(e){this._callManager.removeListener(e),this._roomManager.removeListener(e),this._ctx.deviceManager.removeSendBirdCallListener(e)}},{key:"removeAllListeners",value:function(){this._callManager.removeAllListeners(),this._ctx.deviceManager.removeAllSendBirdCallListener()}},{key:"addRecordingListener",value:function(e,t){this._ctx.recordingManager.addListener(e,t)}},{key:"removeRecordingListener",value:function(e){this._ctx.recordingManager.removeListener(e)}},{key:"removeAllRecordingListeners",value:function(){this._ctx.recordingManager.removeAllListeners()}},{key:"useMedia",value:function(e){return this._ctx.deviceManager.useMedia(e)}},{key:"updateMediaDevices",value:function(e){return this._ctx.deviceManager.refreshMediaDevices(e)}},{key:"getCurrentAudioInputDevice",value:function(){return this._ctx.deviceManager.getCurrentAudioInputDevice()}},{key:"getAvailableAudioInputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioInputDevices()}},{key:"selectAudioInputDevice",value:function(e){return this._ctx.deviceManager.selectDevice("audioinput",e)}},{key:"getCurrentAudioOutputDevice",value:function(){return this._ctx.deviceManager.getCurrentAudioOutputDevice()}},{key:"getAvailableAudioOutputDevices",value:function(){return this._ctx.deviceManager.getAvailableAudioOutputDevices()}},{key:"selectAudioOutputDevice",value:function(e){return this._ctx.deviceManager.selectDevice("audiooutput",e)}},{key:"getCurrentVideoInputDevice",value:function(){return this._ctx.deviceManager.getCurrentVideoInputDevice()}},{key:"getAvailableVideoInputDevices",value:function(){return this._ctx.deviceManager.getAvailableVideoInputDevices()}},{key:"selectVideoInputDevice",value:function(e){return this._ctx.deviceManager.selectDevice("videoinput",e)}},{key:"getCall",value:function(e){return this._callManager.getCall(e)}},{key:"getOngoingCalls",value:function(){return this._callManager.getOngoingCalls()}},{key:"getOngoingCallCount",value:function(){return this._callManager.getOngoingCallCount()}},{key:"setRingingTimeout",value:function(e){this._callManager.setRingingTimeout(e)}},{key:"setCallConnectionTimeout",value:function(e){this._callManager.setCallConnectionTimeout(e)}},{key:"isPlaying",value:function(e){return this._ctx.soundManager.isPlaying(e)}},{key:"addDirectCallSound",value:function(e,t){return this._ctx.soundManager.loadSound(e,t)}},{key:"removeDirectCallSound",value:function(e){return this._ctx.soundManager.unloadSound(e)}},{key:"dial",value:function(e,t){fo.info("dial()"),this._checkAuthed();var n=e.userId;if(this._user.userId===n)throw new td(Ln.MY_USER_ID_NOT_ALLOWED);return this._callManager.dial(e,t)}},{key:"updateCustomItems",value:function(e,t,n){var r=or(ro(t,n),2)[1];if(r)return r;var i=this._callManager.getCall(e);if(!i){var a=kp.createUpdateCustomItems(e,t),o=this._ctx.sender.send(a).then((function(e){return{customItems:e.custom_items,affectedKeys:e.updated}})).catch((function(e){throw fo.error("failed to update customItems"),e}));return n&&eo(o)(n),o}return i.updateCustomItems(t,n)}},{key:"deleteCustomItems",value:function(e,t,n){var r=or(io(t,n),2)[1];if(r)return r;var i=this._callManager.getCall(e);if(!i){var a=kp.createDeleteCustomItems(e,t),o=this._ctx.sender.send(a).then((function(e){return{customItems:e.custom_items,affectedKeys:e.deleted}})).catch((function(e){throw fo.error("failed to delete customItems"),e}));return n&&eo(o)(n),o}return i.deleteCustomItems(t,n)}},{key:"deleteAllCustomItems",value:function(e,t){var n=this._callManager.getCall(e);if(!n){var r=kp.createDeleteAllCustomItems(e),i=this._ctx.sender.send(r).then((function(e){return{customItems:e.custom_items,affectedKeys:e.deleted}})).catch((function(e){throw fo.error("failed to delete all customItems"),e}));return t&&eo(i)(t),i}return n.deleteAllCustomItems(t)}},{key:"createDirectCallLogListQuery",value:function(e){return new zg(this._user.userId,e,this._ctx.sender)}},{key:"createRoom",value:function(e){return this._roomManager.createRoom(e)}},{key:"getCachedRoomById",value:function(e){return this._roomManager.getCachedRoomById(e)}},{key:"fetchRoomById",value:function(e){return this._roomManager.fetchRoomById(e)}},{key:"createRoomListQuery",value:function(e){return new Wg(e,this._ctx.sender)}},{key:"registerPushToken",value:function(e,t){if(!e)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"pushToken"});if(!t)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"tokenType"});var n=kp.createRegisterPushToken(this._user.userId,e,t);return this._ctx.sender.send(n).catch((function(e){throw fo.error("failed to register the user's push token"),e}))}},{key:"unregisterPushToken",value:function(e,t){if(!e)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"pushToken"});if(!t)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"tokenType"});var n=kp.createUnregisterPushToken(this._user.userId,e,t);return this._ctx.sender.send(n).catch((function(e){throw fo.error("failed to unregister the user's push token"),e}))}},{key:"unregisterAllPushTokens",value:function(e){if(!e)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"tokenType"});var t=kp.createUnregisterAllPushTokens(this._user.userId,e);return this._ctx.sender.send(t).catch((function(e){throw fo.error("failed to unregister the user's all push token"),e}))}},{key:"appId",get:function(){return this._appId}},{key:"currentUser",get:function(){return this._user}},{key:"dialListeners",get:function(){return this._callManager.dialListeners}},{key:"recordingListeners",get:function(){return this._ctx.recordingManager.listeners}}]),e}(),aE=null;function oE(){if(!aE)throw new vo(Ln.INSTANCE_NOT_INITIALIZED)}var sE=vr(null,(function(e){var t=function t(){Hn(this,t),e(this)};return{F:t,d:[{kind:"get",static:!0,key:"sdkVersion",value:function(){return ed}},{kind:"get",static:!0,key:"LoggerLevel",value:function(){return zl}},{kind:"method",static:!0,key:"setLoggerLevel",value:function(e){return fo.setLoggerLevel(Yr[e])}},{kind:"get",static:!0,key:"SoundType",value:function(){return jl}},{kind:"get",static:!0,key:"RoomType",value:function(){return Nl}},{kind:"get",static:!0,key:"DirectCallUserRole",value:function(){return no}},{kind:"get",static:!0,key:"DirectCallEndResult",value:function(){return to}},{kind:"get",static:!0,key:"DirectCallOption",value:function(){return po}},{kind:"get",static:!0,key:"DirectCallRecordOption",value:function(){return Oo}},{kind:"get",static:!0,key:"RecordingType",value:function(){return Co}},{kind:"get",static:!0,key:"ErrorCode",value:function(){return Ln}},{kind:"get",static:!0,key:"TokenType",value:function(){return Kl}},{kind:"method",static:!0,key:"init",value:function(e,t,n){if(!e)throw new vo(Ln.INVALID_PARAMETER_VALUE,{invalidParameter:"appId"});if(function(){if("undefined"==typeof window){var e="SendBirdCall needs 'window' in global";throw fo.error(e),e}if(void 0===window.RTCPeerConnection){var t="SendBirdCall needs 'RTCPeerConnection' in global";throw fo.error(t),t}var n=window.location,r=n.protocol,i=n.hostname;if("file:"!==r&&"https:"!==r&&"127.0.0.1"!==i&&"localhost"!==i){var a="SendBirdCall needs https connection, except for 'localhost' or '127.0.0.1'";throw fo.error(a),a}if(void 0===window.RTCPeerConnection.prototype.addTrack||void 0===window.RTCPeerConnection.prototype.getSenders){var o="SendBirdCall can't support the browser using legacy WebRTC module";throw fo.error(o),o}}(),aE&&aE.appId===e)return!1;var r=null,i=null,a=null;return aE&&(aE.deauthenticate(),i=new Map(aE.dialListeners),a=new Map(aE.recordingListeners),aE.removeAllListeners(),aE.removeAllRecordingListeners(),r=aE),aE=new iE(e,t,n),r&&(i.forEach((function(e,t){aE.addListener(t,e)})),a.forEach((function(e,t){aE.addRecordingListener(t,e)}))),!0}},{kind:"get",static:!0,key:"appId",value:function(){var e;return null===(e=aE)||void 0===e?void 0:e.appId}},{kind:"get",static:!0,key:"currentUser",value:function(){var e;return null===(e=aE)||void 0===e?void 0:e.currentUser}},{kind:"method",static:!0,key:"authenticate",value:function(e,n){oE();var r=e.userId,i=e.accessToken;return aE&&aE.currentUser&&aE.currentUser.userId!==r&&t.deauthenticate(),aE.authenticate({userId:r,accessToken:i},n)}},{kind:"method",static:!0,key:"deauthenticate",value:function(){oE(),aE.deauthenticate()}},{kind:"method",static:!0,key:"connectWebSocket",value:function(){return oE(),aE.connectWebSocket()}},{kind:"method",static:!0,key:"handleWebhookData",value:function(e){oE(),aE.handleWebhookData(e)}},{kind:"method",static:!0,key:"addListener",value:function(e,t){oE(),aE.addListener(e,t)}},{kind:"method",static:!0,key:"removeListener",value:function(e){oE(),aE.removeListener(e)}},{kind:"method",static:!0,key:"removeAllListeners",value:function(){oE(),aE.removeAllListeners()}},{kind:"method",static:!0,key:"addRecordingListener",value:function(e,t){oE(),aE.addRecordingListener(e,t)}},{kind:"method",static:!0,key:"removeRecordingListener",value:function(e){oE(),aE.removeRecordingListener(e)}},{kind:"method",static:!0,key:"removeAllRecordingListeners",value:function(){oE(),aE.removeAllRecordingListeners()}},{kind:"method",static:!0,key:"useMedia",value:function(e){return oE(),aE.useMedia(e)}},{kind:"method",static:!0,key:"updateMediaDevices",value:function(e){return oE(),aE.updateMediaDevices(e)}},{kind:"method",static:!0,key:"getCurrentAudioInputDevice",value:function(){return oE(),aE.getCurrentAudioInputDevice()}},{kind:"method",static:!0,key:"getAvailableAudioInputDevices",value:function(){return oE(),aE.getAvailableAudioInputDevices()}},{kind:"method",static:!0,key:"selectAudioInputDevice",value:function(e){return oE(),aE.selectAudioInputDevice(e)}},{kind:"method",static:!0,key:"getCurrentAudioOutputDevice",value:function(){return oE(),aE.getCurrentAudioOutputDevice()}},{kind:"method",static:!0,key:"getAvailableAudioOutputDevices",value:function(){return oE(),aE.getAvailableAudioOutputDevices()}},{kind:"method",static:!0,key:"selectAudioOutputDevice",value:function(e){return oE(),aE.selectAudioOutputDevice(e)}},{kind:"method",static:!0,key:"getCurrentVideoInputDevice",value:function(){return oE(),aE.getCurrentVideoInputDevice()}},{kind:"method",static:!0,key:"getAvailableVideoInputDevices",value:function(){return oE(),aE.getAvailableVideoInputDevices()}},{kind:"method",static:!0,key:"selectVideoInputDevice",value:function(e){return oE(),aE.selectVideoInputDevice(e)}},{kind:"method",static:!0,key:"getCall",value:function(e){return oE(),aE.getCall(e)}},{kind:"method",static:!0,key:"getOngoingCalls",value:function(){return oE(),aE.getOngoingCalls()}},{kind:"method",static:!0,key:"getOngoingCallCount",value:function(){return oE(),aE.getOngoingCallCount()}},{kind:"method",static:!0,key:"setRingingTimeout",value:function(e){oE(),aE.setRingingTimeout(e)}},{kind:"method",static:!0,key:"setCallConnectionTimeout",value:function(e){oE(),aE.setCallConnectionTimeout(e)}},{kind:"method",static:!0,key:"isPlaying",value:function(e){return oE(),aE.isPlaying(e)}},{kind:"method",static:!0,key:"addDirectCallSound",value:function(e,t){return oE(),aE.addDirectCallSound(e,t)}},{kind:"method",static:!0,key:"removeDirectCallSound",value:function(e){return oE(),aE.removeDirectCallSound(e)}},{kind:"method",decorators:[Zl(Zl.messages.CALL_IS_NOT_SUPPORTED)],static:!0,key:"dial",value:function(e,t){return oE(),aE.dial(e,t)}},{kind:"method",static:!0,key:"updateCustomItems",value:function(e,t,n){return oE(),aE.updateCustomItems(e,t,n)}},{kind:"method",static:!0,key:"deleteCustomItems",value:function(e,t,n){return oE(),aE.deleteCustomItems(e,t,n)}},{kind:"method",static:!0,key:"deleteAllCustomItems",value:function(e,t){return oE(),aE.deleteAllCustomItems(e,t)}},{kind:"method",static:!0,key:"createDirectCallLogListQuery",value:function(e){return oE(),aE.createDirectCallLogListQuery(e)}},{kind:"method",static:!0,key:"createRoom",value:function(e){return oE(),aE.createRoom(e)}},{kind:"method",static:!0,key:"getCachedRoomById",value:function(e){return oE(),aE.getCachedRoomById(e)}},{kind:"method",static:!0,key:"fetchRoomById",value:function(e){return oE(),aE.fetchRoomById(e)}},{kind:"method",static:!0,key:"createRoomListQuery",value:function(e){return oE(),aE.createRoomListQuery(e)}},{kind:"method",static:!0,key:"registerPushToken",value:function(e,t){return oE(),aE.registerPushToken(e,t)}},{kind:"method",static:!0,key:"unregisterPushToken",value:function(e,t){return oE(),aE.unregisterPushToken(e,t)}},{kind:"method",static:!0,key:"unregisterAllPushTokens",value:function(e){return oE(),aE.unregisterAllPushTokens(e)}}]}}));return sE}));